"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[964],{28964:(_t,Se,f)=>{f.r(Se),f.d(Se,{ConfigurationScope:()=>F,configurationRegistry:()=>Zt,default:()=>zt,getUserConfiguration:()=>Tt,onUserConfigurationChange:()=>Vt,updateUserConfiguration:()=>At});var c=f(58054),h=f(55885),j=(f(87708),f(72967)),Z=f(58535),m=f(13683),L=f(56160),V=f(94927),w=f(12997),E=f(26056),ye=f(36027),k=f(39108),y=f(53614),O=f(31719),re=f(81309),A=f(93358),M=f(13686);class H extends y.wU{constructor(e){super(e),this._folders=[],this._transient=!1,this._settingsModelParser=new y.wU(e),this._launchModel=new y.VV,this._tasksModel=new y.VV}get folders(){return this._folders}get transient(){return this._transient}get settingsModel(){return this._settingsModelParser.configurationModel}get launchModel(){return this._launchModel}get tasksModel(){return this._tasksModel}reparseWorkspaceSettings(e){this._settingsModelParser.reparse(e)}getRestrictedWorkspaceSettings(){return this._settingsModelParser.restrictedConfigurations}doParseRaw(e,t){return this._folders=e.folders||[],this._transient=(0,A.jn)(e.transient)&&e.transient,this._settingsModelParser.parseRaw(e.settings,t),this._launchModel=this.createConfigurationModelFrom(e,"launch"),this._tasksModel=this.createConfigurationModelFrom(e,"tasks"),super.doParseRaw(e,t)}createConfigurationModelFrom(e,t){const i=e[t];if(i){const r=(0,O.Od)(i,s=>console.error(`Conflict in settings file ${this._name}: ${s}`)),n=Object.create(null);n[t]=r;const o=Object.keys(i).map(s=>`${t}.${s}`);return new y.VV(n,o,[])}return new y.VV}}class me extends y.wU{constructor(e,t){super(e),this.scope=t}doParseRaw(e,t){const i=(0,O.Od)(e,o=>console.error(`Conflict in settings file ${this._name}: ${o}`)),r=Object.create(null);return r[this.scope]=i,{contents:r,keys:Object.keys(e).map(o=>`${this.scope}.${o}`),overrides:[]}}}class we extends y.VK{constructor(e,t,i,r,n,o,s,a,u,d){super(e,t,i,r,n,o,s,a,u),this._workspace=d}getValue(e,t={}){return super.getValue(e,t,this._workspace)}inspect(e,t={}){return super.inspect(e,t,this._workspace)}keys(){return super.keys(this._workspace)}compareAndDeleteFolderConfiguration(e){return this._workspace&&this._workspace.folders.length>0&&this._workspace.folders[0].uri.toString()===e.toString()?{keys:[],overrides:[]}:super.compareAndDeleteFolderConfiguration(e)}compare(e){const t=(o,s,a)=>{const u=[];return u.push(...s.filter(d=>-1===o.indexOf(d))),u.push(...o.filter(d=>-1===s.indexOf(d))),u.push(...o.filter(d=>-1!==s.indexOf(d)&&(!(0,V.fS)(this.getValue(d,{overrideIdentifier:a}),e.getValue(d,{overrideIdentifier:a}))||this._workspace&&this._workspace.folders.some(g=>!(0,V.fS)(this.getValue(d,{resource:g.uri,overrideIdentifier:a}),e.getValue(d,{resource:g.uri,overrideIdentifier:a})))))),u},i=t(this.allKeys(),e.allKeys()),r=[],n=(0,M.EB)([...this.allOverrideIdentifiers(),...e.allOverrideIdentifiers()]);for(const o of n){const s=t(this.getAllKeysForOverrideIdentifier(o),e.getAllKeysForOverrideIdentifier(o),o);s.length&&r.push([o,s])}return{keys:i,overrides:r}}}var v=f(80564),I=f(33562),C=f(84776),D=f(36725),l=f(12829),Be=f(44102),$e=f(71057),We=f(4866),N=f(17088),Je=f(56980),Ye=f(49311),z=f(51776),Qe=f(17360),G=f(18747),He=f(84761),Re=f(542),Ge=f(49462),ne=f(75221),_=f(99167);class Xe extends Error{constructor(e,t){super(e),this.code=t}}let oe=class{constructor(e,t,i,r,n,o,s,a,u,d,g,W){this.remoteSettingsResource=e,this.configurationService=t,this.contextService=i,this.userDataProfileService=r,this.userDataProfilesService=n,this.fileService=o,this.textModelResolverService=s,this.textFileService=a,this.notificationService=u,this.preferencesService=d,this.editorService=g,this.uriIdentityService=W,this.queue=new E.ci}writeConfiguration(e,t,i={}){var r=this;return(0,c.Z)(function*(){const n=r.getConfigurationEditOperation(e,t,i.scopes||{});return r.queue.queue((0,c.Z)(function*(){try{yield r.doWriteConfiguration(n,i)}catch(o){if(i.donotNotifyError)throw o;yield r.onError(o,n,i.scopes)}}))})()}doWriteConfiguration(e,t){var i=this;return(0,c.Z)(function*(){yield i.validate(e.target,e,!t.handleDirtyFile,t.scopes||{});const r=e.resource,n=yield i.resolveModelReference(r);try{const o=i.getFormattingOptions(n.object.textEditorModel);yield i.updateConfiguration(e,n.object.textEditorModel,o,t)}finally{n.dispose()}})()}updateConfiguration(e,t,i,r){var n=this;return(0,c.Z)(function*(){if(n.hasParseErrors(t.getValue(),e))throw n.toConfigurationEditingError(11,e.target,e);if(n.textFileService.isDirty(t.uri)&&r.handleDirtyFile)switch(r.handleDirtyFile){case"save":yield n.save(t,e);break;case"revert":yield n.textFileService.revert(t.uri)}const o=n.getEdits(e,t.getValue(),i)[0];o&&n.applyEditsToBuffer(o,t)&&(yield n.save(t,e))})()}save(e,t){var i=this;return(0,c.Z)(function*(){try{yield i.textFileService.save(e.uri,{ignoreErrorHandler:!0})}catch(r){throw i.toConfigurationEditingError(3===r.fileOperationResult?10:13,t.target,t)}})()}applyEditsToBuffer(e,t){const i=t.getPositionAt(e.offset),r=t.getPositionAt(e.offset+e.length),n=new He.e(i.lineNumber,i.column,r.lineNumber,r.column),o=t.getValueInRange(n);if(e.content!==o){const s=o?Re.h.replace(n,e.content):Re.h.insert(i,e.content);return t.pushEditOperations([new Ge.Y(i.lineNumber,i.column,i.lineNumber,i.column)],[s],()=>[]),!0}return!1}getEdits({value:e,jsonPath:t},i,r){return t.length?(0,$e.Hn)(i,t,e,r):[{content:JSON.stringify(e,null,r.insertSpaces&&r.tabSize?" ".repeat(r.tabSize):"\t"),length:i.length,offset:0}]}getFormattingOptions(e){const{insertSpaces:t,tabSize:i}=e.getOptions();return{insertSpaces:t,tabSize:i,eol:e.getEOL()}}onError(e,t,i){var r=this;return(0,c.Z)(function*(){switch(e.code){case 11:r.onInvalidConfigurationError(e,t);break;case 9:r.onConfigurationFileDirtyError(e,t,i);break;case 10:return r.doWriteConfiguration(t,{scopes:i,handleDirtyFile:"revert"});default:r.notificationService.error(e.message)}})()}onInvalidConfigurationError(e,t){const i=t.workspaceStandAloneConfigurationKey===v.QN?l.NC("openTasksConfiguration","Open Tasks Configuration"):t.workspaceStandAloneConfigurationKey===v.Bf?l.NC("openLaunchConfiguration","Open Launch Configuration"):null;this.notificationService.prompt(z.zb.Error,e.message,i?[{label:i,run:()=>this.openFile(t.resource)}]:[{label:l.NC("open","Open Settings"),run:()=>this.openSettings(t)}])}onConfigurationFileDirtyError(e,t,i){const r=t.workspaceStandAloneConfigurationKey===v.QN?l.NC("openTasksConfiguration","Open Tasks Configuration"):t.workspaceStandAloneConfigurationKey===v.Bf?l.NC("openLaunchConfiguration","Open Launch Configuration"):null;this.notificationService.prompt(z.zb.Error,e.message,r?[{label:l.NC("saveAndRetry","Save and Retry"),run:()=>{this.writeConfiguration(t.target,{key:t.key?`${t.workspaceStandAloneConfigurationKey}.${t.key}`:t.workspaceStandAloneConfigurationKey,value:t.value},{handleDirtyFile:"save",scopes:i})}},{label:r,run:()=>this.openFile(t.resource)}]:[{label:l.NC("saveAndRetry","Save and Retry"),run:()=>this.writeConfiguration(t.target,{key:t.key,value:t.value},{handleDirtyFile:"save",scopes:i})},{label:l.NC("open","Open Settings"),run:()=>this.openSettings(t)}])}openSettings(e){const t={jsonEditor:!0};switch(e.target){case 1:this.preferencesService.openUserSettings(t);break;case 2:this.preferencesService.openRemoteSettings(t);break;case 3:this.preferencesService.openWorkspaceSettings(t);break;case 4:if(e.resource){const i=this.contextService.getWorkspaceFolder(e.resource);i&&this.preferencesService.openFolderSettings({folderUri:i.uri,jsonEditor:!0})}}}openFile(e){this.editorService.openEditor({resource:e,options:{pinned:!0}})}toConfigurationEditingError(e,t,i){const r=this.toErrorMessage(e,t,i);return new Xe(r,e)}toErrorMessage(e,t,i){switch(e){case 12:return l.NC("errorPolicyConfiguration","Unable to write {0} because it is configured in system policy.",i.key);case 0:return l.NC("errorUnknownKey","Unable to write to {0} because {1} is not a registered configuration.",this.stringifyTarget(t),i.key);case 1:return l.NC("errorInvalidWorkspaceConfigurationApplication","Unable to write {0} to Workspace Settings. This setting can be written only into User settings.",i.key);case 2:return l.NC("errorInvalidWorkspaceConfigurationMachine","Unable to write {0} to Workspace Settings. This setting can be written only into User settings.",i.key);case 3:return l.NC("errorInvalidFolderConfiguration","Unable to write to Folder Settings because {0} does not support the folder resource scope.",i.key);case 4:return l.NC("errorInvalidUserTarget","Unable to write to User Settings because {0} does not support for global scope.",i.key);case 5:return l.NC("errorInvalidWorkspaceTarget","Unable to write to Workspace Settings because {0} does not support for workspace scope in a multi folder workspace.",i.key);case 6:return l.NC("errorInvalidFolderTarget","Unable to write to Folder Settings because no resource is provided.");case 7:return l.NC("errorInvalidResourceLanguageConfiguration","Unable to write to Language Settings because {0} is not a resource language setting.",i.key);case 8:return l.NC("errorNoWorkspaceOpened","Unable to write to {0} because no workspace is opened. Please open a workspace first and try again.",this.stringifyTarget(t));case 11:if(i.workspaceStandAloneConfigurationKey===v.QN)return l.NC("errorInvalidTaskConfiguration","Unable to write into the tasks configuration file. Please open it to correct errors/warnings in it and try again.");if(i.workspaceStandAloneConfigurationKey===v.Bf)return l.NC("errorInvalidLaunchConfiguration","Unable to write into the launch configuration file. Please open it to correct errors/warnings in it and try again.");switch(t){case 1:return l.NC("errorInvalidConfiguration","Unable to write into user settings. Please open the user settings to correct errors/warnings in it and try again.");case 2:return l.NC("errorInvalidRemoteConfiguration","Unable to write into remote user settings. Please open the remote user settings to correct errors/warnings in it and try again.");case 3:return l.NC("errorInvalidConfigurationWorkspace","Unable to write into workspace settings. Please open the workspace settings to correct errors/warnings in the file and try again.");case 4:{let r="<<unknown>>";if(i.resource){const n=this.contextService.getWorkspaceFolder(i.resource);n&&(r=n.name)}return l.NC("errorInvalidConfigurationFolder","Unable to write into folder settings. Please open the '{0}' folder settings to correct errors/warnings in it and try again.",r)}default:return""}case 9:if(i.workspaceStandAloneConfigurationKey===v.QN)return l.NC("errorTasksConfigurationFileDirty","Unable to write into tasks configuration file because the file has unsaved changes. Please save it first and then try again.");if(i.workspaceStandAloneConfigurationKey===v.Bf)return l.NC("errorLaunchConfigurationFileDirty","Unable to write into launch configuration file because the file has unsaved changes. Please save it first and then try again.");switch(t){case 1:return l.NC("errorConfigurationFileDirty","Unable to write into user settings because the file has unsaved changes. Please save the user settings file first and then try again.");case 2:return l.NC("errorRemoteConfigurationFileDirty","Unable to write into remote user settings because the file has unsaved changes. Please save the remote user settings file first and then try again.");case 3:return l.NC("errorConfigurationFileDirtyWorkspace","Unable to write into workspace settings because the file has unsaved changes. Please save the workspace settings file first and then try again.");case 4:{let r="<<unknown>>";if(i.resource){const n=this.contextService.getWorkspaceFolder(i.resource);n&&(r=n.name)}return l.NC("errorConfigurationFileDirtyFolder","Unable to write into folder settings because the file has unsaved changes. Please save the '{0}' folder settings file first and then try again.",r)}default:return""}case 10:if(i.workspaceStandAloneConfigurationKey===v.QN)return l.NC("errorTasksConfigurationFileModifiedSince","Unable to write into tasks configuration file because the content of the file is newer.");if(i.workspaceStandAloneConfigurationKey===v.Bf)return l.NC("errorLaunchConfigurationFileModifiedSince","Unable to write into launch configuration file because the content of the file is newer.");switch(t){case 1:return l.NC("errorConfigurationFileModifiedSince","Unable to write into user settings because the content of the file is newer.");case 2:return l.NC("errorRemoteConfigurationFileModifiedSince","Unable to write into remote user settings because the content of the file is newer.");case 3:return l.NC("errorConfigurationFileModifiedSinceWorkspace","Unable to write into workspace settings because the content of the file is newer.");case 4:return l.NC("errorConfigurationFileModifiedSinceFolder","Unable to write into folder settings because the content of the file is newer.")}case 13:return l.NC("errorUnknown","Unable to write to {0} because of an internal error.",this.stringifyTarget(t))}}stringifyTarget(e){switch(e){case 1:return l.NC("userTarget","User Settings");case 2:return l.NC("remoteUserTarget","Remote User Settings");case 3:return l.NC("workspaceTarget","Workspace Settings");case 4:return l.NC("folderTarget","Folder Settings");default:return""}}defaultResourceValue(e){const t=this.uriIdentityService.extUri.basename(e);return t.substr(0,t.length-this.uriIdentityService.extUri.extname(e).length)===v.QN?v.iF:"{}"}resolveModelReference(e){var t=this;return(0,c.Z)(function*(){return(yield t.fileService.exists(e))||(yield t.textFileService.write(e,t.defaultResourceValue(e),{encoding:"utf8"})),t.textModelResolverService.createModelReference(e)})()}hasParseErrors(e,t){if(t.workspaceStandAloneConfigurationKey&&!t.key)return!1;const i=[];return Be.Qc(e,i,{allowTrailingComma:!0,allowEmptyContent:!0}),i.length>0}validate(e,t,i,r){var n=this;return(0,c.Z)(function*(){if(void 0!==n.configurationService.inspect(t.key).policyValue)throw n.toConfigurationEditingError(12,e,t);const s=I.B.as(C.IP.Configuration).getConfigurationProperties()[t.key]?.scope;if(!t.workspaceStandAloneConfigurationKey&&n.configurationService.keys().default.indexOf(t.key)<0&&!C.eU.test(t.key)&&void 0!==t.value)throw n.toConfigurationEditingError(0,e,t);if(t.workspaceStandAloneConfigurationKey&&t.workspaceStandAloneConfigurationKey!==v.QN&&(1===e||2===e))throw n.toConfigurationEditingError(4,e,t);if((3===e||4===e)&&1===n.contextService.getWorkbenchState())throw n.toConfigurationEditingError(8,e,t);if(3===e&&!t.workspaceStandAloneConfigurationKey&&!C.eU.test(t.key)){if(1===s)throw n.toConfigurationEditingError(1,e,t);if(2===s)throw n.toConfigurationEditingError(2,e,t)}if(4===e){if(!t.resource)throw n.toConfigurationEditingError(6,e,t);if(!t.workspaceStandAloneConfigurationKey&&!C.eU.test(t.key)&&void 0!==s&&!v.ao.includes(s))throw n.toConfigurationEditingError(3,e,t)}if(r.overrideIdentifiers?.length&&5!==s)throw n.toConfigurationEditingError(7,e,t);if(!t.resource)throw n.toConfigurationEditingError(6,e,t);if(i&&n.textFileService.isDirty(t.resource))throw n.toConfigurationEditingError(9,e,t)})()}getConfigurationEditOperation(e,t,i){if(t.key){const u=1===e?v.el:v.A6,d=Object.keys(u);for(const g of d){const W=this.getConfigurationFileResource(e,g,u[g],i.resource,void 0);if(t.key===g){const S=this.isWorkspaceConfigurationResource(W)?[g]:[];return{key:S[S.length-1],jsonPath:S,value:t.value,resource:(0,A.f6)(W),workspaceStandAloneConfigurationKey:g,target:e}}const b=`${g}.`;if(0===t.key.indexOf(b)){const S=this.isWorkspaceConfigurationResource(W)?[g,t.key.substr(b.length)]:[t.key.substr(b.length)];return{key:S[S.length-1],jsonPath:S,value:t.value,resource:(0,A.f6)(W),workspaceStandAloneConfigurationKey:g,target:e}}}}const r=t.key,o=I.B.as(C.IP.Configuration).getConfigurationProperties()[r]?.scope;let s=i.overrideIdentifiers?.length?[(0,C.np)(i.overrideIdentifiers),r]:[r];if(1===e||2===e)return{key:r,jsonPath:s,value:t.value,resource:(0,A.f6)(this.getConfigurationFileResource(e,void 0,"",null,o)),target:e};const a=this.getConfigurationFileResource(e,void 0,v.kd,i.resource,o);return this.isWorkspaceConfigurationResource(a)&&(s=["settings",...s]),{key:r,jsonPath:s,value:t.value,resource:(0,A.f6)(a),target:e}}isWorkspaceConfigurationResource(e){const t=this.contextService.getWorkspace();return!(!t.configuration||!e||t.configuration.fsPath!==e.fsPath)}getConfigurationFileResource(e,t,i,r,n){if(1===e)return t===v.QN?this.userDataProfileService.currentProfile.tasksResource:1!==n||this.userDataProfileService.currentProfile.isDefault?this.userDataProfileService.currentProfile.settingsResource:this.userDataProfilesService.defaultProfile.settingsResource;if(2===e)return this.remoteSettingsResource;const o=this.contextService.getWorkbenchState();if(1!==o){const s=this.contextService.getWorkspace();if(3===e){if(3===o)return(0,A.M2)(s.configuration);if(2===o)return s.folders[0].toResource(i)}if(4===e&&r){const a=this.contextService.getWorkspaceFolder(r);if(a)return a.toResource(i)}}return null}};oe=(0,h.gn)([(0,h.fM)(1,O.Ui),(0,h.fM)(2,k.ec),(0,h.fM)(3,ne.A),(0,h.fM)(4,_.lv),(0,h.fM)(5,N.sn),(0,h.fM)(6,Je.S),(0,h.fM)(7,We.MM),(0,h.fM)(8,z.lT),(0,h.fM)(9,Qe.UP),(0,h.fM)(10,Ye.AR),(0,h.fM)(11,G.v)],oe);var qe=f(86810),De=f(61604),P=f(70473);let et=(()=>{class p extends re.l0{constructor(t,i){super(),this.configurationCache=t,this.configurationRegistry=I.B.as(C.IP.Configuration),this.cachedConfigurationDefaultsOverrides={},this.cacheKey={type:"defaults",key:"configurationDefaultsOverrides"},this.updateCache=!1,i.options?.configurationDefaults&&this.configurationRegistry.registerDefaultConfigurations([{overrides:i.options.configurationDefaults}])}getConfigurationDefaultOverrides(){return this.cachedConfigurationDefaultsOverrides}initialize(){var t=()=>super.initialize,i=this;return(0,c.Z)(function*(){return yield i.initializeCachedConfigurationDefaultsOverrides(),t().call(i)})()}reload(){return this.updateCache=!0,this.cachedConfigurationDefaultsOverrides={},this.updateCachedConfigurationDefaultsOverrides(),super.reload()}hasCachedConfigurationDefaultsOverrides(){return!(0,A.Qr)(this.cachedConfigurationDefaultsOverrides)}initializeCachedConfigurationDefaultsOverrides(){var t=this;return this.initiaizeCachedConfigurationDefaultsOverridesPromise||(this.initiaizeCachedConfigurationDefaultsOverridesPromise=(0,c.Z)(function*(){try{if(window.localStorage.getItem(p.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY)){const i=yield t.configurationCache.read(t.cacheKey);i&&(t.cachedConfigurationDefaultsOverrides=JSON.parse(i))}}catch{}t.cachedConfigurationDefaultsOverrides=(0,A.Kn)(t.cachedConfigurationDefaultsOverrides)?t.cachedConfigurationDefaultsOverrides:{}})()),this.initiaizeCachedConfigurationDefaultsOverridesPromise}onDidUpdateConfiguration(t,i){super.onDidUpdateConfiguration(t,i),i&&this.updateCachedConfigurationDefaultsOverrides()}updateCachedConfigurationDefaultsOverrides(){var t=this;return(0,c.Z)(function*(){if(!t.updateCache)return;const i={},r=t.configurationRegistry.getConfigurationDefaultsOverrides();for(const[n,o]of r)!C.eU.test(n)&&void 0!==o.value&&(i[n]=o.value);try{Object.keys(i).length?(window.localStorage.setItem(p.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY,"yes"),yield t.configurationCache.write(t.cacheKey,JSON.stringify(i))):(window.localStorage.removeItem(p.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY),yield t.configurationCache.remove(t.cacheKey))}catch{}})()}}return p.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY="DefaultOverridesCacheExists",p})();class Pe extends w.JT{get hasTasksLoaded(){return this.userConfiguration.value instanceof X}constructor(e,t,i,r,n,o){super(),this.settingsResource=e,this.tasksResource=t,this.fileService=r,this.uriIdentityService=n,this.logService=o,this._onDidChangeConfiguration=this._register(new m.Q5),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this.userConfiguration=this._register(new w.XK),this.userConfigurationChangeDisposable=this._register(new w.XK),this.configurationParseOptions={scopes:i,skipRestricted:!1},this.userConfiguration.value=new y.PG(e,i,n.extUri,this.fileService),this.userConfigurationChangeDisposable.value=this.userConfiguration.value.onDidChange(()=>this.reloadConfigurationScheduler.schedule()),this.reloadConfigurationScheduler=this._register(new E.pY(()=>this.userConfiguration.value.loadConfiguration().then(s=>this._onDidChangeConfiguration.fire(s)),50))}reset(e,t,i){var r=this;return(0,c.Z)(function*(){r.settingsResource=e,r.tasksResource=t,r.configurationParseOptions={scopes:i,skipRestricted:!1};const n=r.uriIdentityService.extUri.dirname(r.settingsResource),o=r.tasksResource?[[v.QN,r.tasksResource]]:[],s=new X(n.toString(),r.settingsResource,o,r.configurationParseOptions,r.fileService,r.uriIdentityService,r.logService),a=yield s.loadConfiguration();return r.userConfiguration.value=s,r.userConfigurationChangeDisposable.value&&(r.userConfigurationChangeDisposable.value=r.userConfiguration.value.onDidChange(()=>r.reloadConfigurationScheduler.schedule())),a})()}initialize(){var e=this;return(0,c.Z)(function*(){return e.userConfiguration.value.loadConfiguration()})()}reload(){var e=this;return(0,c.Z)(function*(){return e.hasTasksLoaded?e.userConfiguration.value.loadConfiguration():e.reset(e.settingsResource,e.tasksResource,e.configurationParseOptions.scopes)})()}reparse(){return this.userConfiguration.value.reparse(this.configurationParseOptions)}getRestrictedSettings(){return this.userConfiguration.value.getRestrictedSettings()}}class X extends w.JT{constructor(e,t,i,r,n,o,s){super(),this.settingsResource=t,this.standAloneConfigurationResources=i,this.fileService=n,this.uriIdentityService=o,this.logService=s,this._onDidChange=this._register(new m.Q5),this.onDidChange=this._onDidChange.event,this.allResources=[this.settingsResource,...this.standAloneConfigurationResources.map(([,a])=>a)],this._register((0,w.F8)(...this.allResources.map(a=>(0,w.F8)(this.fileService.watch(o.extUri.dirname(a)),this.fileService.watch(a))))),this._folderSettingsModelParser=new y.wU(e),this._folderSettingsParseOptions=r,this._standAloneConfigurations=[],this._cache=new y.VV,this._register(m.ju.debounce(m.ju.any(m.ju.filter(this.fileService.onDidFilesChange,a=>this.handleFileChangesEvent(a)),m.ju.filter(this.fileService.onDidRunOperation,a=>this.handleFileOperationEvent(a))),()=>{},100)(()=>this._onDidChange.fire()))}resolveContents(){var e=this;return(0,c.Z)(function*(){const t=function(){var n=(0,c.Z)(function*(o){return Promise.all(o.map(function(){var s=(0,c.Z)(function*(a){try{return(yield e.fileService.readFile(a)).value.toString()}catch(u){e.logService.trace(`Error while resolving configuration file '${a.toString()}': ${qe.e$(u)}`),1!==u.fileOperationResult&&9!==u.fileOperationResult&&e.logService.error(u)}return"{}"});return function(a){return s.apply(this,arguments)}}()))});return function(s){return n.apply(this,arguments)}}(),[[i],r]=yield Promise.all([t([e.settingsResource]),t(e.standAloneConfigurationResources.map(([,n])=>n))]);return[i,r.map((n,o)=>[e.standAloneConfigurationResources[o][0],n])]})()}loadConfiguration(){var e=this;return(0,c.Z)(function*(){const[t,i]=yield e.resolveContents();e._standAloneConfigurations=[],e._folderSettingsModelParser.parse("",e._folderSettingsParseOptions),void 0!==t&&e._folderSettingsModelParser.parse(t,e._folderSettingsParseOptions);for(let r=0;r<i.length;r++){const n=i[r][1];if(void 0!==n){const o=new me(e.standAloneConfigurationResources[r][1].toString(),e.standAloneConfigurationResources[r][0]);o.parse(n),e._standAloneConfigurations.push(o.configurationModel)}}return e.consolidate(),e._cache})()}getRestrictedSettings(){return this._folderSettingsModelParser.restrictedConfigurations}reparse(e){const t=this._folderSettingsModelParser.configurationModel.contents;return this._folderSettingsParseOptions=e,this._folderSettingsModelParser.reparse(this._folderSettingsParseOptions),(0,V.fS)(t,this._folderSettingsModelParser.configurationModel.contents)||this.consolidate(),this._cache}consolidate(){this._cache=this._folderSettingsModelParser.configurationModel.merge(...this._standAloneConfigurations)}handleFileChangesEvent(e){return!(!this.allResources.some(t=>e.contains(t))&&!this.allResources.some(t=>e.contains(this.uriIdentityService.extUri.dirname(t),2)))}handleFileOperationEvent(e){return!!((e.isOperation(0)||e.isOperation(3)||e.isOperation(1)||e.isOperation(4))&&this.allResources.some(t=>this.uriIdentityService.extUri.isEqual(e.resource,t))||e.isOperation(1)&&this.allResources.some(t=>this.uriIdentityService.extUri.isEqual(e.resource,this.uriIdentityService.extUri.dirname(t))))}}class tt extends w.JT{constructor(e,t,i,r,n){var o;super(),o=this,this._userConfigurationInitializationPromise=null,this._onDidChangeConfiguration=this._register(new m.Q5),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._onDidInitialize=this._register(new m.Q5),this.onDidInitialize=this._onDidInitialize.event,this._fileService=i,this._userConfiguration=this._cachedConfiguration=new it(e,t,{scopes:v.ec}),n.getEnvironment().then(function(){var s=(0,c.Z)(function*(a){if(a){const u=o._register(new se(a.settingsPath,{scopes:v.ec},o._fileService,r));o._register(u.onDidChangeConfiguration(g=>o.onDidUserConfigurationChange(g))),o._userConfigurationInitializationPromise=u.initialize();const d=yield o._userConfigurationInitializationPromise;o._userConfiguration.dispose(),o._userConfiguration=u,o.onDidUserConfigurationChange(d),o._onDidInitialize.fire(d)}});return function(a){return s.apply(this,arguments)}}())}initialize(){var e=this;return(0,c.Z)(function*(){if(e._userConfiguration instanceof se)return e._userConfiguration.initialize();let t=yield e._userConfiguration.initialize();return e._userConfigurationInitializationPromise&&(t=yield e._userConfigurationInitializationPromise,e._userConfigurationInitializationPromise=null),t})()}reload(){return this._userConfiguration.reload()}reparse(){return this._userConfiguration.reparse({scopes:v.ec})}getRestrictedSettings(){return this._userConfiguration.getRestrictedSettings()}onDidUserConfigurationChange(e){this.updateCache(),this._onDidChangeConfiguration.fire(e)}updateCache(){var e=this;return(0,c.Z)(function*(){if(e._userConfiguration instanceof se){let t;try{t=yield e._userConfiguration.resolveContent()}catch(i){if(1!==i.fileOperationResult)return}yield e._cachedConfiguration.updateConfiguration(t)}})()}}class se extends w.JT{constructor(e,t,i,r){super(),this.configurationResource=e,this.fileService=i,this.uriIdentityService=r,this._onDidChangeConfiguration=this._register(new m.Q5),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this.fileWatcherDisposable=w.JT.None,this.directoryWatcherDisposable=w.JT.None,this.parser=new y.wU(this.configurationResource.toString()),this.parseOptions=t,this._register(i.onDidFilesChange(n=>this.handleFileChangesEvent(n))),this._register(i.onDidRunOperation(n=>this.handleFileOperationEvent(n))),this.reloadConfigurationScheduler=this._register(new E.pY(()=>this.reload().then(n=>this._onDidChangeConfiguration.fire(n)),50)),this._register((0,w.OF)(()=>{this.stopWatchingResource(),this.stopWatchingDirectory()}))}watchResource(){this.fileWatcherDisposable=this.fileService.watch(this.configurationResource)}stopWatchingResource(){this.fileWatcherDisposable.dispose(),this.fileWatcherDisposable=w.JT.None}watchDirectory(){const e=this.uriIdentityService.extUri.dirname(this.configurationResource);this.directoryWatcherDisposable=this.fileService.watch(e)}stopWatchingDirectory(){this.directoryWatcherDisposable.dispose(),this.directoryWatcherDisposable=w.JT.None}initialize(){var e=this;return(0,c.Z)(function*(){const t=yield e.fileService.exists(e.configurationResource);return e.onResourceExists(t),e.reload()})()}resolveContent(){var e=this;return(0,c.Z)(function*(){return(yield e.fileService.readFile(e.configurationResource)).value.toString()})()}reload(){var e=this;return(0,c.Z)(function*(){try{const t=yield e.resolveContent();return e.parser.parse(t,e.parseOptions),e.parser.configurationModel}catch{return new y.VV}})()}reparse(e){return this.parseOptions=e,this.parser.reparse(this.parseOptions),this.parser.configurationModel}getRestrictedSettings(){return this.parser.restrictedConfigurations}handleFileChangesEvent(e){let t=e.contains(this.configurationResource,0);e.contains(this.configurationResource,1)?(t=!0,this.onResourceExists(!0)):e.contains(this.configurationResource,2)&&(t=!0,this.onResourceExists(!1)),t&&this.reloadConfigurationScheduler.schedule()}handleFileOperationEvent(e){(e.isOperation(0)||e.isOperation(3)||e.isOperation(1)||e.isOperation(4))&&this.uriIdentityService.extUri.isEqual(e.resource,this.configurationResource)&&this.reloadConfigurationScheduler.schedule()}onResourceExists(e){e?(this.stopWatchingDirectory(),this.watchResource()):(this.stopWatchingResource(),this.watchDirectory())}}class it extends w.JT{constructor(e,t,i){super(),this.configurationCache=t,this._onDidChange=this._register(new m.Q5),this.onDidChange=this._onDidChange.event,this.key={type:"user",key:e},this.parser=new y.wU("CachedRemoteUserConfiguration"),this.parseOptions=i,this.configurationModel=new y.VV}getConfigurationModel(){return this.configurationModel}initialize(){return this.reload()}reparse(e){return this.parseOptions=e,this.parser.reparse(this.parseOptions),this.configurationModel=this.parser.configurationModel,this.configurationModel}getRestrictedSettings(){return this.parser.restrictedConfigurations}reload(){var e=this;return(0,c.Z)(function*(){try{const t=yield e.configurationCache.read(e.key),i=JSON.parse(t);i.content&&(e.parser.parse(i.content,e.parseOptions),e.configurationModel=e.parser.configurationModel)}catch{}return e.configurationModel})()}updateConfiguration(e){var t=this;return(0,c.Z)(function*(){return e?t.configurationCache.write(t.key,JSON.stringify({content:e})):t.configurationCache.remove(t.key)})()}}class rt extends w.JT{get initialized(){return this._initialized}constructor(e,t,i,r){super(),this.configurationCache=e,this.fileService=t,this.uriIdentityService=i,this.logService=r,this._workspaceConfigurationDisposables=this._register(new w.SL),this._workspaceIdentifier=null,this._isWorkspaceTrusted=!1,this._onDidUpdateConfiguration=this._register(new m.Q5),this.onDidUpdateConfiguration=this._onDidUpdateConfiguration.event,this._initialized=!1,this.fileService=t,this._workspaceConfiguration=this._cachedConfiguration=new nt(e)}initialize(e,t){var i=this;return(0,c.Z)(function*(){i._workspaceIdentifier=e,i._isWorkspaceTrusted=t,i._initialized||(i.configurationCache.needsCaching(i._workspaceIdentifier.configPath)?(i._workspaceConfiguration=i._cachedConfiguration,i.waitAndInitialize(i._workspaceIdentifier)):i.doInitialize(new q(i.fileService,i.uriIdentityService,i.logService))),yield i.reload()})()}reload(){var e=this;return(0,c.Z)(function*(){e._workspaceIdentifier&&(yield e._workspaceConfiguration.load(e._workspaceIdentifier,{scopes:v.G,skipRestricted:e.isUntrusted()}))})()}getFolders(){return this._workspaceConfiguration.getFolders()}setFolders(e,t){return this._workspaceIdentifier?t.write(this._workspaceIdentifier.configPath,[{path:["folders"],value:e}],!0).then(()=>this.reload()):Promise.resolve()}isTransient(){return this._workspaceConfiguration.isTransient()}getConfiguration(){return this._workspaceConfiguration.getWorkspaceSettings()}updateWorkspaceTrust(e){return this._isWorkspaceTrusted=e,this.reparseWorkspaceSettings()}reparseWorkspaceSettings(){return this._workspaceConfiguration.reparseWorkspaceSettings({scopes:v.G,skipRestricted:this.isUntrusted()}),this.getConfiguration()}getRestrictedSettings(){return this._workspaceConfiguration.getRestrictedSettings()}waitAndInitialize(e){var t=this;return(0,c.Z)(function*(){if(yield(0,N.vP)(e.configPath,t.fileService),!(t._workspaceConfiguration instanceof q)){const i=t._register(new q(t.fileService,t.uriIdentityService,t.logService));yield i.load(e,{scopes:v.G,skipRestricted:t.isUntrusted()}),t.doInitialize(i),t.onDidWorkspaceConfigurationChange(!1,!0)}})()}doInitialize(e){this._workspaceConfigurationDisposables.clear(),this._workspaceConfiguration=this._workspaceConfigurationDisposables.add(e),this._workspaceConfigurationDisposables.add(this._workspaceConfiguration.onDidChange(t=>this.onDidWorkspaceConfigurationChange(!0,!1))),this._initialized=!0}isUntrusted(){return!this._isWorkspaceTrusted}onDidWorkspaceConfigurationChange(e,t){var i=this;return(0,c.Z)(function*(){e&&(yield i.reload()),i.updateCache(),i._onDidUpdateConfiguration.fire(t)})()}updateCache(){var e=this;return(0,c.Z)(function*(){if(e._workspaceIdentifier&&e.configurationCache.needsCaching(e._workspaceIdentifier.configPath)&&e._workspaceConfiguration instanceof q){const t=yield e._workspaceConfiguration.resolveContent(e._workspaceIdentifier);yield e._cachedConfiguration.updateWorkspace(e._workspaceIdentifier,t)}})()}}class q extends w.JT{constructor(e,t,i){super(),this.fileService=e,this.logService=i,this._workspaceIdentifier=null,this._onDidChange=this._register(new m.Q5),this.onDidChange=this._onDidChange.event,this.workspaceConfigurationModelParser=new H(""),this.workspaceSettings=new y.VV,this._register(m.ju.any(m.ju.filter(this.fileService.onDidFilesChange,r=>!!this._workspaceIdentifier&&r.contains(this._workspaceIdentifier.configPath)),m.ju.filter(this.fileService.onDidRunOperation,r=>!!this._workspaceIdentifier&&(r.isOperation(0)||r.isOperation(3)||r.isOperation(1)||r.isOperation(4))&&t.extUri.isEqual(r.resource,this._workspaceIdentifier.configPath)))(()=>this.reloadConfigurationScheduler.schedule())),this.reloadConfigurationScheduler=this._register(new E.pY(()=>this._onDidChange.fire(),50)),this.workspaceConfigWatcher=this._register(this.watchWorkspaceConfigurationFile())}get workspaceIdentifier(){return this._workspaceIdentifier}resolveContent(e){var t=this;return(0,c.Z)(function*(){return(yield t.fileService.readFile(e.configPath)).value.toString()})()}load(e,t){var i=this;return(0,c.Z)(function*(){(!i._workspaceIdentifier||i._workspaceIdentifier.id!==e.id)&&(i._workspaceIdentifier=e,i.workspaceConfigurationModelParser=new H(i._workspaceIdentifier.id),(0,w.B9)(i.workspaceConfigWatcher),i.workspaceConfigWatcher=i._register(i.watchWorkspaceConfigurationFile()));let r="";try{r=yield i.resolveContent(i._workspaceIdentifier)}catch(n){(yield i.fileService.exists(i._workspaceIdentifier.configPath))&&i.logService.error(n)}i.workspaceConfigurationModelParser.parse(r,t),i.consolidate()})()}getConfigurationModel(){return this.workspaceConfigurationModelParser.configurationModel}getFolders(){return this.workspaceConfigurationModelParser.folders}isTransient(){return this.workspaceConfigurationModelParser.transient}getWorkspaceSettings(){return this.workspaceSettings}reparseWorkspaceSettings(e){return this.workspaceConfigurationModelParser.reparseWorkspaceSettings(e),this.consolidate(),this.getWorkspaceSettings()}getRestrictedSettings(){return this.workspaceConfigurationModelParser.getRestrictedWorkspaceSettings()}consolidate(){this.workspaceSettings=this.workspaceConfigurationModelParser.settingsModel.merge(this.workspaceConfigurationModelParser.launchModel,this.workspaceConfigurationModelParser.tasksModel)}watchWorkspaceConfigurationFile(){return this._workspaceIdentifier?this.fileService.watch(this._workspaceIdentifier.configPath):w.JT.None}}class nt{constructor(e){this.configurationCache=e,this.onDidChange=m.ju.None,this.workspaceConfigurationModelParser=new H(""),this.workspaceSettings=new y.VV}load(e,t){var i=this;return(0,c.Z)(function*(){try{const r=i.getKey(e),n=yield i.configurationCache.read(r),o=JSON.parse(n);o.content&&(i.workspaceConfigurationModelParser=new H(r.key),i.workspaceConfigurationModelParser.parse(o.content,t),i.consolidate())}catch{}})()}get workspaceIdentifier(){return null}getConfigurationModel(){return this.workspaceConfigurationModelParser.configurationModel}getFolders(){return this.workspaceConfigurationModelParser.folders}isTransient(){return this.workspaceConfigurationModelParser.transient}getWorkspaceSettings(){return this.workspaceSettings}reparseWorkspaceSettings(e){return this.workspaceConfigurationModelParser.reparseWorkspaceSettings(e),this.consolidate(),this.getWorkspaceSettings()}getRestrictedSettings(){return this.workspaceConfigurationModelParser.getRestrictedWorkspaceSettings()}consolidate(){this.workspaceSettings=this.workspaceConfigurationModelParser.settingsModel.merge(this.workspaceConfigurationModelParser.launchModel,this.workspaceConfigurationModelParser.tasksModel)}updateWorkspace(e,t){var i=this;return(0,c.Z)(function*(){try{const r=i.getKey(e);t?yield i.configurationCache.write(r,JSON.stringify({content:t})):yield i.configurationCache.remove(r)}catch{}})()}getKey(e){return{type:"workspaces",key:e.id}}}class ot{constructor(e,t,i,r){this.configurationCache=r,this.onDidChange=m.ju.None,this.key={type:"folder",key:(0,De.vp)((0,P.Vo)(e,t).toString()).toString(16)},this._folderSettingsModelParser=new y.wU("CachedFolderConfiguration"),this._folderSettingsParseOptions=i,this._standAloneConfigurations=[],this.configurationModel=new y.VV}loadConfiguration(){var e=this;return(0,c.Z)(function*(){try{const t=yield e.configurationCache.read(e.key),{content:i}=JSON.parse(t.toString());if(i)for(const r of Object.keys(i))if(r===v.l3)e._folderSettingsModelParser.parse(i[r],e._folderSettingsParseOptions);else{const n=new me(r,r);n.parse(i[r]),e._standAloneConfigurations.push(n.configurationModel)}e.consolidate()}catch{}return e.configurationModel})()}updateConfiguration(e,t){var i=this;return(0,c.Z)(function*(){const r={};e&&(r[v.l3]=e),t.forEach(([n,o])=>{o&&(r[n]=o)}),Object.keys(r).length?yield i.configurationCache.write(i.key,JSON.stringify({content:r})):yield i.configurationCache.remove(i.key)})()}getRestrictedSettings(){return this._folderSettingsModelParser.restrictedConfigurations}reparse(e){return this._folderSettingsParseOptions=e,this._folderSettingsModelParser.reparse(this._folderSettingsParseOptions),this.consolidate(),this.configurationModel}consolidate(){this.configurationModel=this._folderSettingsModelParser.configurationModel.merge(...this._standAloneConfigurations)}getUnsupportedKeys(){return[]}}class st extends w.JT{constructor(e,t,i,r,n,o,s,a,u){super(),this.workspaceFolder=t,this.workbenchState=r,this.workspaceTrusted=n,this.configurationCache=u,this._onDidChange=this._register(new m.Q5),this.onDidChange=this._onDidChange.event,this.scopes=3===this.workbenchState?v.ao:v.G,this.configurationFolder=s.extUri.joinPath(t.uri,i),this.cachedFolderConfiguration=new ot(t.uri,i,{scopes:this.scopes,skipRestricted:this.isUntrusted()},u),e&&this.configurationCache.needsCaching(t.uri)?(this.folderConfiguration=this.cachedFolderConfiguration,(0,N.vP)(t.uri,o).then(()=>{this.folderConfiguration=this._register(this.createFileServiceBasedConfiguration(o,s,a)),this._register(this.folderConfiguration.onDidChange(d=>this.onDidFolderConfigurationChange())),this.onDidFolderConfigurationChange()})):(this.folderConfiguration=this._register(this.createFileServiceBasedConfiguration(o,s,a)),this._register(this.folderConfiguration.onDidChange(d=>this.onDidFolderConfigurationChange())))}loadConfiguration(){return this.folderConfiguration.loadConfiguration()}updateWorkspaceTrust(e){return this.workspaceTrusted=e,this.reparse()}reparse(){const e=this.folderConfiguration.reparse({scopes:this.scopes,skipRestricted:this.isUntrusted()});return this.updateCache(),e}getRestrictedSettings(){return this.folderConfiguration.getRestrictedSettings()}isUntrusted(){return!this.workspaceTrusted}onDidFolderConfigurationChange(){this.updateCache(),this._onDidChange.fire()}createFileServiceBasedConfiguration(e,t,i){const r=t.extUri.joinPath(this.configurationFolder,`${v.l3}.json`),n=[v.QN,v.Bf].map(o=>[o,t.extUri.joinPath(this.configurationFolder,`${o}.json`)]);return new X(this.configurationFolder.toString(),r,n,{scopes:this.scopes,skipRestricted:this.isUntrusted()},e,t,i)}updateCache(){var e=this;return(0,c.Z)(function*(){if(e.configurationCache.needsCaching(e.configurationFolder)&&e.folderConfiguration instanceof X){const[t,i]=yield e.folderConfiguration.resolveContents();e.cachedFolderConfiguration.updateConfiguration(t,i)}})()}}var K=f(31337),$=f(9590),at=f(94014),Fe=f(89488),ct=f(98179),be=f(35837),ut=f(69486),Ue=f(62334),lt=f(42605),J=f(71871),Ee=f(22781);function Me(p,e){return p.isDefault?e?v.eZ:void 0:e?v.qz:v.eS}class ae extends k.j${constructor(){super(...arguments),this.initialized=!1}}class ft extends w.JT{get restrictedSettings(){return this._restrictedSettings}constructor({remoteAuthority:e,configurationCache:t},i,r,n,o,s,a,u,d){if(super(),this.userDataProfileService=r,this.userDataProfilesService=n,this.fileService=o,this.remoteAgentService=s,this.uriIdentityService=a,this.logService=u,this.initialized=!1,this.applicationConfiguration=null,this.remoteUserConfiguration=null,this._onDidChangeConfiguration=this._register(new m.Q5),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._onWillChangeWorkspaceFolders=this._register(new m.Q5),this.onWillChangeWorkspaceFolders=this._onWillChangeWorkspaceFolders.event,this._onDidChangeWorkspaceFolders=this._register(new m.Q5),this.onDidChangeWorkspaceFolders=this._onDidChangeWorkspaceFolders.event,this._onDidChangeWorkspaceName=this._register(new m.Q5),this.onDidChangeWorkspaceName=this._onDidChangeWorkspaceName.event,this._onDidChangeWorkbenchState=this._register(new m.Q5),this.onDidChangeWorkbenchState=this._onDidChangeWorkbenchState.event,this.isWorkspaceTrusted=!0,this._restrictedSettings={default:[]},this._onDidChangeRestrictedSettings=this._register(new m.Q5),this.onDidChangeRestrictedSettings=this._onDidChangeRestrictedSettings.event,this.configurationRegistry=I.B.as(C.IP.Configuration),this.initRemoteUserConfigurationBarrier=new E.U8,this.completeWorkspaceBarrier=new E.U8,this.defaultConfiguration=this._register(new et(t,i)),this.policyConfiguration=d instanceof Ue.j7?new re.ET:this._register(new re.im(this.defaultConfiguration,d,u)),this.configurationCache=t,this._configuration=new we(this.defaultConfiguration.configurationModel,this.policyConfiguration.configurationModel,new y.VV,new y.VV,new y.VV,new y.VV,new L.Y9,new y.VV,new L.Y9,this.workspace),this.applicationConfigurationDisposables=this._register(new w.SL),this.createApplicationConfiguration(),this.localUserConfiguration=this._register(new Pe(r.currentProfile.settingsResource,r.currentProfile.tasksResource,Me(r.currentProfile,!!e),o,a,u)),this.cachedFolderConfigs=new L.Y9,this._register(this.localUserConfiguration.onDidChangeConfiguration(g=>this.onLocalUserConfigurationChanged(g))),e){const g=this.remoteUserConfiguration=this._register(new tt(e,t,o,a,s));this._register(g.onDidInitialize(W=>{this._register(g.onDidChangeConfiguration(b=>this.onRemoteUserConfigurationChanged(b))),this.onRemoteUserConfigurationChanged(W),this.initRemoteUserConfigurationBarrier.open()}))}else this.initRemoteUserConfigurationBarrier.open();this.workspaceConfiguration=this._register(new rt(t,o,a,u)),this._register(this.workspaceConfiguration.onDidUpdateConfiguration(g=>{this.onWorkspaceConfigurationChanged(g).then(()=>{this.workspace.initialized=this.workspaceConfiguration.initialized,this.checkAndMarkWorkspaceComplete(g)})})),this._register(this.defaultConfiguration.onDidChangeConfiguration(({properties:g,defaults:W})=>this.onDefaultConfigurationChanged(W,g))),this._register(this.policyConfiguration.onDidChangeConfiguration(g=>this.onPolicyConfigurationChanged(g))),this._register(r.onDidChangeCurrentProfile(g=>this.onUserDataProfileChanged(g))),this.workspaceEditingQueue=new E.ci}createApplicationConfiguration(){this.applicationConfigurationDisposables.clear(),this.userDataProfileService.currentProfile.isDefault?this.applicationConfiguration=null:(this.applicationConfiguration=this.applicationConfigurationDisposables.add(this._register(new Pe(this.userDataProfilesService.defaultProfile.settingsResource,void 0,[1],this.fileService,this.uriIdentityService,this.logService))),this.applicationConfigurationDisposables.add(this.applicationConfiguration.onDidChangeConfiguration(e=>this.onApplicationConfigurationChanged(e))))}getCompleteWorkspace(){var e=this;return(0,c.Z)(function*(){return yield e.completeWorkspaceBarrier.wait(),e.getWorkspace()})()}getWorkspace(){return this.workspace}getWorkbenchState(){return this.workspace.configuration?3:1===this.workspace.folders.length?2:1}getWorkspaceFolder(e){return this.workspace.getFolder(e)}addFolders(e,t){return this.updateFolders(e,[],t)}removeFolders(e){return this.updateFolders([],e)}updateFolders(e,t,i){var r=this;return(0,c.Z)(function*(){return r.workspaceEditingQueue.queue(()=>r.doUpdateFolders(e,t,i))})()}isInsideWorkspace(e){return!!this.getWorkspaceFolder(e)}isCurrentWorkspace(e){switch(this.getWorkbenchState()){case 2:{let t;return Z.ov.isUri(e)?t=e:(0,k.eb)(e)&&(t=e.uri),Z.ov.isUri(t)&&this.uriIdentityService.extUri.isEqual(t,this.workspace.folders[0].uri)}case 3:return(0,k.NI)(e)&&this.workspace.id===e.id}return!1}doUpdateFolders(e,t,i){var r=this;return(0,c.Z)(function*(){if(3!==r.getWorkbenchState()||e.length+t.length===0)return Promise.resolve(void 0);let n=!1,o=r.getWorkspace().folders,s=o.map(a=>a.raw).filter((a,u)=>!(0,D.S$)(a)||!r.contains(t,o[u].uri));if(n=o.length!==s.length,e.length){const a=r.getWorkspace().configuration,u=r.uriIdentityService.extUri.dirname(a);o=(0,D.UD)(s,a,r.uriIdentityService.extUri);const d=o.map(W=>W.uri),g=[];for(const W of e){const b=W.uri;if(!r.contains(d,b)){try{if(!(yield r.fileService.stat(b)).isDirectory)continue}catch{}g.push((0,D.l0)(b,!1,W.name,u,r.uriIdentityService.extUri))}}g.length>0&&(n=!0,"number"==typeof i&&i>=0&&i<s.length?(s=s.slice(0),s.splice(i,0,...g)):s=[...s,...g])}return n?r.setFolders(s):Promise.resolve(void 0)})()}setFolders(e){var t=this;return(0,c.Z)(function*(){if(!t.instantiationService)throw new Error("Cannot update workspace folders because workspace service is not yet ready to accept writes.");return yield t.instantiationService.invokeFunction(i=>t.workspaceConfiguration.setFolders(e,i.get(Ee.R))),t.onWorkspaceConfigurationChanged(!1)})()}contains(e,t){return e.some(i=>this.uriIdentityService.extUri.isEqual(i,t))}getConfigurationData(){return this._configuration.toData()}getValue(e,t){const i="string"==typeof e?e:void 0,r=(0,O.Rw)(e)?e:(0,O.Rw)(t)?t:void 0;return this._configuration.getValue(i,r)}updateValue(e,t,i,r,n){var o=this;return(0,c.Z)(function*(){const s=(0,O.BG)(i)?i:(0,O.Rw)(i)?{resource:i.resource,overrideIdentifiers:i.overrideIdentifier?[i.overrideIdentifier]:void 0}:void 0,a=s?r:i,u=a?[a]:[];if(s?.overrideIdentifiers&&(s.overrideIdentifiers=(0,M.EB)(s.overrideIdentifiers),s.overrideIdentifiers=s.overrideIdentifiers.length?s.overrideIdentifiers:void 0),!u.length){if(s?.overrideIdentifiers&&s.overrideIdentifiers.length>1)throw new Error("Configuration Target is required while updating the value for multiple override identifiers");const d=o.inspect(e,{resource:s?.resource,overrideIdentifier:s?.overrideIdentifiers?s.overrideIdentifiers[0]:void 0});u.push(...o.deriveConfigurationTargets(e,t,d)),(0,V.fS)(t,d.defaultValue)&&1===u.length&&(2===u[0]||3===u[0])&&(t=void 0)}yield E.jT.settled(u.map(d=>o.writeConfigurationValue(e,t,d,s,n)))})()}reloadConfiguration(e){var t=this;return(0,c.Z)(function*(){if(void 0===e){t.reloadDefaultConfiguration();const i=yield t.reloadApplicationConfiguration(!0),{local:r,remote:n}=yield t.reloadUserConfiguration();return yield t.reloadWorkspaceConfiguration(),void(yield t.loadConfiguration(i,r,n,!0))}if((0,k.dV)(e))yield t.reloadWorkspaceFolderConfiguration(e);else switch(e){case 7:return void t.reloadDefaultConfiguration();case 2:{const{local:i,remote:r}=yield t.reloadUserConfiguration();return void(yield t.loadConfiguration(t._configuration.applicationConfiguration,i,r,!0))}case 3:return void(yield t.reloadLocalUserConfiguration());case 4:return void(yield t.reloadRemoteUserConfiguration());case 5:case 6:return void(yield t.reloadWorkspaceConfiguration())}})()}hasCachedConfigurationDefaultsOverrides(){return this.defaultConfiguration.hasCachedConfigurationDefaultsOverrides()}inspect(e,t){return this._configuration.inspect(e,t)}keys(){return this._configuration.keys()}whenRemoteConfigurationLoaded(){var e=this;return(0,c.Z)(function*(){yield e.initRemoteUserConfigurationBarrier.wait()})()}initialize(e){var t=this;return(0,c.Z)(function*(){(0,K.B)("code/willInitWorkspaceService");const i=t.initialized;t.initialized=!1;const r=yield t.createWorkspace(e);yield t.updateWorkspaceAndInitializeConfiguration(r,i),t.checkAndMarkWorkspaceComplete(!1),(0,K.B)("code/didInitWorkspaceService")})()}updateWorkspaceTrust(e){if(this.isWorkspaceTrusted!==e){this.isWorkspaceTrusted=e;const t=this._configuration.toData(),i=[];for(const n of this.workspace.folders){const o=this.cachedFolderConfigs.get(n.uri);let s;o&&(s=o.updateWorkspaceTrust(this.isWorkspaceTrusted),this._configuration.updateFolderConfiguration(n.uri,s)),i.push(s)}2===this.getWorkbenchState()?i[0]&&this._configuration.updateWorkspaceConfiguration(i[0]):this._configuration.updateWorkspaceConfiguration(this.workspaceConfiguration.updateWorkspaceTrust(this.isWorkspaceTrusted)),this.updateRestrictedSettings();let r=[];this.restrictedSettings.userLocal&&r.push(...this.restrictedSettings.userLocal),this.restrictedSettings.userRemote&&r.push(...this.restrictedSettings.userRemote),this.restrictedSettings.workspace&&r.push(...this.restrictedSettings.workspace),this.restrictedSettings.workspaceFolder?.forEach(n=>r.push(...n)),r=(0,M.EB)(r),r.length&&this.triggerConfigurationChange({keys:r,overrides:[]},{data:t,workspace:this.workspace},5)}}acquireInstantiationService(e){this.instantiationService=e}createWorkspace(e){var t=this;return(0,c.Z)(function*(){return(0,k.NI)(e)?t.createMultiFolderWorkspace(e):(0,k.eb)(e)?t.createSingleFolderWorkspace(e):t.createEmptyWorkspace(e)})()}createMultiFolderWorkspace(e){var t=this;return(0,c.Z)(function*(){yield t.workspaceConfiguration.initialize({id:e.id,configPath:e.configPath},t.isWorkspaceTrusted);const i=e.configPath,r=(0,D.UD)(t.workspaceConfiguration.getFolders(),i,t.uriIdentityService.extUri),o=new ae(e.id,r,t.workspaceConfiguration.isTransient(),i,s=>t.uriIdentityService.extUri.ignorePathCasing(s));return o.initialized=t.workspaceConfiguration.initialized,o})()}createSingleFolderWorkspace(e){const t=new ae(e.id,[(0,k.fY)(e.uri)],!1,null,i=>this.uriIdentityService.extUri.ignorePathCasing(i));return t.initialized=!0,t}createEmptyWorkspace(e){const t=new ae(e.id,[],!1,null,i=>this.uriIdentityService.extUri.ignorePathCasing(i));return t.initialized=!0,Promise.resolve(t)}checkAndMarkWorkspaceComplete(e){!this.completeWorkspaceBarrier.isOpen()&&this.workspace.initialized&&(this.completeWorkspaceBarrier.open(),this.validateWorkspaceFoldersAndReload(e))}updateWorkspaceAndInitializeConfiguration(e,t){var i=this;return(0,c.Z)(function*(){const r=!!i.workspace;let n,o,s=[];if(r?(n=i.getWorkbenchState(),o=i.workspace.configuration?i.workspace.configuration.fsPath:void 0,s=i.workspace.folders,i.workspace.update(e)):i.workspace=e,yield i.initializeConfiguration(t),r){const a=i.getWorkbenchState();n&&a!==n&&i._onDidChangeWorkbenchState.fire(a),(o&&(i.workspace.configuration?i.workspace.configuration.fsPath:void 0)!==o||a!==n)&&i._onDidChangeWorkspaceName.fire();const d=i.compareFolders(s,i.workspace.folders);d&&(d.added.length||d.removed.length||d.changed.length)&&(yield i.handleWillChangeWorkspaceFolders(d,!1),i._onDidChangeWorkspaceFolders.fire(d))}i.localUserConfiguration.hasTasksLoaded||i._register((0,E.To)(()=>i.reloadLocalUserConfiguration()))})()}compareFolders(e,t){const i={added:[],removed:[],changed:[]};i.added=t.filter(r=>!e.some(n=>r.uri.toString()===n.uri.toString()));for(let r=0;r<e.length;r++){const n=e[r];let o=0;for(o=0;o<t.length&&n.uri.toString()!==t[o].uri.toString();o++);o<t.length?(r!==o||n.name!==t[o].name)&&i.changed.push(n):i.removed.push(n)}return i}initializeConfiguration(e){var t=this;return(0,c.Z)(function*(){yield t.defaultConfiguration.initialize();const[,i,r]=yield Promise.all([t.policyConfiguration.initialize(),t.initializeApplicationConfiguration(),(0,c.Z)(function*(){(0,K.B)("code/willInitUserConfiguration");const n=yield t.initializeUserConfiguration();return(0,K.B)("code/didInitUserConfiguration"),n})()]);(0,K.B)("code/willInitWorkspaceConfiguration"),yield t.loadConfiguration(i,r.local,r.remote,e),(0,K.B)("code/didInitWorkspaceConfiguration")})()}initializeApplicationConfiguration(){var e=this;return(0,c.Z)(function*(){return e.applicationConfiguration?e.applicationConfiguration.initialize():Promise.resolve(new y.VV)})()}initializeUserConfiguration(){var e=this;return(0,c.Z)(function*(){const[t,i]=yield Promise.all([e.localUserConfiguration.initialize(),e.remoteUserConfiguration?e.remoteUserConfiguration.initialize():Promise.resolve(new y.VV)]);return{local:t,remote:i}})()}reloadDefaultConfiguration(){this.onDefaultConfigurationChanged(this.defaultConfiguration.reload())}reloadApplicationConfiguration(e){var t=this;return(0,c.Z)(function*(){if(!t.applicationConfiguration)return new y.VV;const i=yield t.applicationConfiguration.reload();return e||t.onApplicationConfigurationChanged(i),i})()}reloadUserConfiguration(){var e=this;return(0,c.Z)(function*(){const[t,i]=yield Promise.all([e.reloadLocalUserConfiguration(!0),e.reloadRemoteUserConfiguration(!0)]);return{local:t,remote:i}})()}reloadLocalUserConfiguration(e){var t=this;return(0,c.Z)(function*(){const i=yield t.localUserConfiguration.reload();return e||t.onLocalUserConfigurationChanged(i),i})()}reloadRemoteUserConfiguration(e){var t=this;return(0,c.Z)(function*(){if(t.remoteUserConfiguration){const i=yield t.remoteUserConfiguration.reload();return e||t.onRemoteUserConfigurationChanged(i),i}return new y.VV})()}reloadWorkspaceConfiguration(){var e=this;return(0,c.Z)(function*(){const t=e.getWorkbenchState();return 2===t?e.onWorkspaceFolderConfigurationChanged(e.workspace.folders[0]):3===t?e.workspaceConfiguration.reload().then(()=>e.onWorkspaceConfigurationChanged(!1)):void 0})()}reloadWorkspaceFolderConfiguration(e){return this.onWorkspaceFolderConfigurationChanged(e)}loadConfiguration(e,t,i,r){var n=this;return(0,c.Z)(function*(){n.cachedFolderConfigs=new L.Y9;const o=n.workspace.folders,s=yield n.loadFolderConfigurations(o),a=n.getWorkspaceConfigurationModel(s),u=new L.Y9;s.forEach((g,W)=>u.set(o[W].uri,g));const d=n._configuration;if(n._configuration=new we(n.defaultConfiguration.configurationModel,n.policyConfiguration.configurationModel,e,t,i,a,u,new y.VV,new L.Y9,n.workspace),n.initialized=!0,r){const g=n._configuration.compare(d);n.triggerConfigurationChange(g,{data:d.toData(),workspace:n.workspace},5)}n.updateRestrictedSettings()})()}getWorkspaceConfigurationModel(e){switch(this.getWorkbenchState()){case 2:return e[0];case 3:return this.workspaceConfiguration.getConfiguration();default:return new y.VV}}onUserDataProfileChanged(e){var t=this;e.join((0,c.Z)(function*(){e.preserveData&&(yield Promise.all([t.copyProfileSettings(e.previous.settingsResource,e.profile.settingsResource),t.copyProfileTasks(e.previous.tasksResource,e.profile.tasksResource)]));const i=[];i.push(t.localUserConfiguration.reset(e.profile.settingsResource,e.profile.tasksResource,Me(e.profile,!!t.remoteUserConfiguration))),e.previous.isDefault!==e.profile.isDefault&&(t.createApplicationConfiguration(),t.applicationConfiguration&&i.push(t.reloadApplicationConfiguration(!0)));const[r,n]=yield Promise.all(i);yield t.loadConfiguration(n??t._configuration.applicationConfiguration,r,t._configuration.remoteUserConfiguration,!0)})())}copyProfileSettings(e,t){var i=this;return(0,c.Z)(function*(){let r;try{r=(yield i.fileService.readFile(e)).value.toString()}catch(a){if(1!==a.fileOperationResult)throw a}if(!r)return;const n=I.B.as(C.IP.Configuration).getConfigurationProperties(),o=Object.keys(n).filter(a=>1===n[a]?.scope),s=(0,lt.ce)(r,"{}",o,{});yield i.fileService.writeFile(t,J.KN.fromString(s))})()}copyProfileTasks(e,t){var i=this;return(0,c.Z)(function*(){(yield i.fileService.exists(e))&&(yield i.fileService.copy(e,t))})()}onDefaultConfigurationChanged(e,t){if(this.workspace){const i=this._configuration.toData(),r=this._configuration.compareAndUpdateDefaultConfiguration(e,t);if(this.applicationConfiguration&&this._configuration.updateApplicationConfiguration(this.applicationConfiguration.reparse()),this.remoteUserConfiguration&&(this._configuration.updateLocalUserConfiguration(this.localUserConfiguration.reparse()),this._configuration.updateRemoteUserConfiguration(this.remoteUserConfiguration.reparse())),2===this.getWorkbenchState()){const n=this.cachedFolderConfigs.get(this.workspace.folders[0].uri);n&&(this._configuration.updateWorkspaceConfiguration(n.reparse()),this._configuration.updateFolderConfiguration(this.workspace.folders[0].uri,n.reparse()))}else{this._configuration.updateWorkspaceConfiguration(this.workspaceConfiguration.reparseWorkspaceSettings());for(const n of this.workspace.folders){const o=this.cachedFolderConfigs.get(n.uri);o&&this._configuration.updateFolderConfiguration(n.uri,o.reparse())}}this.triggerConfigurationChange(r,{data:i,workspace:this.workspace},7),this.updateRestrictedSettings()}}onPolicyConfigurationChanged(e){const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.compareAndUpdatePolicyConfiguration(e);this.triggerConfigurationChange(i,t,7)}onApplicationConfigurationChanged(e){const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.compareAndUpdateApplicationConfiguration(e),r=this.configurationRegistry.getConfigurationProperties();i.keys=i.keys.filter(n=>1===r[n]?.scope),this.triggerConfigurationChange(i,t,2)}onLocalUserConfigurationChanged(e){const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.compareAndUpdateLocalUserConfiguration(e);this.triggerConfigurationChange(i,t,2)}onRemoteUserConfigurationChanged(e){const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.compareAndUpdateRemoteUserConfiguration(e);this.triggerConfigurationChange(i,t,2)}onWorkspaceConfigurationChanged(e){var t=this;return(0,c.Z)(function*(){if(t.workspace&&t.workspace.configuration){let i=(0,D.UD)(t.workspaceConfiguration.getFolders(),t.workspace.configuration,t.uriIdentityService.extUri);if(t.workspace.initialized){const{added:r,removed:n,changed:o}=t.compareFolders(t.workspace.folders,i);i=r.length||n.length||o.length?yield t.toValidWorkspaceFolders(i):t.workspace.folders}yield t.updateWorkspaceConfiguration(i,t.workspaceConfiguration.getConfiguration(),e)}})()}updateRestrictedSettings(){const e=[],t=this.configurationRegistry.getConfigurationProperties(),i=Object.keys(t).filter(S=>t[S].restricted).sort((S,R)=>S.localeCompare(R)),r=(0,M.pY)(i,this._restrictedSettings.default,(S,R)=>S.localeCompare(R));e.push(...r.added,...r.removed);const n=(this.applicationConfiguration?.getRestrictedSettings()||[]).sort((S,R)=>S.localeCompare(R)),o=(0,M.pY)(n,this._restrictedSettings.application||[],(S,R)=>S.localeCompare(R));e.push(...o.added,...o.removed);const s=this.localUserConfiguration.getRestrictedSettings().sort((S,R)=>S.localeCompare(R)),a=(0,M.pY)(s,this._restrictedSettings.userLocal||[],(S,R)=>S.localeCompare(R));e.push(...a.added,...a.removed);const u=(this.remoteUserConfiguration?.getRestrictedSettings()||[]).sort((S,R)=>S.localeCompare(R)),d=(0,M.pY)(u,this._restrictedSettings.userRemote||[],(S,R)=>S.localeCompare(R));e.push(...d.added,...d.removed);const g=new L.Y9;for(const S of this.workspace.folders){const Y=(this.cachedFolderConfigs.get(S.uri)?.getRestrictedSettings()||[]).sort((ve,ke)=>ve.localeCompare(ke));Y.length&&g.set(S.uri,Y);const jt=this._restrictedSettings.workspaceFolder?.get(S.uri)||[],Ke=(0,M.pY)(Y,jt,(ve,ke)=>ve.localeCompare(ke));e.push(...Ke.added,...Ke.removed)}const W=3===this.getWorkbenchState()?this.workspaceConfiguration.getRestrictedSettings().sort((S,R)=>S.localeCompare(R)):this.workspace.folders[0]&&g.get(this.workspace.folders[0].uri)||[],b=(0,M.pY)(W,this._restrictedSettings.workspace||[],(S,R)=>S.localeCompare(R));e.push(...b.added,...b.removed),e.length&&(this._restrictedSettings={default:i,application:n.length?n:void 0,userLocal:s.length?s:void 0,userRemote:u.length?u:void 0,workspace:W.length?W:void 0,workspaceFolder:g.size?g:void 0},this._onDidChangeRestrictedSettings.fire(this.restrictedSettings))}updateWorkspaceConfiguration(e,t,i){var r=this;return(0,c.Z)(function*(){const n={data:r._configuration.toData(),workspace:r.workspace},o=r._configuration.compareAndUpdateWorkspaceConfiguration(t),s=r.compareFolders(r.workspace.folders,e);if(s.added.length||s.removed.length||s.changed.length){r.workspace.folders=e;const a=yield r.onFoldersChanged();yield r.handleWillChangeWorkspaceFolders(s,i),r.triggerConfigurationChange(a,n,6),r._onDidChangeWorkspaceFolders.fire(s)}else r.triggerConfigurationChange(o,n,5);r.updateRestrictedSettings()})()}handleWillChangeWorkspaceFolders(e,t){var i=this;return(0,c.Z)(function*(){const r=[];i._onWillChangeWorkspaceFolders.fire({join(n){r.push(n)},changes:e,fromCache:t});try{yield E.jT.settled(r)}catch{}})()}onWorkspaceFolderConfigurationChanged(e){var t=this;return(0,c.Z)(function*(){const[i]=yield t.loadFolderConfigurations([e]),r={data:t._configuration.toData(),workspace:t.workspace},n=t._configuration.compareAndUpdateFolderConfiguration(e.uri,i);if(2===t.getWorkbenchState()){const o=t._configuration.compareAndUpdateWorkspaceConfiguration(i);t.triggerConfigurationChange((0,y.nP)(n,o),r,5)}else t.triggerConfigurationChange(n,r,6);t.updateRestrictedSettings()})()}onFoldersChanged(){var e=this;return(0,c.Z)(function*(){const t=[];for(const r of e.cachedFolderConfigs.keys())e.workspace.folders.filter(n=>n.uri.toString()===r.toString())[0]||(e.cachedFolderConfigs.get(r).dispose(),e.cachedFolderConfigs.delete(r),t.push(e._configuration.compareAndDeleteFolderConfiguration(r)));const i=e.workspace.folders.filter(r=>!e.cachedFolderConfigs.has(r.uri));return i.length&&(yield e.loadFolderConfigurations(i)).forEach((n,o)=>{t.push(e._configuration.compareAndUpdateFolderConfiguration(i[o].uri,n))}),(0,y.nP)(...t)})()}loadFolderConfigurations(e){return Promise.all([...e.map(t=>{let i=this.cachedFolderConfigs.get(t.uri);return i||(i=new st(!this.initialized,t,v.Nj,this.getWorkbenchState(),this.isWorkspaceTrusted,this.fileService,this.uriIdentityService,this.logService,this.configurationCache),this._register(i.onDidChange(()=>this.onWorkspaceFolderConfigurationChanged(t))),this.cachedFolderConfigs.set(t.uri,this._register(i))),i.loadConfiguration()})])}validateWorkspaceFoldersAndReload(e){var t=this;return(0,c.Z)(function*(){const i=yield t.toValidWorkspaceFolders(t.workspace.folders),{removed:r}=t.compareFolders(t.workspace.folders,i);r.length&&(yield t.updateWorkspaceConfiguration(i,t.workspaceConfiguration.getConfiguration(),e))})()}toValidWorkspaceFolders(e){var t=this;return(0,c.Z)(function*(){const i=[];for(const r of e){try{if(!(yield t.fileService.stat(r.uri)).isDirectory)continue}catch(n){t.logService.warn(`Ignoring the error while validating workspace folder ${r.uri.toString()} - ${(0,ct.yJ)(n)}`)}i.push(r)}return i})()}writeConfigurationValue(e,t,i,r,n){var o=this;return(0,c.Z)(function*(){if(!o.instantiationService)throw new Error("Cannot write configuration because the configuration service is not yet ready to accept writes.");if(7===i)throw new Error("Invalid configuration target");if(8===i){const a={data:o._configuration.toData(),workspace:o.workspace};return o._configuration.updateValue(e,t,r),void o.triggerConfigurationChange({keys:r?.overrideIdentifiers?.length?[(0,C.np)(r.overrideIdentifiers),e]:[e],overrides:r?.overrideIdentifiers?.length?r.overrideIdentifiers.map(u=>[u,[e]]):[]},a,i)}const s=o.toEditableConfigurationTarget(i,e);if(!s)throw new Error("Invalid configuration target");if(2===s&&!o.remoteUserConfiguration)throw new Error("Invalid configuration target");switch(o.configurationEditing=o.configurationEditing??o.instantiationService.createInstance(oe,(yield o.remoteAgentService.getEnvironment())?.settingsPath??null),yield o.configurationEditing.writeConfiguration(s,{key:e,value:t},{scopes:r,...n}),s){case 1:return void(o.applicationConfiguration&&1===o.configurationRegistry.getConfigurationProperties()[e].scope?yield o.reloadApplicationConfiguration():yield o.reloadLocalUserConfiguration());case 2:return o.reloadRemoteUserConfiguration().then(()=>{});case 3:return o.reloadWorkspaceConfiguration();case 4:{const a=r&&r.resource?o.workspace.getFolder(r.resource):null;if(a)return o.reloadWorkspaceFolderConfiguration(a)}}})()}deriveConfigurationTargets(e,t,i){if((0,V.fS)(t,i.value))return[];const r=[];return void 0!==i.workspaceFolderValue&&r.push(6),void 0!==i.workspaceValue&&r.push(5),void 0!==i.userRemoteValue&&r.push(4),void 0!==i.userLocalValue&&r.push(3),void 0===t?r:[r[0]||2]}triggerConfigurationChange(e,t,i){if(e.keys.length){7!==i&&this.logService.debug(`Configuration keys changed in ${(0,O.xV)(i)} target`,...e.keys);const r=new y.YX(e,t,this._configuration,this.workspace);r.source=i,r.sourceConfig=this.getTargetConfiguration(i),this._onDidChangeConfiguration.fire(r)}}getTargetConfiguration(e){switch(e){case 7:return this._configuration.defaults.contents;case 2:return this._configuration.userConfiguration.contents;case 5:return this._configuration.workspaceConfiguration.contents}return{}}toEditableConfigurationTarget(e,t){if(2===e){if(this.remoteUserConfiguration){const i=this.configurationRegistry.getConfigurationProperties()[t]?.scope;if(2===i||6===i||void 0!==this.inspect(t).userRemoteValue)return 2}return 1}return 3===e?1:4===e?2:5===e?3:6===e?4:null}}let ce=class extends w.JT{constructor(e,t,i,r,n){super(),this.workspaceContextService=e,this.environmentService=t,this.workspaceTrustManagementService=i,r.whenInstalledExtensionsRegistered().then(()=>{this.registerConfigurationSchemas();const o=I.B.as(C.IP.Configuration),s=this._register(new E.vp(50));this._register(m.ju.any(o.onDidUpdateConfiguration,o.onDidSchemaChange,i.onDidChangeTrust)(()=>s.trigger(()=>this.registerConfigurationSchemas(),4===n.phase?void 0:2500)))})}registerConfigurationSchemas(){const e=I.B.as(ye.I.JSONContribution),t={properties:C.zt.properties,patternProperties:C.zt.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},i=this.environmentService.remoteAuthority?{properties:Object.assign({},C.w_.properties,C.dy.properties,C.Vn.properties),patternProperties:C.zt.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0}:t,r={properties:Object.assign({},C.V2.properties,C.iq.properties,C.dy.properties,C.Vn.properties),patternProperties:C.zt.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},n={properties:Object.assign({},C.V2.properties,C.iq.properties,C.dy.properties,C.Vn.properties),patternProperties:C.zt.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},o={properties:Object.assign({},this.checkAndFilterPropertiesRequiringTrust(C.iq.properties),this.checkAndFilterPropertiesRequiringTrust(C.dy.properties),this.checkAndFilterPropertiesRequiringTrust(C.Vn.properties)),patternProperties:C.zt.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0};if(e.registerSchema(v.$S,{properties:Object.keys(C.zt.properties).reduce((s,a)=>(s[a]=Object.assign({deprecationMessage:void 0},C.zt.properties[a]),s),{}),patternProperties:Object.keys(C.zt.patternProperties).reduce((s,a)=>(s[a]=Object.assign({deprecationMessage:void 0},C.zt.patternProperties[a]),s),{}),additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0}),e.registerSchema(v.v7,i),e.registerSchema(v.nT,r),e.registerSchema(v.at,n),3===this.workspaceContextService.getWorkbenchState()){const s={properties:Object.assign({},this.checkAndFilterPropertiesRequiringTrust(C.iq.properties),this.checkAndFilterPropertiesRequiringTrust(C.Vn.properties)),patternProperties:C.zt.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0};e.registerSchema(v.oL,o),e.registerSchema(v.p7,s)}else e.registerSchema(v.oL,o),e.registerSchema(v.p7,o);e.registerSchema(C.Tk,{type:"object",description:(0,l.NC)("configurationDefaults.description","Contribute defaults for configurations"),properties:Object.assign({},C.iq.properties,C.dy.properties,C.Vn.properties),patternProperties:{[C.G1]:{type:"object",default:{},$ref:C.NJ}},additionalProperties:!1})}checkAndFilterPropertiesRequiringTrust(e){if(this.workspaceTrustManagementService.isWorkspaceTrusted())return e;const t={};return Object.entries(e).forEach(([i,r])=>{r.restricted||(t[i]=r)}),t}};ce=(0,h.gn)([(0,h.fM)(0,k.ec),(0,h.fM)(1,$.n),(0,h.fM)(2,be.Y2),(0,h.fM)(3,ut.QS),(0,h.fM)(4,Fe.g)],ce),I.B.as(at.I.Workbench).registerWorkbenchContribution(ce,3);var dt=f(40411),gt=f(46740),ht=f(49698),pt=f(90290);let ue=class extends w.JT{constructor(e,t,i){super(),this.configurationService=e,this.modelService=t,this.languageService=i,this._onDidChangeConfiguration=this._register(new m.Q5),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._register(this.configurationService.onDidChangeConfiguration(r=>this._onDidChangeConfiguration.fire(this.toResourceConfigurationChangeEvent(r))))}getValue(e,t,i){return"string"==typeof i?this._getValue(e,gt.L.isIPosition(t)?t:null,i):this._getValue(e,null,"string"==typeof t?t:void 0)}updateValue(e,t,i,r){const n=this.getLanguage(e,null),o=this.configurationService.inspect(t,{resource:e,overrideIdentifier:n});switch(void 0===r&&(r=this.deriveConfigurationTarget(o,n)),r){case 8:return this._updateValue(t,i,r,o.memory?.override,e,n);case 6:return this._updateValue(t,i,r,o.workspaceFolder?.override,e,n);case 5:return this._updateValue(t,i,r,o.workspace?.override,e,n);case 4:return this._updateValue(t,i,r,o.userRemote?.override,e,n);default:return this._updateValue(t,i,r,o.userLocal?.override,e,n)}}_updateValue(e,t,i,r,n,o){return this.configurationService.updateValue(e,t,o&&void 0!==r?{resource:n,overrideIdentifier:o}:{resource:n},i)}deriveConfigurationTarget(e,t){if(t){if(void 0!==e.memory?.override)return 8;if(void 0!==e.workspaceFolder?.override)return 6;if(void 0!==e.workspace?.override)return 5;if(void 0!==e.userRemote?.override)return 4;if(void 0!==e.userLocal?.override)return 3}return void 0!==e.memory?.value?8:void 0!==e.workspaceFolder?.value?6:void 0!==e.workspace?.value?5:void 0!==e.userRemote?.value?4:3}_getValue(e,t,i){const r=e?this.getLanguage(e,t):void 0;return typeof i>"u"?this.configurationService.getValue({resource:e,overrideIdentifier:r}):this.configurationService.getValue(i,{resource:e,overrideIdentifier:r})}getLanguage(e,t){const i=this.modelService.getModel(e);return i?t?i.getLanguageIdAtPosition(t.lineNumber,t.column):i.getLanguageId():this.languageService.guessLanguageIdByFilepathOrFirstLine(e)}toResourceConfigurationChangeEvent(e){return{affectedKeys:e.affectedKeys,affectsConfiguration:(t,i)=>{const r=t?this.getLanguage(t,null):void 0;return e.affectsConfiguration(i,{resource:t,overrideIdentifier:r})}}}};ue=(0,h.gn)([(0,h.fM)(0,O.Ui),(0,h.fM)(1,pt.q),(0,h.fM)(2,ht.O)],ue);var B=f(21462),F=(()=>((F=F||{})[F.APPLICATION=1]="APPLICATION",F[F.MACHINE=2]="MACHINE",F[F.WINDOW=3]="WINDOW",F[F.RESOURCE=4]="RESOURCE",F[F.LANGUAGE_OVERRIDABLE=5]="LANGUAGE_OVERRIDABLE",F[F.MACHINE_OVERRIDABLE=6]="MACHINE_OVERRIDABLE",F))(),Ie=f(99740),Ct=f(82344),Oe=f(57948);class vt{constructor(e,t,i){this.donotCacheResourcesWithSchemes=e,this.fileService=i,this.cachedConfigurations=new Map,this.cacheHome=t.cacheHome}needsCaching(e){return!this.donotCacheResourcesWithSchemes.includes(e.scheme)}read(e){return this.getCachedConfiguration(e).read()}write(e,t){return this.getCachedConfiguration(e).save(t)}remove(e){return this.getCachedConfiguration(e).remove()}getCachedConfiguration({type:e,key:t}){const i=`${e}:${t}`;let r=this.cachedConfigurations.get(i);return r||(r=new kt({type:e,key:t},this.cacheHome,this.fileService),this.cachedConfigurations.set(i,r)),r}}class kt{constructor({type:e,key:t},i,r){this.fileService=r,this.cachedConfigurationFolderResource=(0,P.Vo)(i,"CachedConfigurations",e,t),this.cachedConfigurationFileResource=(0,P.Vo)(this.cachedConfigurationFolderResource,"workspaces"===e?"workspace.json":"configuration.json"),this.queue=new E.ci}read(){var e=this;return(0,c.Z)(function*(){try{return(yield e.fileService.readFile(e.cachedConfigurationFileResource)).value.toString()}catch{return""}})()}save(e){var t=this;return(0,c.Z)(function*(){(yield t.createCachedFolder())&&(yield t.queue.queue((0,c.Z)(function*(){yield t.fileService.writeFile(t.cachedConfigurationFileResource,J.KN.fromString(e))})))})()}remove(){var e=this;return(0,c.Z)(function*(){try{yield e.queue.queue(()=>e.fileService.del(e.cachedConfigurationFolderResource,{recursive:!0,useTrash:!1}))}catch(t){if(1!==t.fileOperationResult)throw t}})()}createCachedFolder(){var e=this;return(0,c.Z)(function*(){if(yield e.fileService.exists(e.cachedConfigurationFolderResource))return!0;try{return yield e.fileService.createFolder(e.cachedConfigurationFolderResource),!0}catch{return!1}})()}}var T=f(29175),x=f(48601),le=f(74486),St=f(30030),yt=f(31096),Ne=f(84621),xe=f(58571),mt=f(8742);const Ae=/\//g,wt=/\$\{(scheme|authoritySuffix|authority|path|(query)\.(.+?))\}/g;let fe=class extends w.JT{constructor(e,t,i,r,n,o){super(),this.environmentService=e,this.contextService=t,this.pathService=i,this.remoteAgentService=r,this._onDidChangeFormatters=this._register(new m.Q5({leakWarningThreshold:400})),this.onDidChangeFormatters=this._onDidChangeFormatters.event,this.os=Ne.OS,this.userHome=i.defaultUriScheme===T.lg.file?this.pathService.userHome({preferLocal:!0}):void 0;const s=this.storedFormattersMemento=new mt.N("cachedResourceLabelFormatters2",n);this.storedFormatters=s.getMemento(0,1),this.formatters=this.storedFormatters?.formatters?.slice()||[],this.resolveRemoteEnvironment()}resolveRemoteEnvironment(){var e=this;return(0,c.Z)(function*(){const t=yield e.remoteAgentService.getEnvironment();e.os=t?.os??Ne.OS,e.userHome=yield e.pathService.userHome()})()}findFormatting(e){let t;for(const i of this.formatters)if(i.scheme===e.scheme){if(!i.authority&&(!t||i.priority)){t=i;continue}if(!i.authority)continue;(0,St.EQ)(i.authority.toLowerCase(),e.authority.toLowerCase())&&(!t||!t.authority||i.authority.length>t.authority.length||i.authority.length===t.authority.length&&i.priority)&&(t=i)}return t?t.formatting:void 0}getUriLabel(e,t={}){let i=this.findFormatting(e);i&&t.separator&&(i={...i,separator:t.separator});const r=this.doGetUriLabel(e,i,t);return!i&&t.separator?r.replace(Ae,t.separator):r}doGetUriLabel(e,t,i={}){if(!t)return(0,le.kz)(e,{os:this.os,tildify:this.userHome?{userHome:this.userHome}:void 0,relative:i.relative?{noPrefix:i.noPrefix,getWorkspace:()=>this.contextService.getWorkspace(),getWorkspaceFolder:r=>this.contextService.getWorkspaceFolder(r)}:void 0});if(i.relative&&this.contextService){let r=this.contextService.getWorkspaceFolder(e);if(!r){const n=this.contextService.getWorkspace(),o=(0,M.Xh)(n.folders);o&&e.scheme!==o.uri.scheme&&e.path.startsWith(x.KR.sep)&&(r=this.contextService.getWorkspaceFolder(o.uri.with({path:e.path})))}if(r){const n=this.formatUri(r.uri,t,i.noPrefix);let o=this.formatUri(e,t,i.noPrefix),s=0;for(;o[s]&&o[s]===n[s];)s++;if(o[s]&&o[s]!==t.separator?s===n.length&&r.uri.path===x.KR.sep&&(o=o.substring(s)):o=o.substring(1+s),this.contextService.getWorkspace().folders.length>1&&!i.noPrefix){const u=r?.name??(0,P.Hx)(r.uri);o=o?`${u} \u2022 ${o}`:u}return o}}return this.formatUri(e,t,i.noPrefix)}getUriBasenameLabel(e){const t=this.findFormatting(e),i=this.doGetUriLabel(e,t);let r;return r=t?.separator===x.Ku.sep?x.Ku:t?.separator===x.KR.sep?x.KR:1===this.os?x.Ku:x.KR,r.basename(i)}getWorkspaceLabel(e,t){if((0,k.MF)(e)){const i=(0,k.uT)(e);return(0,k.eb)(i)||(0,k.NI)(i)?this.getWorkspaceLabel(i,t):""}return Z.ov.isUri(e)?this.doGetSingleFolderWorkspaceLabel(e,t):(0,k.eb)(e)?this.doGetSingleFolderWorkspaceLabel(e.uri,t):(0,k.NI)(e)?this.doGetWorkspaceLabel(e.configPath,t):""}doGetWorkspaceLabel(e,t){if((0,k.ql)(e,this.environmentService))return(0,l.NC)("untitledWorkspace","Untitled (Workspace)");if((0,k.gC)(e))return(0,l.NC)("temporaryWorkspace","Workspace");let r,i=(0,P.EZ)(e);switch(i.endsWith(k.A6)&&(i=i.substr(0,i.length-k.A6.length-1)),t?.verbose){case 0:r=i;break;case 2:r=(0,l.NC)("workspaceNameVerbose","{0} (Workspace)",this.getUriLabel((0,P.Vo)((0,P.XX)(e),i)));break;default:r=(0,l.NC)("workspaceName","{0} (Workspace)",i)}return 0===t?.verbose?r:this.appendWorkspaceSuffix(r,e)}doGetSingleFolderWorkspaceLabel(e,t){let i;return i=2===t?.verbose?this.getUriLabel(e):(0,P.EZ)(e)||x.KR.sep,0===t?.verbose?i:this.appendWorkspaceSuffix(i,e)}getSeparator(e,t){return this.findFormatting(Z.ov.from({scheme:e,authority:t}))?.separator||x.KR.sep}getHostLabel(e,t){return this.findFormatting(Z.ov.from({scheme:e,authority:t}))?.workspaceSuffix||t||""}getHostTooltip(e,t){return this.findFormatting(Z.ov.from({scheme:e,authority:t}))?.workspaceTooltip}registerCachedFormatter(e){const t=this.storedFormatters.formatters??=[];let i=t.findIndex(r=>r.scheme===e.scheme&&r.authority===e.authority);if(-1===i&&t.length>=50&&(i=49),-1===i)t.unshift(e);else{for(let r=i;r>0;r--)t[r]=t[r-1];t[0]=e}return this.storedFormattersMemento.saveMemento(),this.registerFormatter(e)}registerFormatter(e){return this.formatters.push(e),this._onDidChangeFormatters.fire({scheme:e.scheme}),{dispose:()=>{this.formatters=this.formatters.filter(t=>t!==e),this._onDidChangeFormatters.fire({scheme:e.scheme})}}}formatUri(e,t,i){let r=t.label.replace(wt,(n,o,s,a)=>{switch(o){case"scheme":return e.scheme;case"authority":return e.authority;case"authoritySuffix":{const u=e.authority.indexOf("+");return-1===u?e.authority:e.authority.slice(u+1)}case"path":return t.stripPathStartingSeparator?e.path.slice(e.path[0]===t.separator?1:0):e.path;default:if("query"===s){const{query:u}=e;if(u&&"{"===u[0]&&"}"===u[u.length-1])try{return JSON.parse(u)[a]||""}catch{}}return""}});return t.normalizeDriveLetter&&function Wt(p){return!(!p||":"!==p[2])}(r)&&(r=r.charAt(1).toUpperCase()+r.substr(2)),t.tildify&&!i&&this.userHome&&(r=(0,le.Cn)(r,this.userHome.fsPath,this.os)),t.authorityPrefix&&e.authority&&(r=t.authorityPrefix+r),r.replace(Ae,t.separator)}appendWorkspaceSuffix(e,t){const i=this.findFormatting(t),r=i&&"string"==typeof i.workspaceSuffix?i.workspaceSuffix:void 0;return r?`${e} [${r}]`:e}};fe=(0,h.gn)([(0,h.fM)(0,$.n),(0,h.fM)(1,k.ec),(0,h.fM)(2,yt.a),(0,h.fM)(3,Oe.R),(0,h.fM)(4,xe.Uy),(0,h.fM)(5,Fe.g)],fe);var Rt=f(82927),Dt=f(4699);function Ft(p){return(0,De.vp)(p.toString()).toString(16)}let ee=class Q extends w.JT{constructor(e,t,i,r,n,o){super(),this.storageService=e,this.contextService=t,this.logService=i,this.fileService=r,this.environmentService=n,this.uriIdentityService=o,this._onRecentlyOpenedChange=this._register(new m.Q5),this.onDidChangeRecentlyOpened=this._onRecentlyOpenedChange.event,this.addWorkspaceToRecentlyOpened(),this.registerListeners()}registerListeners(){this._register(this.storageService.onDidChangeValue(e=>this.onDidChangeStorage(e))),this._register(this.contextService.onDidChangeWorkspaceFolders(e=>this.onDidChangeWorkspaceFolders(e)))}onDidChangeStorage(e){e.key===Q.RECENTLY_OPENED_KEY&&-1===e.scope&&this._onRecentlyOpenedChange.fire()}onDidChangeWorkspaceFolders(e){if((0,k.gC)(this.contextService.getWorkspace()))for(const t of e.added)this.addRecentlyOpened([{folderUri:t.uri}])}addWorkspaceToRecentlyOpened(){const e=this.contextService.getWorkspace(),t=this.environmentService.remoteAuthority;switch(this.contextService.getWorkbenchState()){case 2:this.addRecentlyOpened([{folderUri:e.folders[0].uri,remoteAuthority:t}]);break;case 3:this.addRecentlyOpened([{workspace:{id:e.id,configPath:e.configuration},remoteAuthority:t}])}}getRecentlyOpened(){var e=this;return(0,c.Z)(function*(){const t=e.storageService.get(Q.RECENTLY_OPENED_KEY,-1);if(t){const i=(0,D.OU)(JSON.parse(t),e.logService);return i.workspaces=i.workspaces.filter(r=>!((0,D.ID)(r)&&r.folderUri.scheme===T.lg.file&&!(0,k.gC)(e.contextService.getWorkspace())||(0,D.eI)(r)&&(0,k.gC)(r.workspace.configPath))),i}return{workspaces:[],files:[]}})()}addRecentlyOpened(e){var t=this;return(0,c.Z)(function*(){const i=yield t.getRecentlyOpened();for(const r of e)(0,D.UF)(r)?(t.doRemoveRecentlyOpened(i,[r.fileUri]),i.files.unshift(r)):(0,D.ID)(r)?(t.doRemoveRecentlyOpened(i,[r.folderUri]),i.workspaces.unshift(r)):(t.doRemoveRecentlyOpened(i,[r.workspace.configPath]),i.workspaces.unshift(r));return t.saveRecentlyOpened(i)})()}removeRecentlyOpened(e){var t=this;return(0,c.Z)(function*(){const i=yield t.getRecentlyOpened();return t.doRemoveRecentlyOpened(i,e),t.saveRecentlyOpened(i)})()}doRemoveRecentlyOpened(e,t){e.files=e.files.filter(i=>!t.some(r=>r.toString()===i.fileUri.toString())),e.workspaces=e.workspaces.filter(i=>!t.some(r=>r.toString()===((0,D.ID)(i)?i.folderUri.toString():i.workspace.configPath.toString())))}saveRecentlyOpened(e){var t=this;return(0,c.Z)(function*(){return t.storageService.store(Q.RECENTLY_OPENED_KEY,JSON.stringify((0,D.Yc)(e)),-1,0)})()}clearRecentlyOpened(){var e=this;return(0,c.Z)(function*(){e.storageService.remove(Q.RECENTLY_OPENED_KEY,-1)})()}enterWorkspace(e){var t=this;return(0,c.Z)(function*(){return{workspace:yield t.getWorkspaceIdentifier(e)}})()}createUntitledWorkspace(e,t){var i=this;return(0,c.Z)(function*(){const r=(Date.now()+Math.round(1e3*Math.random())).toString(),n=(0,P.Vo)(i.environmentService.untitledWorkspacesHome,`Untitled-${r}.${k.A6}`),o=[];if(e)for(const a of e)o.push((0,D.l0)(a.uri,!0,a.name,i.environmentService.untitledWorkspacesHome,i.uriIdentityService.extUri));const s={folders:o,remoteAuthority:t};return yield i.fileService.writeFile(n,J.KN.fromString(JSON.stringify(s,null,"\t"))),i.getWorkspaceIdentifier(n)})()}deleteUntitledWorkspace(e){var t=this;return(0,c.Z)(function*(){try{yield t.fileService.del(e.configPath)}catch(i){if(1!==i.fileOperationResult)throw i}})()}getWorkspaceIdentifier(e){return(0,c.Z)(function*(){return function Pt(p){return{id:Ft(p),configPath:p}}(e)})()}getDirtyWorkspaces(){return(0,c.Z)(function*(){return[]})()}};ee.RECENTLY_OPENED_KEY="recently.opened",ee=(0,h.gn)([(0,h.fM)(0,xe.Uy),(0,h.fM)(1,k.ec),(0,h.fM)(2,Ie.VZ),(0,h.fM)(3,N.sn),(0,h.fM)(4,$.n),(0,h.fM)(5,G.v)],ee);var bt=f(44617),Ut=f(13141),Ve=f(89295),Et=f(76148);let de=class{constructor(e,t,i,r,n,o,s,a,u,d,g,W,b,S,R,Y){this.jsonEditingService=e,this.contextService=t,this.configurationService=i,this.notificationService=r,this.commandService=n,this.fileService=o,this.textFileService=s,this.workspacesService=a,this.environmentService=u,this.fileDialogService=d,this.dialogService=g,this.hostService=W,this.uriIdentityService=b,this.workspaceTrustManagementService=S,this.userDataProfilesService=R,this.userDataProfileService=Y}pickNewWorkspacePath(){var e=this;return(0,c.Z)(function*(){const t=[T.lg.file];e.environmentService.remoteAuthority&&t.unshift(T.lg.vscodeRemote);let i=yield e.fileDialogService.showSaveDialog({saveLabel:(0,le.pH)((0,l.NC)("save","Save")),title:(0,l.NC)("saveWorkspace","Save Workspace"),filters:k.WB,defaultUri:(0,P.Vo)(yield e.fileDialogService.defaultWorkspacePath(),e.getNewWorkspaceName()),availableFileSystems:t});if(i)return(0,k.g)(i)||(i=i.with({path:`${i.path}.${k.A6}`})),i})()}getNewWorkspaceName(){const e=this.getCurrentWorkspaceIdentifier()?.configPath;if(e&&(0,k.AQ)(e,this.environmentService))return(0,P.EZ)(e);const t=(0,M.Xh)(this.contextService.getWorkspace().folders);return t?`${(0,P.EZ)(t.uri)}.${k.A6}`:`workspace.${k.A6}`}updateFolders(e,t,i,r){var n=this;return(0,c.Z)(function*(){const o=n.contextService.getWorkspace().folders;let s=[];"number"==typeof t&&(s=o.slice(e,e+t).map(g=>g.uri));let a=[];Array.isArray(i)&&(a=i.map(g=>({uri:(0,P.O2)(g.uri),name:g.name})));const u=s.length>0,d=a.length>0;if(d||u)return d&&!u?n.doAddFolders(a,e,r):u&&!d?n.removeFolders(s):n.includesSingleFolderWorkspace(s)?n.createAndEnterWorkspace(a):3!==n.contextService.getWorkbenchState()?n.doAddFolders(a,e,r):n.doUpdateFolders(a,s,e,r)})()}doUpdateFolders(e,t,i,r=!1){var n=this;return(0,c.Z)(function*(){try{yield n.contextService.updateFolders(e,t,i)}catch(o){if(r)throw o;n.handleWorkspaceConfigurationEditingError(o)}})()}addFolders(e,t=!1){const i=e.map(r=>({uri:(0,P.O2)(r.uri),name:r.name}));return this.doAddFolders(i,void 0,t)}doAddFolders(e,t,i=!1){var r=this;return(0,c.Z)(function*(){const n=r.contextService.getWorkbenchState(),o=r.environmentService.remoteAuthority;if(o&&(e=e.filter(s=>s.uri.scheme!==T.lg.file&&(s.uri.scheme!==T.lg.vscodeRemote||(0,P.x5)(s.uri.authority,o)))),3!==n){let s=r.contextService.getWorkspace().folders.map(a=>({uri:a.uri}));return s.splice("number"==typeof t?t:s.length,0,...e),s=(0,M.EB)(s,a=>r.uriIdentityService.extUri.getComparisonKey(a.uri)),1===n&&0===s.length||2===n&&1===s.length?void 0:r.createAndEnterWorkspace(s)}try{yield r.contextService.addFolders(e,t)}catch(s){if(i)throw s;r.handleWorkspaceConfigurationEditingError(s)}})()}removeFolders(e,t=!1){var i=this;return(0,c.Z)(function*(){if(i.includesSingleFolderWorkspace(e))return i.createAndEnterWorkspace([]);try{yield i.contextService.removeFolders(e)}catch(r){if(t)throw r;i.handleWorkspaceConfigurationEditingError(r)}})()}includesSingleFolderWorkspace(e){if(2===this.contextService.getWorkbenchState()){const t=this.contextService.getWorkspace().folders[0];return e.some(i=>this.uriIdentityService.extUri.isEqual(i,t.uri))}return!1}createAndEnterWorkspace(e,t){var i=this;return(0,c.Z)(function*(){if(t&&!(yield i.isValidTargetWorkspacePath(t)))return;const r=i.environmentService.remoteAuthority,n=yield i.workspacesService.createUntitledWorkspace(e,r);if(t)try{yield i.saveWorkspaceAs(n,t)}finally{yield i.workspacesService.deleteUntitledWorkspace(n)}else t=n.configPath,i.userDataProfileService.currentProfile.isDefault||(yield i.userDataProfilesService.setProfileForWorkspace(n,i.userDataProfileService.currentProfile));return i.enterWorkspace(t)})()}saveAndEnterWorkspace(e){var t=this;return(0,c.Z)(function*(){const i=t.getCurrentWorkspaceIdentifier();if(i){if((0,P.Xy)(i.configPath,e))return t.saveWorkspace(i);if(yield t.isValidTargetWorkspacePath(e))return yield t.saveWorkspaceAs(i,e),t.enterWorkspace(e)}})()}isValidTargetWorkspacePath(e){return(0,c.Z)(function*(){return!0})()}saveWorkspaceAs(e,t){var i=this;return(0,c.Z)(function*(){const r=e.configPath;if(!(0,k.ql)(t,i.environmentService)&&!i.userDataProfileService.currentProfile.isDefault){const u=yield i.workspacesService.getWorkspaceIdentifier(t);yield i.userDataProfilesService.setProfileForWorkspace(u,i.userDataProfileService.currentProfile)}if(i.uriIdentityService.extUri.isEqual(r,t))return;const o=(0,k.ql)(r,i.environmentService),s=yield i.fileService.readFile(r),a=(0,D.XB)(s.value.toString(),r,o,t,i.uriIdentityService.extUri);yield i.textFileService.create([{resource:t,value:a,options:{overwrite:!0}}]),yield i.trustWorkspaceConfiguration(t)})()}saveWorkspace(e){var t=this;return(0,c.Z)(function*(){const i=e.configPath,r=t.textFileService.files.get(i);if(r)return void(yield r.save({force:!0,reason:1}));if(yield t.fileService.exists(i))return;const s=(0,D.XB)(JSON.stringify({folders:[]},null,"\t"),i,!1,i,t.uriIdentityService.extUri);yield t.textFileService.create([{resource:i,value:s}])})()}handleWorkspaceConfigurationEditingError(e){0===e.code?this.onInvalidWorkspaceConfigurationFileError():this.notificationService.error(e.message)}onInvalidWorkspaceConfigurationFileError(){const e=(0,l.NC)("errorInvalidTaskConfiguration","Unable to write into workspace configuration file. Please open the file to correct errors/warnings in it and try again.");this.askToOpenWorkspaceConfigurationFile(e)}askToOpenWorkspaceConfigurationFile(e){this.notificationService.prompt(z.zb.Error,e,[{label:(0,l.NC)("openWorkspaceConfigurationFile","Open Workspace Configuration"),run:()=>this.commandService.executeCommand("workbench.action.openWorkspaceConfigFile")}])}doEnterWorkspace(e){var t=this;return(0,c.Z)(function*(){if(t.environmentService.extensionTestsLocationURI)throw new Error("Entering a new workspace is not possible in tests.");const i=yield t.workspacesService.getWorkspaceIdentifier(e);return 2===t.contextService.getWorkbenchState()&&(yield t.migrateWorkspaceSettings(i)),yield t.configurationService.initialize(i),t.workspacesService.enterWorkspace(e)})()}migrateWorkspaceSettings(e){return this.doCopyWorkspaceSettings(e,t=>3===t.scope)}copyWorkspaceSettings(e){return this.doCopyWorkspaceSettings(e)}doCopyWorkspaceSettings(e,t){const i=I.B.as(C.IP.Configuration).getConfigurationProperties(),r={};for(const n of this.configurationService.keys().workspace)if(i[n]){if(t&&!t(i[n]))continue;r[n]=this.configurationService.inspect(n).workspaceValue}return this.jsonEditingService.write(e.configPath,[{path:["settings"],value:r}],!0)}trustWorkspaceConfiguration(e){var t=this;return(0,c.Z)(function*(){1!==t.contextService.getWorkbenchState()&&t.workspaceTrustManagementService.isWorkspaceTrusted()&&(yield t.workspaceTrustManagementService.setUrisTrust([e],!0))})()}getCurrentWorkspaceIdentifier(){const e=(0,k.uT)(this.contextService.getWorkspace());if((0,k.NI)(e))return e}};de=(0,h.gn)([(0,h.fM)(0,Ee.R),(0,h.fM)(1,k.ec),(0,h.fM)(2,v.FG),(0,h.fM)(3,z.lT),(0,h.fM)(4,Ut.H),(0,h.fM)(5,N.sn),(0,h.fM)(6,We.MM),(0,h.fM)(7,D.Dc),(0,h.fM)(8,$.n),(0,h.fM)(9,Ve.Z$),(0,h.fM)(10,Ve.Ss),(0,h.fM)(11,Et.$),(0,h.fM)(12,G.v),(0,h.fM)(13,be.Y2),(0,h.fM)(14,_.lv),(0,h.fM)(15,ne.A)],de);var Ze=f(8155),Mt=f(22806);const It=I.B.as(ye.I.JSONContribution),te=I.B.as(C.IP.Configuration),Le={type:"object",defaultSnippets:[{body:{title:"",properties:{}}}],properties:{title:{description:l.NC("vscode.extension.contributes.configuration.title","A title for the current category of settings. This label will be rendered in the Settings editor as a subheading. If the title is the same as the extension display name, then the category will be grouped under the main extension heading."),type:"string"},order:{description:l.NC("vscode.extension.contributes.configuration.order","When specified, gives the order of this category of settings relative to other categories."),type:"integer"},properties:{description:l.NC("vscode.extension.contributes.configuration.properties","Description of the configuration properties."),type:"object",propertyNames:{pattern:"\\S+",patternErrorMessage:l.NC("vscode.extension.contributes.configuration.property.empty","Property should not be empty.")},additionalProperties:{anyOf:[{title:l.NC("vscode.extension.contributes.configuration.properties.schema","Schema of the configuration property."),$ref:"http://json-schema.org/draft-07/schema#"},{type:"object",properties:{scope:{type:"string",enum:["application","machine","window","resource","language-overridable","machine-overridable"],default:"window",enumDescriptions:[l.NC("scope.application.description","Configuration that can be configured only in the user settings."),l.NC("scope.machine.description","Configuration that can be configured only in the user settings or only in the remote settings."),l.NC("scope.window.description","Configuration that can be configured in the user, remote or workspace settings."),l.NC("scope.resource.description","Configuration that can be configured in the user, remote, workspace or folder settings."),l.NC("scope.language-overridable.description","Resource configuration that can be configured in language specific settings."),l.NC("scope.machine-overridable.description","Machine configuration that can be configured also in workspace or folder settings.")],markdownDescription:l.NC("scope.description","Scope in which the configuration is applicable. Available scopes are `application`, `machine`, `window`, `resource`, and `machine-overridable`.")},enumDescriptions:{type:"array",items:{type:"string"},description:l.NC("scope.enumDescriptions","Descriptions for enum values")},markdownEnumDescriptions:{type:"array",items:{type:"string"},description:l.NC("scope.markdownEnumDescriptions","Descriptions for enum values in the markdown format.")},enumItemLabels:{type:"array",items:{type:"string"},markdownDescription:l.NC("scope.enumItemLabels","Labels for enum values to be displayed in the Settings editor. When specified, the {0} values still show after the labels, but less prominently.","`enum`")},markdownDescription:{type:"string",description:l.NC("scope.markdownDescription","The description in the markdown format.")},deprecationMessage:{type:"string",description:l.NC("scope.deprecationMessage","If set, the property is marked as deprecated and the given message is shown as an explanation.")},markdownDeprecationMessage:{type:"string",description:l.NC("scope.markdownDeprecationMessage","If set, the property is marked as deprecated and the given message is shown as an explanation in the markdown format.")},editPresentation:{type:"string",enum:["singlelineText","multilineText"],enumDescriptions:[l.NC("scope.singlelineText.description","The value will be shown in an inputbox."),l.NC("scope.multilineText.description","The value will be shown in a textarea.")],default:"singlelineText",description:l.NC("scope.editPresentation","When specified, controls the presentation format of the string setting.")},order:{type:"integer",description:l.NC("scope.order","When specified, gives the order of this setting relative to other settings within the same category. Settings with an order property will be placed before settings without this property set.")},ignoreSync:{type:"boolean",description:l.NC("scope.ignoreSync","When enabled, Settings Sync will not sync the user value of this configuration by default.")}}}]}}}};let U;const ze=Ze.ut.registerExtensionPoint({extensionPoint:"configurationDefaults",jsonSchema:{$ref:C.Tk}});ze.setHandler((p,{added:e,removed:t})=>{U&&te.deltaConfiguration(U);const i=U={};if(queueMicrotask(()=>{U===i&&(te.deltaConfiguration(U),U=void 0)}),t.length){const r=t.map(n=>({overrides:V.I8(n.value),source:{id:n.description.identifier.value,displayName:n.description.displayName}}));U.removedDefaults=r}if(e.length){const r=te.getConfigurationProperties(),n=[6,3,4,5],o=e.map(s=>{const a=V.I8(s.value);for(const u of Object.keys(a))if(!C.eU.test(u)){const d=r[u];d?.scope&&!n.includes(d.scope)&&(s.collector.warn(l.NC("config.property.defaultConfiguration.warning","Cannot register configuration defaults for '{0}'. Only defaults for machine-overridable, window, resource and language overridable scoped settings are supported.",u)),delete a[u])}return{overrides:a,source:{id:s.description.identifier.value,displayName:s.description.displayName}}});U.addedDefaults=o}});const Ot=Ze.ut.registerExtensionPoint({extensionPoint:"configuration",deps:[ze],jsonSchema:{description:l.NC("vscode.extension.contributes.configuration","Contributes configuration settings."),oneOf:[Le,{type:"array",items:Le}]}}),ge=new Mt.C1;Ot.setHandler((p,{added:e,removed:t})=>{if(U??={},t.length){const o=[];for(const s of t)o.push(...ge.get(s.description.identifier)||[]),ge.delete(s.description.identifier);U.removedConfigurations=o}const i=new Set;function r(o,s){const a=[],u=V.I8(o);return u.title&&"string"!=typeof u.title&&s.collector.error(l.NC("invalid.title","'configuration.title' must be a string")),n(u,s),u.id=o.id||s.description.identifier.value,u.extensionInfo={id:s.description.identifier.value,displayName:s.description.displayName},u.restrictedProperties="limited"===s.description.capabilities?.untrustedWorkspaces?.supported?s.description.capabilities?.untrustedWorkspaces.restrictedConfigurations:void 0,u.title=u.title||s.description.displayName||s.description.identifier.value,a.push(u),a}function n(o,s){const a=o.properties;if(a){"object"!=typeof a&&(s.collector.error(l.NC("invalid.properties","'configuration.properties' must be an object")),o.properties={});for(const d in a){const g=a[d],W=(0,C.uO)(d,g);W?(delete a[d],s.collector.warn(W)):i.has(d)?(delete a[d],s.collector.warn(l.NC("config.property.duplicate","Cannot register '{0}'. This property is already registered.",d))):(0,A.Kn)(g)?(i.add(d),g.scope=g.scope?"application"===g.scope.toString()?1:"machine"===g.scope.toString()?2:"resource"===g.scope.toString()?4:"machine-overridable"===g.scope.toString()?6:"language-overridable"===g.scope.toString()?5:3:3):(delete a[d],s.collector.error(l.NC("invalid.property","configuration.properties property '{0}' must be an object",d)))}}const u=o.allOf;if(u){s.collector.error(l.NC("invalid.allOf","'configuration.allOf' is deprecated and should no longer be used. Instead, pass multiple configuration sections as an array to the 'configuration' contribution point."));for(const d of u)n(d,s)}}if(e.length){const o=[];for(const s of e){const a=[],u=s.value;Array.isArray(u)?u.forEach(d=>a.push(...r(d,s))):a.push(...r(u,s)),ge.set(s.description.identifier,a),o.push(...a)}U.addedConfigurations=o}te.deltaConfiguration(U),U=void 0}),It.registerSchema("vscode://schemas/workspaceConfig",{allowComments:!0,allowTrailingCommas:!0,default:{folders:[{path:""}],settings:{}},required:["folders"],properties:{folders:{minItems:0,uniqueItems:!0,description:l.NC("workspaceConfig.folders.description","List of folders to be loaded in the workspace."),items:{type:"object",defaultSnippets:[{body:{path:"$1"}}],oneOf:[{properties:{path:{type:"string",description:l.NC("workspaceConfig.path.description","A file path. e.g. `/root/folderA` or `./folderA` for a relative path that will be resolved against the location of the workspace file.")},name:{type:"string",description:l.NC("workspaceConfig.name.description","An optional name for the folder. ")}},required:["path"]},{properties:{uri:{type:"string",description:l.NC("workspaceConfig.uri.description","URI of the folder")},name:{type:"string",description:l.NC("workspaceConfig.name.description","An optional name for the folder. ")}},required:["uri"]}]}},settings:{type:"object",default:{},description:l.NC("workspaceConfig.settings.description","Workspace settings"),$ref:v.oL},launch:{type:"object",default:{configurations:[],compounds:[]},description:l.NC("workspaceConfig.launch.description","Workspace launch configurations"),$ref:v.yY},tasks:{type:"object",default:{version:"2.0.0",tasks:[]},description:l.NC("workspaceConfig.tasks.description","Workspace task configurations"),$ref:v.li},extensions:{type:"object",default:{},description:l.NC("workspaceConfig.extensions.description","Workspace extensions"),$ref:"vscode://schemas/extensions"},remoteAuthority:{type:"string",doNotSuggest:!0,description:l.NC("workspaceConfig.remoteAuthority","The remote server where the workspace is located.")},transient:{type:"boolean",doNotSuggest:!0,description:l.NC("workspaceConfig.transient","A transient workspace will disappear when restarting or reloading.")}},errorMessage:l.NC("unknownWorkspaceProperty","Unknown workspace configuration property")});var Nt=f(17653),je=f(76854),xt=f(25324);function At(p){return he.apply(this,arguments)}function he(){return(he=(0,c.Z)(function*(p){const e=j.IO.get(_.lv);yield j.IO.get(N.sn).writeFile(e.defaultProfile.settingsResource,J.KN.fromString(p))})).apply(this,arguments)}function Tt(){return pe.apply(this,arguments)}function pe(){return(pe=(0,c.Z)(function*(){const p=j.IO.get(_.lv);return(yield j.IO.get(N.sn).readFile(p.defaultProfile.settingsResource)).value.toString()})).apply(this,arguments)}function Vt(p){const e=j.IO.get(_.lv);return j.IO.get(N.sn).onDidFilesChange(t=>{t.affects(e.defaultProfile.settingsResource)&&p()})}const Zt=I.B.as(C.IP.Configuration);let Ce=class extends ft{constructor(e,t,i,r,n,o,s,a){super({configurationCache:new vt([T.lg.file,T.lg.vscodeUserData,T.lg.tmp],e,r)},e,t,i,r,n,o,s,a)}};Ce=(0,h.gn)([(0,h.fM)(0,$.n),(0,h.fM)(1,ne.A),(0,h.fM)(2,_.lv),(0,h.fM)(3,N.sn),(0,h.fM)(4,Oe.R),(0,h.fM)(5,G.v),(0,h.fM)(6,Ie.VZ),(0,h.fM)(7,Ue.Wu)],Ce);class Lt extends de{constructor(){super(...arguments),this.enterWorkspace=je.Jc}}let ie=Z.ov.file("/workspace");(0,xt.Fg)(function(){var p=(0,c.Z)(function*(e){const t=e.get(k.ec);t.acquireInstantiationService(e.get(Ct.TG));const i=ie.with({path:"/workspace.code-workspace"});try{const r=e.get(N.sn);yield r.createFolder(ie),yield r.writeFile(i,J.KN.fromString(JSON.stringify({folders:[{path:ie.path}]})))}catch{}yield t.initialize({id:(0,Dt.R)(),configPath:i})});return function(e){return p.apply(this,arguments)}}());const _e=(0,je.pL)(Ce);function zt(p){return ie=p,{...(0,Nt.default)(),[Rt.e.toString()]:new B.M(fe,void 0,!0),[O.Ui.toString()]:new B.M(_e),[k.ec.toString()]:new B.M(_e),[dt.V.toString()]:new B.M(ue),[bt.o.toString()]:new B.M(Lt),[D.Dc.toString()]:new B.M(ee,void 0,!0)}}}}]);