"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[784],{9784:(E,S,s)=>{s.r(S),s.d(S,{default:()=>F}),s(87708);var a=s(56980),v=s(58054),n=s(55885),f=s(58535),g=s(82344),d=s(12997),u=s(90290),C=s(75874),y=s(4866),c=s(29175),P=s(12192),R=s(17088),p=s(28732),x=s(80258);let h=class extends d.JT{constructor(e,i,t){super(),this._modelService=e,this._textModelService=i,this._undoRedoService=t,this._register(this._modelService.onModelRemoved(r=>{const o=this._undoRedoService.getElements(r.uri);if(0!==o.past.length||0!==o.future.length){for(const l of o.past)l instanceof x.z5&&l.setDelegate(this);for(const l of o.future)l instanceof x.z5&&l.setDelegate(this)}}))}prepareUndoRedo(e){var i=this;const t=e.getMissingModels();if(0===t.length)return d.JT.None;const r=t.map(function(){var o=(0,v.Z)(function*(l){try{return yield i._textModelService.createModelReference(l)}catch{return d.JT.None}});return function(l){return o.apply(this,arguments)}}());return Promise.all(r).then(o=>({dispose:()=>(0,d.B9)(o)}))}};h=(0,n.gn)([(0,n.fM)(0,u.q),(0,n.fM)(1,a.S),(0,n.fM)(2,p.tJ)],h);var D=s(18747);let M=class extends d.os{constructor(e,i,t,r){super(),this.instantiationService=e,this.textFileService=i,this.fileService=t,this.modelService=r,this.providers=new Map,this.modelsToDispose=new Set}createReferencedObject(e){return this.doCreateReferencedObject(e)}doCreateReferencedObject(e,i){var t=this;return(0,v.Z)(function*(){t.modelsToDispose.delete(e);const r=f.ov.parse(e);if(r.scheme===c.lg.inMemory){if(!t.modelService.getModel(r))throw new Error(`Unable to resolve inMemory resource ${e}`);const l=t.instantiationService.createInstance(C.D,r);if(t.ensureResolvedModel(l,e))return l}if(r.scheme===c.lg.untitled){const o=yield t.textFileService.untitled.resolve({untitledResource:r});if(t.ensureResolvedModel(o,e))return o}if(t.fileService.hasProvider(r)){const o=yield t.textFileService.files.resolve(r,{reason:2});if(t.ensureResolvedModel(o,e))return o}if(t.providers.has(r.scheme)){yield t.resolveTextModelContent(e);const o=t.instantiationService.createInstance(C.D,r);if(t.ensureResolvedModel(o,e))return o}if(!i)return yield t.fileService.activateProvider(r.scheme),t.doCreateReferencedObject(e,!0);throw new Error(`Unable to resolve resource ${e}`)})()}ensureResolvedModel(e,i){if((0,a.B)(e))return!0;throw new Error(`Unable to resolve resource ${i}`)}destroyReferencedObject(e,i){var t=this;const r=f.ov.parse(e);r.scheme===c.lg.untitled||r.scheme===c.lg.inMemory||(this.modelsToDispose.add(e),(0,v.Z)(function*(){try{const o=yield i;if(!t.modelsToDispose.has(e)||(o instanceof P.O&&(yield t.textFileService.files.canDispose(o)),!t.modelsToDispose.has(e)))return;o.dispose()}catch{}finally{t.modelsToDispose.delete(e)}})())}registerTextModelContentProvider(e,i){let t=this.providers.get(e);return t||(t=[],this.providers.set(e,t)),t.unshift(i),(0,d.OF)(()=>{const r=this.providers.get(e);if(!r)return;const o=r.indexOf(i);-1!==o&&(r.splice(o,1),0===r.length&&this.providers.delete(e))})}hasTextModelContentProvider(e){return void 0!==this.providers.get(e)}resolveTextModelContent(e){var i=this;return(0,v.Z)(function*(){const t=f.ov.parse(e),r=i.providers.get(t.scheme)||[];for(const o of r){const l=yield o.provideTextContent(t);if(l)return l}throw new Error(`Unable to resolve text model content for resource ${e}`)})()}};M=(0,n.gn)([(0,n.fM)(0,g.TG),(0,n.fM)(1,y.MM),(0,n.fM)(2,R.sn),(0,n.fM)(3,u.q)],M);let m=class extends d.JT{get resourceModelCollection(){return this._resourceModelCollection||(this._resourceModelCollection=this.instantiationService.createInstance(M)),this._resourceModelCollection}get asyncModelCollection(){return this._asyncModelCollection||(this._asyncModelCollection=new d.kR(this.resourceModelCollection)),this._asyncModelCollection}constructor(e,i,t,r,o){super(),this.instantiationService=e,this.fileService=i,this.undoRedoService=t,this.modelService=r,this.uriIdentityService=o,this._resourceModelCollection=void 0,this._asyncModelCollection=void 0,this._register(new h(this.modelService,this,this.undoRedoService))}createModelReference(e){var i=this;return(0,v.Z)(function*(){return e=i.uriIdentityService.asCanonicalUri(e),yield i.asyncModelCollection.acquire(e.toString())})()}registerTextModelContentProvider(e,i){return this.resourceModelCollection.registerTextModelContentProvider(e,i)}canHandleResource(e){return!(!this.fileService.hasProvider(e)&&e.scheme!==c.lg.untitled&&e.scheme!==c.lg.inMemory)||this.resourceModelCollection.hasTextModelContentProvider(e.scheme)}};m=(0,n.gn)([(0,n.fM)(0,g.TG),(0,n.fM)(1,R.sn),(0,n.fM)(2,p.tJ),(0,n.fM)(3,u.q),(0,n.fM)(4,D.v)],m);var O=s(21462);function F(){return{[a.S.toString()]:new O.M(m,void 0,!0)}}}}]);