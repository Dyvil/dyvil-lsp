(self.webpackChunkweb=self.webpackChunkweb||[]).push([[635],{59635:ve=>{self,ve.exports=(()=>{"use strict";var ce={965:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.GlyphRenderer=void 0;const u=d(381),h=d(855),r=d(859),_=d(374),g=d(509),a=11,t=a*Float32Array.BYTES_PER_ELEMENT;let e,n=0,y=0,x=0;i.GlyphRenderer=class R extends r.Disposable{constructor(l,m,c){super(),this._terminal=l,this._gl=m,this._dimensions=c,this._activeBuffer=0,this._vertices={count:0,attributes:new Float32Array(0),attributesBuffers:[new Float32Array(0),new Float32Array(0)]};const s=this._gl;void 0===g.TextureAtlas.maxAtlasPages&&(g.TextureAtlas.maxAtlasPages=Math.min(32,(0,_.throwIfFalsy)(s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS))),g.TextureAtlas.maxTextureSize=(0,_.throwIfFalsy)(s.getParameter(s.MAX_TEXTURE_SIZE))),this._program=(0,_.throwIfFalsy)((0,u.createProgram)(s,"#version 300 es\nlayout (location = 0) in vec2 a_unitquad;\nlayout (location = 1) in vec2 a_cellpos;\nlayout (location = 2) in vec2 a_offset;\nlayout (location = 3) in vec2 a_size;\nlayout (location = 4) in float a_texpage;\nlayout (location = 5) in vec2 a_texcoord;\nlayout (location = 6) in vec2 a_texsize;\n\nuniform mat4 u_projection;\nuniform vec2 u_resolution;\n\nout vec2 v_texcoord;\nflat out int v_texpage;\n\nvoid main() {\n  vec2 zeroToOne = (a_offset / u_resolution) + a_cellpos + (a_unitquad * a_size);\n  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);\n  v_texpage = int(a_texpage);\n  v_texcoord = a_texcoord + a_unitquad * a_texsize;\n}",function(M){let A="";for(let w=1;w<M;w++)A+=` else if (v_texpage == ${w}) { outColor = texture(u_texture[${w}], v_texcoord); }`;return`#version 300 es\nprecision lowp float;\n\nin vec2 v_texcoord;\nflat in int v_texpage;\n\nuniform sampler2D u_texture[${M}];\n\nout vec4 outColor;\n\nvoid main() {\n  if (v_texpage == 0) {\n    outColor = texture(u_texture[0], v_texcoord);\n  } ${A}\n}`}(g.TextureAtlas.maxAtlasPages))),this.register((0,r.toDisposable)(()=>s.deleteProgram(this._program))),this._projectionLocation=(0,_.throwIfFalsy)(s.getUniformLocation(this._program,"u_projection")),this._resolutionLocation=(0,_.throwIfFalsy)(s.getUniformLocation(this._program,"u_resolution")),this._textureLocation=(0,_.throwIfFalsy)(s.getUniformLocation(this._program,"u_texture")),this._vertexArrayObject=s.createVertexArray(),s.bindVertexArray(this._vertexArrayObject);const v=new Float32Array([0,0,1,0,0,1,1,1]),C=s.createBuffer();this.register((0,r.toDisposable)(()=>s.deleteBuffer(C))),s.bindBuffer(s.ARRAY_BUFFER,C),s.bufferData(s.ARRAY_BUFFER,v,s.STATIC_DRAW),s.enableVertexAttribArray(0),s.vertexAttribPointer(0,2,this._gl.FLOAT,!1,0,0);const o=new Uint8Array([0,1,2,3]),f=s.createBuffer();this.register((0,r.toDisposable)(()=>s.deleteBuffer(f))),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,f),s.bufferData(s.ELEMENT_ARRAY_BUFFER,o,s.STATIC_DRAW),this._attributesBuffer=(0,_.throwIfFalsy)(s.createBuffer()),this.register((0,r.toDisposable)(()=>s.deleteBuffer(this._attributesBuffer))),s.bindBuffer(s.ARRAY_BUFFER,this._attributesBuffer),s.enableVertexAttribArray(2),s.vertexAttribPointer(2,2,s.FLOAT,!1,t,0),s.vertexAttribDivisor(2,1),s.enableVertexAttribArray(3),s.vertexAttribPointer(3,2,s.FLOAT,!1,t,2*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(3,1),s.enableVertexAttribArray(4),s.vertexAttribPointer(4,1,s.FLOAT,!1,t,4*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(4,1),s.enableVertexAttribArray(5),s.vertexAttribPointer(5,2,s.FLOAT,!1,t,5*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(5,1),s.enableVertexAttribArray(6),s.vertexAttribPointer(6,2,s.FLOAT,!1,t,7*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(6,1),s.enableVertexAttribArray(1),s.vertexAttribPointer(1,2,s.FLOAT,!1,t,9*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(1,1),s.useProgram(this._program);const p=new Int32Array(g.TextureAtlas.maxAtlasPages);for(let M=0;M<g.TextureAtlas.maxAtlasPages;M++)p[M]=M;s.uniform1iv(this._textureLocation,p),s.uniformMatrix4fv(this._projectionLocation,!1,u.PROJECTION_MATRIX),this._atlasTextures=[];for(let M=0;M<g.TextureAtlas.maxAtlasPages;M++){const A=new u.GLTexture((0,_.throwIfFalsy)(s.createTexture()));this.register((0,r.toDisposable)(()=>s.deleteTexture(A.texture))),s.activeTexture(s.TEXTURE0+M),s.bindTexture(s.TEXTURE_2D,A.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array([255,0,0,255])),this._atlasTextures[M]=A}s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),this.handleResize()}beginFrame(){return!this._atlas||this._atlas.beginFrame()}updateCell(l,m,c,s,v,C,o,f){this._updateCell(this._vertices.attributes,l,m,c,s,v,C,o,f)}_updateCell(l,m,c,s,v,C,o,f,p){n=(c*this._terminal.cols+m)*a,s!==h.NULL_CELL_CODE&&void 0!==s?this._atlas&&(e=f&&f.length>1?this._atlas.getRasterizedGlyphCombinedChar(f,v,C,o):this._atlas.getRasterizedGlyph(s,v,C,o),y=Math.floor((this._dimensions.device.cell.width-this._dimensions.device.char.width)/2),v!==p&&e.offset.x>y?(x=e.offset.x-y,l[n]=-(e.offset.x-x)+this._dimensions.device.char.left,l[n+1]=-e.offset.y+this._dimensions.device.char.top,l[n+2]=(e.size.x-x)/this._dimensions.device.canvas.width,l[n+3]=e.size.y/this._dimensions.device.canvas.height,l[n+4]=e.texturePage,l[n+5]=e.texturePositionClipSpace.x+x/this._atlas.pages[e.texturePage].canvas.width,l[n+6]=e.texturePositionClipSpace.y,l[n+7]=e.sizeClipSpace.x-x/this._atlas.pages[e.texturePage].canvas.width,l[n+8]=e.sizeClipSpace.y):(l[n]=-e.offset.x+this._dimensions.device.char.left,l[n+1]=-e.offset.y+this._dimensions.device.char.top,l[n+2]=e.size.x/this._dimensions.device.canvas.width,l[n+3]=e.size.y/this._dimensions.device.canvas.height,l[n+4]=e.texturePage,l[n+5]=e.texturePositionClipSpace.x,l[n+6]=e.texturePositionClipSpace.y,l[n+7]=e.sizeClipSpace.x,l[n+8]=e.sizeClipSpace.y)):l.fill(0,n,n+a-1-2)}clear(){const l=this._terminal,m=l.cols*l.rows*a;this._vertices.count!==m?this._vertices.attributes=new Float32Array(m):this._vertices.attributes.fill(0);let c=0;for(;c<this._vertices.attributesBuffers.length;c++)this._vertices.count!==m?this._vertices.attributesBuffers[c]=new Float32Array(m):this._vertices.attributesBuffers[c].fill(0);this._vertices.count=m,c=0;for(let s=0;s<l.rows;s++)for(let v=0;v<l.cols;v++)this._vertices.attributes[c+9]=v/l.cols,this._vertices.attributes[c+10]=s/l.rows,c+=a}handleResize(){const l=this._gl;l.viewport(0,0,l.canvas.width,l.canvas.height),l.uniform2f(this._resolutionLocation,l.canvas.width,l.canvas.height),this.clear()}render(l){if(!this._atlas)return;const m=this._gl;m.useProgram(this._program),m.bindVertexArray(this._vertexArrayObject),this._activeBuffer=(this._activeBuffer+1)%2;const c=this._vertices.attributesBuffers[this._activeBuffer];let s=0;for(let v=0;v<l.lineLengths.length;v++){const C=v*this._terminal.cols*a,o=this._vertices.attributes.subarray(C,C+l.lineLengths[v]*a);c.set(o,s),s+=o.length}m.bindBuffer(m.ARRAY_BUFFER,this._attributesBuffer),m.bufferData(m.ARRAY_BUFFER,c.subarray(0,s),m.STREAM_DRAW);for(let v=0;v<this._atlas.pages.length;v++)this._atlas.pages[v].version!==this._atlasTextures[v].version&&this._bindAtlasPageTexture(m,this._atlas,v);m.drawElementsInstanced(m.TRIANGLE_STRIP,4,m.UNSIGNED_BYTE,0,s/a)}setAtlas(l){this._atlas=l;for(const m of this._atlasTextures)m.version=-1}_bindAtlasPageTexture(l,m,c){l.activeTexture(l.TEXTURE0+c),l.bindTexture(l.TEXTURE_2D,this._atlasTextures[c].texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,m.pages[c].canvas),l.generateMipmap(l.TEXTURE_2D),this._atlasTextures[c].version=m.pages[c].version}setDimensions(l){this._dimensions=l}}},742:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.RectangleRenderer=void 0;const u=d(381),h=d(310),r=d(859),_=d(374),g=8*Float32Array.BYTES_PER_ELEMENT;let a=0,t=!1,e=0,n=0,y=0,x=0,R=0,b=0;i.RectangleRenderer=class l extends r.Disposable{constructor(c,s,v,C){super(),this._terminal=c,this._gl=s,this._dimensions=v,this._themeService=C,this._vertices={count:0,attributes:new Float32Array(160)};const o=this._gl;this._program=(0,_.throwIfFalsy)((0,u.createProgram)(o,"#version 300 es\nlayout (location = 0) in vec2 a_position;\nlayout (location = 1) in vec2 a_size;\nlayout (location = 2) in vec4 a_color;\nlayout (location = 3) in vec2 a_unitquad;\n\nuniform mat4 u_projection;\n\nout vec4 v_color;\n\nvoid main() {\n  vec2 zeroToOne = a_position + (a_unitquad * a_size);\n  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);\n  v_color = a_color;\n}","#version 300 es\nprecision lowp float;\n\nin vec4 v_color;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = v_color;\n}")),this.register((0,r.toDisposable)(()=>o.deleteProgram(this._program))),this._projectionLocation=(0,_.throwIfFalsy)(o.getUniformLocation(this._program,"u_projection")),this._vertexArrayObject=o.createVertexArray(),o.bindVertexArray(this._vertexArrayObject);const f=new Float32Array([0,0,1,0,0,1,1,1]),p=o.createBuffer();this.register((0,r.toDisposable)(()=>o.deleteBuffer(p))),o.bindBuffer(o.ARRAY_BUFFER,p),o.bufferData(o.ARRAY_BUFFER,f,o.STATIC_DRAW),o.enableVertexAttribArray(3),o.vertexAttribPointer(3,2,this._gl.FLOAT,!1,0,0);const M=new Uint8Array([0,1,2,3]),A=o.createBuffer();this.register((0,r.toDisposable)(()=>o.deleteBuffer(A))),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,A),o.bufferData(o.ELEMENT_ARRAY_BUFFER,M,o.STATIC_DRAW),this._attributesBuffer=(0,_.throwIfFalsy)(o.createBuffer()),this.register((0,r.toDisposable)(()=>o.deleteBuffer(this._attributesBuffer))),o.bindBuffer(o.ARRAY_BUFFER,this._attributesBuffer),o.enableVertexAttribArray(0),o.vertexAttribPointer(0,2,o.FLOAT,!1,g,0),o.vertexAttribDivisor(0,1),o.enableVertexAttribArray(1),o.vertexAttribPointer(1,2,o.FLOAT,!1,g,2*Float32Array.BYTES_PER_ELEMENT),o.vertexAttribDivisor(1,1),o.enableVertexAttribArray(2),o.vertexAttribPointer(2,4,o.FLOAT,!1,g,4*Float32Array.BYTES_PER_ELEMENT),o.vertexAttribDivisor(2,1),this._updateCachedColors(C.colors),this.register(this._themeService.onChangeColors(w=>{this._updateCachedColors(w),this._updateViewportRectangle()}))}render(){const c=this._gl;c.useProgram(this._program),c.bindVertexArray(this._vertexArrayObject),c.uniformMatrix4fv(this._projectionLocation,!1,u.PROJECTION_MATRIX),c.bindBuffer(c.ARRAY_BUFFER,this._attributesBuffer),c.bufferData(c.ARRAY_BUFFER,this._vertices.attributes,c.DYNAMIC_DRAW),c.drawElementsInstanced(this._gl.TRIANGLE_STRIP,4,c.UNSIGNED_BYTE,0,this._vertices.count)}handleResize(){this._updateViewportRectangle()}setDimensions(c){this._dimensions=c}_updateCachedColors(c){this._bgFloat=this._colorToFloat32Array(c.background)}_updateViewportRectangle(){this._addRectangleFloat(this._vertices.attributes,0,0,0,this._terminal.cols*this._dimensions.device.cell.width,this._terminal.rows*this._dimensions.device.cell.height,this._bgFloat)}updateBackgrounds(c){const s=this._terminal,v=this._vertices;let C,o,f,p,M,A,w,L,T,E,P,D=1;for(C=0;C<s.rows;C++){for(f=-1,p=0,M=0,A=!1,o=0;o<s.cols;o++)w=(C*s.cols+o)*h.RENDER_MODEL_INDICIES_PER_CELL,L=c.cells[w+h.RENDER_MODEL_BG_OFFSET],T=c.cells[w+h.RENDER_MODEL_FG_OFFSET],E=!!(67108864&T),(L!==p||T!==M&&(A||E))&&((0!==p||A&&0!==M)&&(P=8*D++,this._updateRectangle(v,P,M,p,f,o,C)),f=o,p=L,M=T,A=E);(0!==p||A&&0!==M)&&(P=8*D++,this._updateRectangle(v,P,M,p,f,s.cols,C))}v.count=D}_updateRectangle(c,s,v,C,o,f,p){if(t=!1,67108864&v)switch(50331648&v){case 16777216:case 33554432:a=this._themeService.colors.ansi[255&v].rgba;break;case 50331648:a=(16777215&v)<<8;break;default:a=this._themeService.colors.foreground.rgba}else switch(50331648&C){case 16777216:case 33554432:a=this._themeService.colors.ansi[255&C].rgba;break;case 50331648:a=(16777215&C)<<8;break;default:a=this._themeService.colors.background.rgba,t=!0}c.attributes.length<s+4&&(c.attributes=(0,u.expandFloat32Array)(c.attributes,this._terminal.rows*this._terminal.cols*8)),e=o*this._dimensions.device.cell.width,n=p*this._dimensions.device.cell.height,y=(a>>24&255)/255,x=(a>>16&255)/255,R=(a>>8&255)/255,b=1,this._addRectangle(c.attributes,s,e,n,(f-o)*this._dimensions.device.cell.width,this._dimensions.device.cell.height,y,x,R,b)}_addRectangle(c,s,v,C,o,f,p,M,A,w){c[s]=v/this._dimensions.device.canvas.width,c[s+1]=C/this._dimensions.device.canvas.height,c[s+2]=o/this._dimensions.device.canvas.width,c[s+3]=f/this._dimensions.device.canvas.height,c[s+4]=p,c[s+5]=M,c[s+6]=A,c[s+7]=w}_addRectangleFloat(c,s,v,C,o,f,p){c[s]=v/this._dimensions.device.canvas.width,c[s+1]=C/this._dimensions.device.canvas.height,c[s+2]=o/this._dimensions.device.canvas.width,c[s+3]=f/this._dimensions.device.canvas.height,c[s+4]=p[0],c[s+5]=p[1],c[s+6]=p[2],c[s+7]=p[3]}_colorToFloat32Array(c){return new Float32Array([(c.rgba>>24&255)/255,(c.rgba>>16&255)/255,(c.rgba>>8&255)/255,(255&c.rgba)/255])}}},310:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.RenderModel=i.COMBINED_CHAR_BIT_MASK=i.RENDER_MODEL_EXT_OFFSET=i.RENDER_MODEL_FG_OFFSET=i.RENDER_MODEL_BG_OFFSET=i.RENDER_MODEL_INDICIES_PER_CELL=void 0;const u=d(296);i.RENDER_MODEL_INDICIES_PER_CELL=4,i.RENDER_MODEL_BG_OFFSET=1,i.RENDER_MODEL_FG_OFFSET=2,i.RENDER_MODEL_EXT_OFFSET=3,i.COMBINED_CHAR_BIT_MASK=2147483648,i.RenderModel=class{constructor(){this.cells=new Uint32Array(0),this.lineLengths=new Uint32Array(0),this.selection=(0,u.createSelectionRenderModel)()}resize(h,r){const _=h*r*i.RENDER_MODEL_INDICIES_PER_CELL;_!==this.cells.length&&(this.cells=new Uint32Array(_),this.lineLengths=new Uint32Array(r))}clear(){this.cells.fill(0,0),this.lineLengths.fill(0,0)}}},666:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.JoinedCellData=i.WebglRenderer=void 0;const u=d(820),h=d(274),r=d(627),_=d(56),g=d(374),a=d(147),t=d(782),e=d(855),n=d(345),y=d(859),x=d(965),R=d(742),b=d(461),l=d(733),m=d(310);i.WebglRenderer=class c extends y.Disposable{constructor(o,f,p,M,A,w,L,T,E){if(super(),this._terminal=o,this._characterJoinerService=f,this._charSizeService=p,this._coreBrowserService=M,this._decorationService=w,this._optionsService=L,this._themeService=T,this._model=new m.RenderModel,this._workCell=new t.CellData,this._onChangeTextureAtlas=this.register(new n.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new n.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this.register(new n.EventEmitter),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onRequestRedraw=this.register(new n.EventEmitter),this.onRequestRedraw=this._onRequestRedraw.event,this._onContextLoss=this.register(new n.EventEmitter),this.onContextLoss=this._onContextLoss.event,this.register(this._themeService.onChangeColors(()=>this._handleColorChange())),this._cellColorResolver=new h.CellColorResolver(this._terminal,this._model.selection,this._decorationService,this._coreBrowserService,this._themeService),this._core=this._terminal._core,this._renderLayers=[new l.LinkRenderLayer(this._core.screenElement,2,this._terminal,this._core.linkifier2,this._coreBrowserService,L,this._themeService),new b.CursorRenderLayer(o,this._core.screenElement,3,this._onRequestRedraw,this._coreBrowserService,A,L,this._themeService)],this.dimensions=(0,g.createRenderDimensions)(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this.register(L.onOptionChange(()=>this._handleOptionsChanged())),this._canvas=document.createElement("canvas"),this._gl=this._canvas.getContext("webgl2",{antialias:!1,depth:!1,preserveDrawingBuffer:E}),!this._gl)throw new Error("WebGL2 not supported "+this._gl);this.register((0,u.addDisposableDomListener)(this._canvas,"webglcontextlost",D=>{console.log("webglcontextlost event received"),D.preventDefault(),this._contextRestorationTimeout=setTimeout(()=>{this._contextRestorationTimeout=void 0,console.warn("webgl context not restored; firing onContextLoss"),this._onContextLoss.fire(D)},3e3)})),this.register((0,u.addDisposableDomListener)(this._canvas,"webglcontextrestored",D=>{console.warn("webglcontextrestored event received"),clearTimeout(this._contextRestorationTimeout),this._contextRestorationTimeout=void 0,(0,r.removeTerminalFromCache)(this._terminal),this._initializeWebGLState(),this._requestRedrawViewport()})),this.register((0,_.observeDevicePixelDimensions)(this._canvas,this._coreBrowserService.window,(D,H)=>this._setCanvasDevicePixelDimensions(D,H))),this._core.screenElement.appendChild(this._canvas),[this._rectangleRenderer,this._glyphRenderer]=this._initializeWebGLState(),this._isAttached=this._coreBrowserService.window.document.body.contains(this._core.screenElement),this.register((0,y.toDisposable)(()=>{var D;for(const H of this._renderLayers)H.dispose();null===(D=this._canvas.parentElement)||void 0===D||D.removeChild(this._canvas),(0,r.removeTerminalFromCache)(this._terminal)}))}get textureAtlas(){var o;return null===(o=this._charAtlas)||void 0===o?void 0:o.pages[0].canvas}_handleColorChange(){this._refreshCharAtlas(),this._clearModel(!0)}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._terminal.cols,this._terminal.rows))}handleResize(o,f){var p,M,A,w;this._updateDimensions(),this._model.resize(this._terminal.cols,this._terminal.rows);for(const L of this._renderLayers)L.resize(this._terminal,this.dimensions);this._canvas.width=this.dimensions.device.canvas.width,this._canvas.height=this.dimensions.device.canvas.height,this._canvas.style.width=`${this.dimensions.css.canvas.width}px`,this._canvas.style.height=`${this.dimensions.css.canvas.height}px`,this._core.screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._core.screenElement.style.height=`${this.dimensions.css.canvas.height}px`,null===(p=this._rectangleRenderer)||void 0===p||p.setDimensions(this.dimensions),null===(M=this._rectangleRenderer)||void 0===M||M.handleResize(),null===(A=this._glyphRenderer)||void 0===A||A.setDimensions(this.dimensions),null===(w=this._glyphRenderer)||void 0===w||w.handleResize(),this._refreshCharAtlas(),this._clearModel(!1)}handleCharSizeChanged(){this.handleResize(this._terminal.cols,this._terminal.rows)}handleBlur(){for(const o of this._renderLayers)o.handleBlur(this._terminal);this._requestRedrawViewport()}handleFocus(){for(const o of this._renderLayers)o.handleFocus(this._terminal);this._requestRedrawViewport()}handleSelectionChanged(o,f,p){for(const M of this._renderLayers)M.handleSelectionChanged(this._terminal,o,f,p);this._model.selection.update(this._terminal,o,f,p),this._requestRedrawViewport()}handleCursorMove(){for(const o of this._renderLayers)o.handleCursorMove(this._terminal)}_handleOptionsChanged(){this._updateDimensions(),this._refreshCharAtlas()}_initializeWebGLState(){var o,f;return null===(o=this._rectangleRenderer)||void 0===o||o.dispose(),null===(f=this._glyphRenderer)||void 0===f||f.dispose(),this._rectangleRenderer=this.register(new R.RectangleRenderer(this._terminal,this._gl,this.dimensions,this._themeService)),this._glyphRenderer=this.register(new x.GlyphRenderer(this._terminal,this._gl,this.dimensions)),this.handleCharSizeChanged(),[this._rectangleRenderer,this._glyphRenderer]}_refreshCharAtlas(){var o,f;if(this.dimensions.device.char.width<=0&&this.dimensions.device.char.height<=0)return void(this._isAttached=!1);const p=(0,r.acquireTextureAtlas)(this._terminal,this._optionsService.rawOptions,this._themeService.colors,this.dimensions.device.cell.width,this.dimensions.device.cell.height,this.dimensions.device.char.width,this.dimensions.device.char.height,this._coreBrowserService.dpr);this._charAtlas!==p&&(null===(o=this._charAtlasDisposable)||void 0===o||o.dispose(),this._onChangeTextureAtlas.fire(p.pages[0].canvas),this._charAtlasDisposable=(0,y.getDisposeArrayDisposable)([(0,n.forwardEvent)(p.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),(0,n.forwardEvent)(p.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)])),this._charAtlas=p,this._charAtlas.warmUp(),null===(f=this._glyphRenderer)||void 0===f||f.setAtlas(this._charAtlas)}_clearModel(o){var f;this._model.clear(),o&&(null===(f=this._glyphRenderer)||void 0===f||f.clear())}clearTextureAtlas(){var o;null===(o=this._charAtlas)||void 0===o||o.clearTexture(),this._clearModel(!0),this._requestRedrawViewport()}clear(){this._clearModel(!0);for(const o of this._renderLayers)o.reset(this._terminal)}registerCharacterJoiner(o){return-1}deregisterCharacterJoiner(o){return!1}renderRows(o,f){var p,M;if(!this._isAttached){if(!(this._coreBrowserService.window.document.body.contains(this._core.screenElement)&&this._charSizeService.width&&this._charSizeService.height))return;this._updateDimensions(),this._refreshCharAtlas(),this._isAttached=!0}for(const A of this._renderLayers)A.handleGridChanged(this._terminal,o,f);this._glyphRenderer&&this._rectangleRenderer&&(this._glyphRenderer.beginFrame()?(this._clearModel(!0),this._updateModel(0,this._terminal.rows-1)):this._updateModel(o,f),null===(p=this._rectangleRenderer)||void 0===p||p.render(),null===(M=this._glyphRenderer)||void 0===M||M.render(this._model))}_updateModel(o,f){const p=this._core;let M,A,w,L,T,E,P,D,H,W,N,I,z,q=this._workCell;for(o=v(o,p.rows-1,0),f=v(f,p.rows-1,0),A=o;A<=f;A++)for(w=A+p.buffer.ydisp,L=p.buffer.lines.get(w),this._model.lineLengths[A]=0,T=this._characterJoinerService.getJoinedCharacters(w),I=0;I<p.cols;I++)if(M=this._cellColorResolver.result.bg,L.loadCell(I,q),0===I&&(M=this._cellColorResolver.result.bg),E=!1,P=I,T.length>0&&I===T[0][0]&&(E=!0,D=T.shift(),q=new s(q,L.translateToString(!0,D[0],D[1]),D[1]-D[0]),P=D[1]-1),H=q.getChars(),W=q.getCode(),N=(A*p.cols+I)*m.RENDER_MODEL_INDICIES_PER_CELL,this._cellColorResolver.resolve(q,I,w),W!==e.NULL_CELL_CODE&&(this._model.lineLengths[A]=I+1),(this._model.cells[N]!==W||this._model.cells[N+m.RENDER_MODEL_BG_OFFSET]!==this._cellColorResolver.result.bg||this._model.cells[N+m.RENDER_MODEL_FG_OFFSET]!==this._cellColorResolver.result.fg||this._model.cells[N+m.RENDER_MODEL_EXT_OFFSET]!==this._cellColorResolver.result.ext)&&(H.length>1&&(W|=m.COMBINED_CHAR_BIT_MASK),this._model.cells[N]=W,this._model.cells[N+m.RENDER_MODEL_BG_OFFSET]=this._cellColorResolver.result.bg,this._model.cells[N+m.RENDER_MODEL_FG_OFFSET]=this._cellColorResolver.result.fg,this._model.cells[N+m.RENDER_MODEL_EXT_OFFSET]=this._cellColorResolver.result.ext,this._glyphRenderer.updateCell(I,A,W,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,H,M),E))for(q=this._workCell,I++;I<P;I++)z=(A*p.cols+I)*m.RENDER_MODEL_INDICIES_PER_CELL,this._glyphRenderer.updateCell(I,A,e.NULL_CELL_CODE,0,0,0,e.NULL_CELL_CHAR,0),this._model.cells[z]=e.NULL_CELL_CODE,this._model.cells[z+m.RENDER_MODEL_BG_OFFSET]=this._cellColorResolver.result.bg,this._model.cells[z+m.RENDER_MODEL_FG_OFFSET]=this._cellColorResolver.result.fg,this._model.cells[z+m.RENDER_MODEL_EXT_OFFSET]=this._cellColorResolver.result.ext;this._rectangleRenderer.updateBackgrounds(this._model)}_updateDimensions(){this._charSizeService.width&&this._charSizeService.height&&(this.dimensions.device.char.width=Math.floor(this._charSizeService.width*this._devicePixelRatio),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*this._devicePixelRatio),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=1===this._optionsService.rawOptions.lineHeight?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._terminal.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._terminal.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/this._devicePixelRatio),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/this._devicePixelRatio),this.dimensions.css.cell.height=this.dimensions.device.cell.height/this._devicePixelRatio,this.dimensions.css.cell.width=this.dimensions.device.cell.width/this._devicePixelRatio)}_setCanvasDevicePixelDimensions(o,f){this._canvas.width===o&&this._canvas.height===f||(this._canvas.width=o,this._canvas.height=f,this._requestRedrawViewport())}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._terminal.rows-1})}};class s extends a.AttributeData{constructor(o,f,p){super(),this.content=0,this.combinedData="",this.fg=o.fg,this.bg=o.bg,this.combinedData=f,this._width=p}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(o){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}function v(C,o,f=0){return Math.max(Math.min(C,o),f)}i.JoinedCellData=s},381:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.GLTexture=i.expandFloat32Array=i.createShader=i.createProgram=i.PROJECTION_MATRIX=void 0;const u=d(374);function h(r,_,g){const a=(0,u.throwIfFalsy)(r.createShader(_));if(r.shaderSource(a,g),r.compileShader(a),r.getShaderParameter(a,r.COMPILE_STATUS))return a;console.error(r.getShaderInfoLog(a)),r.deleteShader(a)}i.PROJECTION_MATRIX=new Float32Array([2,0,0,0,0,-2,0,0,0,0,1,0,-1,1,0,1]),i.createProgram=function(r,_,g){const a=(0,u.throwIfFalsy)(r.createProgram());if(r.attachShader(a,(0,u.throwIfFalsy)(h(r,r.VERTEX_SHADER,_))),r.attachShader(a,(0,u.throwIfFalsy)(h(r,r.FRAGMENT_SHADER,g))),r.linkProgram(a),r.getProgramParameter(a,r.LINK_STATUS))return a;console.error(r.getProgramInfoLog(a)),r.deleteProgram(a)},i.createShader=h,i.expandFloat32Array=function(r,_){const g=Math.min(2*r.length,_),a=new Float32Array(g);for(let t=0;t<r.length;t++)a[t]=r[t];return a},i.GLTexture=class{constructor(r){this.texture=r,this.version=-1}}},592:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BaseRenderLayer=void 0;const u=d(627),h=d(237),r=d(374),_=d(859);i.BaseRenderLayer=class g extends _.Disposable{constructor(t,e,n,y,x,R,b,l){super(),this._container=e,this._alpha=x,this._coreBrowserService=R,this._optionsService=b,this._themeService=l,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add(`xterm-${n}-layer`),this._canvas.style.zIndex=y.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this.register(this._themeService.onChangeColors(m=>{this._refreshCharAtlas(t,m),this.reset(t)})),this.register((0,_.toDisposable)(()=>{var m;this._canvas.remove(),null===(m=this._charAtlas)||void 0===m||m.dispose()}))}_initCanvas(){this._ctx=(0,r.throwIfFalsy)(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur(t){}handleFocus(t){}handleCursorMove(t){}handleGridChanged(t,e,n){}handleSelectionChanged(t,e,n,y=!1){}_setTransparency(t,e){if(e===this._alpha)return;const n=this._canvas;this._alpha=e,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,n),this._refreshCharAtlas(t,this._themeService.colors),this.handleGridChanged(t,0,t.rows-1)}_refreshCharAtlas(t,e){this._deviceCharWidth<=0&&this._deviceCharHeight<=0||(this._charAtlas=(0,u.acquireTextureAtlas)(t,this._optionsService.rawOptions,e,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr),this._charAtlas.warmUp())}resize(t,e){this._deviceCellWidth=e.device.cell.width,this._deviceCellHeight=e.device.cell.height,this._deviceCharWidth=e.device.char.width,this._deviceCharHeight=e.device.char.height,this._deviceCharLeft=e.device.char.left,this._deviceCharTop=e.device.char.top,this._canvas.width=e.device.canvas.width,this._canvas.height=e.device.canvas.height,this._canvas.style.width=`${e.css.canvas.width}px`,this._canvas.style.height=`${e.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(t,this._themeService.colors)}_fillCells(t,e,n,y){this._ctx.fillRect(t*this._deviceCellWidth,e*this._deviceCellHeight,n*this._deviceCellWidth,y*this._deviceCellHeight)}_fillBottomLineAtCells(t,e,n=1){this._ctx.fillRect(t*this._deviceCellWidth,(e+1)*this._deviceCellHeight-this._coreBrowserService.dpr-1,n*this._deviceCellWidth,this._coreBrowserService.dpr)}_fillLeftLineAtCell(t,e,n){this._ctx.fillRect(t*this._deviceCellWidth,e*this._deviceCellHeight,this._coreBrowserService.dpr*n,this._deviceCellHeight)}_strokeRectAtCell(t,e,n,y){this._ctx.lineWidth=this._coreBrowserService.dpr,this._ctx.strokeRect(t*this._deviceCellWidth+this._coreBrowserService.dpr/2,e*this._deviceCellHeight+this._coreBrowserService.dpr/2,n*this._deviceCellWidth-this._coreBrowserService.dpr,y*this._deviceCellHeight-this._coreBrowserService.dpr)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(t,e,n,y){this._alpha?this._ctx.clearRect(t*this._deviceCellWidth,e*this._deviceCellHeight,n*this._deviceCellWidth,y*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(t*this._deviceCellWidth,e*this._deviceCellHeight,n*this._deviceCellWidth,y*this._deviceCellHeight))}_fillCharTrueColor(t,e,n,y){this._ctx.font=this._getFont(t,!1,!1),this._ctx.textBaseline=h.TEXT_BASELINE,this._clipCell(n,y,e.getWidth()),this._ctx.fillText(e.getChars(),n*this._deviceCellWidth+this._deviceCharLeft,y*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_clipCell(t,e,n){this._ctx.beginPath(),this._ctx.rect(t*this._deviceCellWidth,e*this._deviceCellHeight,n*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont(t,e,n){return`${n?"italic":""} ${e?t.options.fontWeightBold:t.options.fontWeight} ${t.options.fontSize*this._coreBrowserService.dpr}px ${t.options.fontFamily}`}}},461:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CursorRenderLayer=void 0;const u=d(592),h=d(782),r=d(859),_=d(399);i.CursorRenderLayer=class g extends u.BaseRenderLayer{constructor(e,n,y,x,R,b,l,m){super(e,n,"cursor",y,!0,R,l,m),this._onRequestRefreshRowsEvent=x,this._coreService=b,this._cell=new h.CellData,this._state={x:0,y:0,isFocused:!1,style:"",width:0},this._cursorRenderers={bar:this._renderBarCursor.bind(this),block:this._renderBlockCursor.bind(this),underline:this._renderUnderlineCursor.bind(this)},this._handleOptionsChanged(e),this.register(l.onOptionChange(()=>this._handleOptionsChanged(e))),this.register((0,r.toDisposable)(()=>{var c;null===(c=this._cursorBlinkStateManager)||void 0===c||c.dispose(),this._cursorBlinkStateManager=void 0}))}resize(e,n){super.resize(e,n),this._state={x:0,y:0,isFocused:!1,style:"",width:0}}reset(e){var n;this._clearCursor(),null===(n=this._cursorBlinkStateManager)||void 0===n||n.restartBlinkAnimation(e),this._handleOptionsChanged(e)}handleBlur(e){var n;null===(n=this._cursorBlinkStateManager)||void 0===n||n.pause(),this._onRequestRefreshRowsEvent.fire({start:e.buffer.active.cursorY,end:e.buffer.active.cursorY})}handleFocus(e){var n;null===(n=this._cursorBlinkStateManager)||void 0===n||n.resume(e),this._onRequestRefreshRowsEvent.fire({start:e.buffer.active.cursorY,end:e.buffer.active.cursorY})}_handleOptionsChanged(e){var n;e.options.cursorBlink?this._cursorBlinkStateManager||(this._cursorBlinkStateManager=new a(()=>{this._render(e,!0)},this._coreBrowserService)):(null===(n=this._cursorBlinkStateManager)||void 0===n||n.dispose(),this._cursorBlinkStateManager=void 0),this._onRequestRefreshRowsEvent.fire({start:e.buffer.active.cursorY,end:e.buffer.active.cursorY})}handleCursorMove(e){var n;null===(n=this._cursorBlinkStateManager)||void 0===n||n.restartBlinkAnimation(e)}handleGridChanged(e,n,y){!this._cursorBlinkStateManager||this._cursorBlinkStateManager.isPaused?this._render(e,!1):this._cursorBlinkStateManager.restartBlinkAnimation(e)}_render(e,n){if(!this._coreService.isCursorInitialized||this._coreService.isCursorHidden)return void this._clearCursor();const y=e.buffer.active.baseY+e.buffer.active.cursorY,x=y-e.buffer.active.viewportY,R=Math.min(e.buffer.active.cursorX,e.cols-1);if(x<0||x>=e.rows)this._clearCursor();else if(e._core.buffer.lines.get(y).loadCell(R,this._cell),void 0!==this._cell.content){if(!this._coreBrowserService.isFocused){this._clearCursor(),this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css;const b=e.options.cursorStyle;return this._renderBlurCursor(e,R,x,this._cell),this._ctx.restore(),this._state.x=R,this._state.y=x,this._state.isFocused=!1,this._state.style=b,void(this._state.width=this._cell.getWidth())}if(!this._cursorBlinkStateManager||this._cursorBlinkStateManager.isCursorVisible){if(this._state){if(this._state.x===R&&this._state.y===x&&this._state.isFocused===this._coreBrowserService.isFocused&&this._state.style===e.options.cursorStyle&&this._state.width===this._cell.getWidth())return;this._clearCursor()}this._ctx.save(),this._cursorRenderers[e.options.cursorStyle||"block"](e,R,x,this._cell),this._ctx.restore(),this._state.x=R,this._state.y=x,this._state.isFocused=!1,this._state.style=e.options.cursorStyle,this._state.width=this._cell.getWidth()}else this._clearCursor()}}_clearCursor(){this._state&&(_.isFirefox||this._coreBrowserService.dpr<1?this._clearAll():this._clearCells(this._state.x,this._state.y,this._state.width,1),this._state={x:0,y:0,isFocused:!1,style:"",width:0})}_renderBarCursor(e,n,y,x){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillLeftLineAtCell(n,y,this._optionsService.rawOptions.cursorWidth),this._ctx.restore()}_renderBlockCursor(e,n,y,x){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillCells(n,y,x.getWidth(),1),this._ctx.fillStyle=this._themeService.colors.cursorAccent.css,this._fillCharTrueColor(e,x,n,y),this._ctx.restore()}_renderUnderlineCursor(e,n,y,x){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillBottomLineAtCells(n,y),this._ctx.restore()}_renderBlurCursor(e,n,y,x){this._ctx.save(),this._ctx.strokeStyle=this._themeService.colors.cursor.css,this._strokeRectAtCell(n,y,x.getWidth(),1),this._ctx.restore()}};class a{constructor(e,n){this._renderCallback=e,this._coreBrowserService=n,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(e){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval(e=600){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout(()=>{if(this._animationTimeRestarted){const n=600-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,n>0)return void this._restartInterval(n)}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=this._coreBrowserService.window.setInterval(()=>{if(this._animationTimeRestarted){const n=600-(Date.now()-this._animationTimeRestarted);return this._animationTimeRestarted=void 0,void this._restartInterval(n)}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},600)},e)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(e){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation(e)}}},733:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.LinkRenderLayer=void 0;const u=d(197),h=d(237),r=d(592);i.LinkRenderLayer=class _ extends r.BaseRenderLayer{constructor(a,t,e,n,y,x,R){super(e,a,"link",t,!0,y,x,R),this.register(n.onShowLinkUnderline(b=>this._handleShowLinkUnderline(b))),this.register(n.onHideLinkUnderline(b=>this._handleHideLinkUnderline(b)))}resize(a,t){super.resize(a,t),this._state=void 0}reset(a){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);const a=this._state.y2-this._state.y1-1;a>0&&this._clearCells(0,this._state.y1+1,this._state.cols,a),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline(a){if(this._ctx.fillStyle=a.fg===h.INVERTED_DEFAULT_COLOR?this._themeService.colors.background.css:void 0!==a.fg&&(0,u.is256Color)(a.fg)?this._themeService.colors.ansi[a.fg].css:this._themeService.colors.foreground.css,a.y1===a.y2)this._fillBottomLineAtCells(a.x1,a.y1,a.x2-a.x1);else{this._fillBottomLineAtCells(a.x1,a.y1,a.cols-a.x1);for(let t=a.y1+1;t<a.y2;t++)this._fillBottomLineAtCells(0,t,a.cols);this._fillBottomLineAtCells(0,a.y2,a.x2)}this._state=a}_handleHideLinkUnderline(a){this._clearCurrentLink()}}},820:(B,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.addDisposableDomListener=void 0,i.addDisposableDomListener=function(d,u,h,r){d.addEventListener(u,h,r);let _=!1;return{dispose:()=>{_||(_=!0,d.removeEventListener(u,h,r))}}}},274:(B,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CellColorResolver=void 0;let d,u=0,h=0,r=!1,_=!1,g=!1;i.CellColorResolver=class{constructor(a,t,e,n,y){this._terminal=a,this._selectionRenderModel=t,this._decorationService=e,this._coreBrowserService=n,this._themeService=y,this.result={fg:0,bg:0,ext:0}}resolve(a,t,e){this.result.bg=a.bg,this.result.fg=a.fg,this.result.ext=268435456&a.bg?a.extended.ext:0,h=0,u=0,_=!1,r=!1,g=!1,d=this._themeService.colors,this._decorationService.forEachDecorationAtCell(t,e,"bottom",n=>{n.backgroundColorRGB&&(h=n.backgroundColorRGB.rgba>>8&16777215,_=!0),n.foregroundColorRGB&&(u=n.foregroundColorRGB.rgba>>8&16777215,r=!0)}),g=this._selectionRenderModel.isCellSelected(this._terminal,t,e),g&&(h=(this._coreBrowserService.isFocused?d.selectionBackgroundOpaque:d.selectionInactiveBackgroundOpaque).rgba>>8&16777215,_=!0,d.selectionForeground&&(u=d.selectionForeground.rgba>>8&16777215,r=!0)),this._decorationService.forEachDecorationAtCell(t,e,"top",n=>{n.backgroundColorRGB&&(h=n.backgroundColorRGB.rgba>>8&16777215,_=!0),n.foregroundColorRGB&&(u=n.foregroundColorRGB.rgba>>8&16777215,r=!0)}),_&&(h=g?-16777216&a.bg&-134217729|h|50331648:-16777216&a.bg|h|50331648),r&&(u=-16777216&a.fg&-67108865|u|50331648),67108864&this.result.fg&&(_&&!r&&(u=50331648&this.result.bg?-134217728&this.result.fg|67108863&this.result.bg:-134217728&this.result.fg|16777215&d.background.rgba>>8|50331648,r=!0),!_&&r&&(h=50331648&this.result.fg?-67108864&this.result.bg|67108863&this.result.fg:-67108864&this.result.bg|16777215&d.foreground.rgba>>8|50331648,_=!0)),d=void 0,this.result.bg=_?h:this.result.bg,this.result.fg=r?u:this.result.fg}}},627:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.removeTerminalFromCache=i.acquireTextureAtlas=void 0;const u=d(509),h=d(197),r=[];i.acquireTextureAtlas=function(_,g,a,t,e,n,y,x){const R=(0,h.generateConfig)(t,e,n,y,g,a,x);for(let m=0;m<r.length;m++){const c=r[m],s=c.ownedBy.indexOf(_);if(s>=0){if((0,h.configEquals)(c.config,R))return c.atlas;1===c.ownedBy.length?(c.atlas.dispose(),r.splice(m,1)):c.ownedBy.splice(s,1);break}}for(let m=0;m<r.length;m++){const c=r[m];if((0,h.configEquals)(c.config,R))return c.ownedBy.push(_),c.atlas}const l={atlas:new u.TextureAtlas(document,R,_._core.unicodeService),config:R,ownedBy:[_]};return r.push(l),l.atlas},i.removeTerminalFromCache=function(_){for(let g=0;g<r.length;g++){const a=r[g].ownedBy.indexOf(_);if(-1!==a){1===r[g].ownedBy.length?(r[g].atlas.dispose(),r.splice(g,1)):r[g].ownedBy.splice(a,1);break}}}},197:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.is256Color=i.configEquals=i.generateConfig=void 0;const u=d(160);i.generateConfig=function(h,r,_,g,a,t,e){const n={foreground:t.foreground,background:t.background,cursor:u.NULL_COLOR,cursorAccent:u.NULL_COLOR,selectionForeground:u.NULL_COLOR,selectionBackgroundTransparent:u.NULL_COLOR,selectionBackgroundOpaque:u.NULL_COLOR,selectionInactiveBackgroundTransparent:u.NULL_COLOR,selectionInactiveBackgroundOpaque:u.NULL_COLOR,ansi:t.ansi.slice(),contrastCache:t.contrastCache};return{customGlyphs:a.customGlyphs,devicePixelRatio:e,letterSpacing:a.letterSpacing,lineHeight:a.lineHeight,deviceCellWidth:h,deviceCellHeight:r,deviceCharWidth:_,deviceCharHeight:g,fontFamily:a.fontFamily,fontSize:a.fontSize,fontWeight:a.fontWeight,fontWeightBold:a.fontWeightBold,allowTransparency:a.allowTransparency,drawBoldTextInBrightColors:a.drawBoldTextInBrightColors,minimumContrastRatio:a.minimumContrastRatio,colors:n}},i.configEquals=function(h,r){for(let _=0;_<h.colors.ansi.length;_++)if(h.colors.ansi[_].rgba!==r.colors.ansi[_].rgba)return!1;return h.devicePixelRatio===r.devicePixelRatio&&h.customGlyphs===r.customGlyphs&&h.lineHeight===r.lineHeight&&h.letterSpacing===r.letterSpacing&&h.fontFamily===r.fontFamily&&h.fontSize===r.fontSize&&h.fontWeight===r.fontWeight&&h.fontWeightBold===r.fontWeightBold&&h.allowTransparency===r.allowTransparency&&h.deviceCharWidth===r.deviceCharWidth&&h.deviceCharHeight===r.deviceCharHeight&&h.drawBoldTextInBrightColors===r.drawBoldTextInBrightColors&&h.minimumContrastRatio===r.minimumContrastRatio&&h.colors.foreground.rgba===r.colors.foreground.rgba&&h.colors.background.rgba===r.colors.background.rgba},i.is256Color=function(h){return 16777216==(50331648&h)||33554432==(50331648&h)}},237:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TEXT_BASELINE=i.DIM_OPACITY=i.INVERTED_DEFAULT_COLOR=void 0;const u=d(399);i.INVERTED_DEFAULT_COLOR=257,i.DIM_OPACITY=.5,i.TEXT_BASELINE=u.isFirefox||u.isLegacyEdge?"bottom":"ideographic"},860:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.tryDrawCustomChar=i.powerlineDefinitions=i.boxDrawingDefinitions=i.blockElementDefinitions=void 0;const u=d(374);i.blockElementDefinitions={"\u2580":[{x:0,y:0,w:8,h:4}],"\u2581":[{x:0,y:7,w:8,h:1}],"\u2582":[{x:0,y:6,w:8,h:2}],"\u2583":[{x:0,y:5,w:8,h:3}],"\u2584":[{x:0,y:4,w:8,h:4}],"\u2585":[{x:0,y:3,w:8,h:5}],"\u2586":[{x:0,y:2,w:8,h:6}],"\u2587":[{x:0,y:1,w:8,h:7}],"\u2588":[{x:0,y:0,w:8,h:8}],"\u2589":[{x:0,y:0,w:7,h:8}],"\u258a":[{x:0,y:0,w:6,h:8}],"\u258b":[{x:0,y:0,w:5,h:8}],"\u258c":[{x:0,y:0,w:4,h:8}],"\u258d":[{x:0,y:0,w:3,h:8}],"\u258e":[{x:0,y:0,w:2,h:8}],"\u258f":[{x:0,y:0,w:1,h:8}],"\u2590":[{x:4,y:0,w:4,h:8}],"\u2594":[{x:0,y:0,w:8,h:1}],"\u2595":[{x:7,y:0,w:1,h:8}],"\u2596":[{x:0,y:4,w:4,h:4}],"\u2597":[{x:4,y:4,w:4,h:4}],"\u2598":[{x:0,y:0,w:4,h:4}],"\u2599":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u259a":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"\u259b":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"\u259c":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"\u259d":[{x:4,y:0,w:4,h:4}],"\u259e":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"\u259f":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u{1fb70}":[{x:1,y:0,w:1,h:8}],"\u{1fb71}":[{x:2,y:0,w:1,h:8}],"\u{1fb72}":[{x:3,y:0,w:1,h:8}],"\u{1fb73}":[{x:4,y:0,w:1,h:8}],"\u{1fb74}":[{x:5,y:0,w:1,h:8}],"\u{1fb75}":[{x:6,y:0,w:1,h:8}],"\u{1fb76}":[{x:0,y:1,w:8,h:1}],"\u{1fb77}":[{x:0,y:2,w:8,h:1}],"\u{1fb78}":[{x:0,y:3,w:8,h:1}],"\u{1fb79}":[{x:0,y:4,w:8,h:1}],"\u{1fb7a}":[{x:0,y:5,w:8,h:1}],"\u{1fb7b}":[{x:0,y:6,w:8,h:1}],"\u{1fb7c}":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1fb7d}":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1fb7e}":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1fb7f}":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1fb80}":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1fb81}":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1fb82}":[{x:0,y:0,w:8,h:2}],"\u{1fb83}":[{x:0,y:0,w:8,h:3}],"\u{1fb84}":[{x:0,y:0,w:8,h:5}],"\u{1fb85}":[{x:0,y:0,w:8,h:6}],"\u{1fb86}":[{x:0,y:0,w:8,h:7}],"\u{1fb87}":[{x:6,y:0,w:2,h:8}],"\u{1fb88}":[{x:5,y:0,w:3,h:8}],"\u{1fb89}":[{x:3,y:0,w:5,h:8}],"\u{1fb8a}":[{x:2,y:0,w:6,h:8}],"\u{1fb8b}":[{x:1,y:0,w:7,h:8}],"\u{1fb95}":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"\u{1fb96}":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"\u{1fb97}":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]};const h={"\u2591":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"\u2592":[[1,0],[0,0],[0,1],[0,0]],"\u2593":[[0,1],[1,1],[1,0],[1,1]]};i.boxDrawingDefinitions={"\u2500":{1:"M0,.5 L1,.5"},"\u2501":{3:"M0,.5 L1,.5"},"\u2502":{1:"M.5,0 L.5,1"},"\u2503":{3:"M.5,0 L.5,1"},"\u250c":{1:"M0.5,1 L.5,.5 L1,.5"},"\u250f":{3:"M0.5,1 L.5,.5 L1,.5"},"\u2510":{1:"M0,.5 L.5,.5 L.5,1"},"\u2513":{3:"M0,.5 L.5,.5 L.5,1"},"\u2514":{1:"M.5,0 L.5,.5 L1,.5"},"\u2517":{3:"M.5,0 L.5,.5 L1,.5"},"\u2518":{1:"M.5,0 L.5,.5 L0,.5"},"\u251b":{3:"M.5,0 L.5,.5 L0,.5"},"\u251c":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2523":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2524":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252b":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252c":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2533":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2534":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253b":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253c":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u254b":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u2574":{1:"M.5,.5 L0,.5"},"\u2578":{3:"M.5,.5 L0,.5"},"\u2575":{1:"M.5,.5 L.5,0"},"\u2579":{3:"M.5,.5 L.5,0"},"\u2576":{1:"M.5,.5 L1,.5"},"\u257a":{3:"M.5,.5 L1,.5"},"\u2577":{1:"M.5,.5 L.5,1"},"\u257b":{3:"M.5,.5 L.5,1"},"\u2550":{1:(t,e)=>`M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e}`},"\u2551":{1:(t,e)=>`M${.5-t},0 L${.5-t},1 M${.5+t},0 L${.5+t},1`},"\u2552":{1:(t,e)=>`M.5,1 L.5,${.5-e} L1,${.5-e} M.5,${.5+e} L1,${.5+e}`},"\u2553":{1:(t,e)=>`M${.5-t},1 L${.5-t},.5 L1,.5 M${.5+t},.5 L${.5+t},1`},"\u2554":{1:(t,e)=>`M1,${.5-e} L${.5-t},${.5-e} L${.5-t},1 M1,${.5+e} L${.5+t},${.5+e} L${.5+t},1`},"\u2555":{1:(t,e)=>`M0,${.5-e} L.5,${.5-e} L.5,1 M0,${.5+e} L.5,${.5+e}`},"\u2556":{1:(t,e)=>`M${.5+t},1 L${.5+t},.5 L0,.5 M${.5-t},.5 L${.5-t},1`},"\u2557":{1:(t,e)=>`M0,${.5+e} L${.5-t},${.5+e} L${.5-t},1 M0,${.5-e} L${.5+t},${.5-e} L${.5+t},1`},"\u2558":{1:(t,e)=>`M.5,0 L.5,${.5+e} L1,${.5+e} M.5,${.5-e} L1,${.5-e}`},"\u2559":{1:(t,e)=>`M1,.5 L${.5-t},.5 L${.5-t},0 M${.5+t},.5 L${.5+t},0`},"\u255a":{1:(t,e)=>`M1,${.5-e} L${.5+t},${.5-e} L${.5+t},0 M1,${.5+e} L${.5-t},${.5+e} L${.5-t},0`},"\u255b":{1:(t,e)=>`M0,${.5+e} L.5,${.5+e} L.5,0 M0,${.5-e} L.5,${.5-e}`},"\u255c":{1:(t,e)=>`M0,.5 L${.5+t},.5 L${.5+t},0 M${.5-t},.5 L${.5-t},0`},"\u255d":{1:(t,e)=>`M0,${.5-e} L${.5-t},${.5-e} L${.5-t},0 M0,${.5+e} L${.5+t},${.5+e} L${.5+t},0`},"\u255e":{1:(t,e)=>`M.5,0 L.5,1 M.5,${.5-e} L1,${.5-e} M.5,${.5+e} L1,${.5+e}`},"\u255f":{1:(t,e)=>`M${.5-t},0 L${.5-t},1 M${.5+t},0 L${.5+t},1 M${.5+t},.5 L1,.5`},"\u2560":{1:(t,e)=>`M${.5-t},0 L${.5-t},1 M1,${.5+e} L${.5+t},${.5+e} L${.5+t},1 M1,${.5-e} L${.5+t},${.5-e} L${.5+t},0`},"\u2561":{1:(t,e)=>`M.5,0 L.5,1 M0,${.5-e} L.5,${.5-e} M0,${.5+e} L.5,${.5+e}`},"\u2562":{1:(t,e)=>`M0,.5 L${.5-t},.5 M${.5-t},0 L${.5-t},1 M${.5+t},0 L${.5+t},1`},"\u2563":{1:(t,e)=>`M${.5+t},0 L${.5+t},1 M0,${.5+e} L${.5-t},${.5+e} L${.5-t},1 M0,${.5-e} L${.5-t},${.5-e} L${.5-t},0`},"\u2564":{1:(t,e)=>`M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e} M.5,${.5+e} L.5,1`},"\u2565":{1:(t,e)=>`M0,.5 L1,.5 M${.5-t},.5 L${.5-t},1 M${.5+t},.5 L${.5+t},1`},"\u2566":{1:(t,e)=>`M0,${.5-e} L1,${.5-e} M0,${.5+e} L${.5-t},${.5+e} L${.5-t},1 M1,${.5+e} L${.5+t},${.5+e} L${.5+t},1`},"\u2567":{1:(t,e)=>`M.5,0 L.5,${.5-e} M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e}`},"\u2568":{1:(t,e)=>`M0,.5 L1,.5 M${.5-t},.5 L${.5-t},0 M${.5+t},.5 L${.5+t},0`},"\u2569":{1:(t,e)=>`M0,${.5+e} L1,${.5+e} M0,${.5-e} L${.5-t},${.5-e} L${.5-t},0 M1,${.5-e} L${.5+t},${.5-e} L${.5+t},0`},"\u256a":{1:(t,e)=>`M.5,0 L.5,1 M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e}`},"\u256b":{1:(t,e)=>`M0,.5 L1,.5 M${.5-t},0 L${.5-t},1 M${.5+t},0 L${.5+t},1`},"\u256c":{1:(t,e)=>`M0,${.5+e} L${.5-t},${.5+e} L${.5-t},1 M1,${.5+e} L${.5+t},${.5+e} L${.5+t},1 M0,${.5-e} L${.5-t},${.5-e} L${.5-t},0 M1,${.5-e} L${.5+t},${.5-e} L${.5+t},0`},"\u2571":{1:"M1,0 L0,1"},"\u2572":{1:"M0,0 L1,1"},"\u2573":{1:"M1,0 L0,1 M0,0 L1,1"},"\u257c":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u257d":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"\u257e":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u257f":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u250d":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u250e":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2511":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"\u2512":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2515":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"\u2516":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2519":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"\u251a":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"\u251d":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"\u251e":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u251f":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2520":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2521":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2522":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"\u2525":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"\u2526":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2527":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2528":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"\u2529":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"\u252a":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"\u252d":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u252e":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u252f":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"\u2530":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2531":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2532":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2535":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u2536":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u2537":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"\u2538":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2539":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u253a":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"\u253d":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u253e":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u253f":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"\u2540":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2541":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2542":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2543":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u2544":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2545":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2546":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2547":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"\u2548":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2549":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u254a":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u254c":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u254d":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u2504":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2505":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2508":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u2509":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u254e":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u254f":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u2506":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u2507":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u250a":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u250b":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u256d":{1:(t,e)=>`M.5,1 L.5,${.5+e/.15*.5} C.5,${.5+e/.15*.5},.5,.5,1,.5`},"\u256e":{1:(t,e)=>`M.5,1 L.5,${.5+e/.15*.5} C.5,${.5+e/.15*.5},.5,.5,0,.5`},"\u256f":{1:(t,e)=>`M.5,0 L.5,${.5-e/.15*.5} C.5,${.5-e/.15*.5},.5,.5,0,.5`},"\u2570":{1:(t,e)=>`M.5,0 L.5,${.5-e/.15*.5} C.5,${.5-e/.15*.5},.5,.5,1,.5`}},i.powerlineDefinitions={"\ue0b0":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"\ue0b1":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"\ue0b2":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"\ue0b3":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"\ue0b4":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"\ue0b5":{d:"M0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:1,rightPadding:1},"\ue0b6":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"\ue0b7":{d:"M1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:1,leftPadding:1},"\ue0b8":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"\ue0b9":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"\ue0ba":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"\ue0bc":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"\ue0bd":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"\ue0be":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}},i.powerlineDefinitions["\ue0bb"]=i.powerlineDefinitions["\ue0bd"],i.powerlineDefinitions["\ue0bf"]=i.powerlineDefinitions["\ue0b9"],i.tryDrawCustomChar=function(t,e,n,y,x,R,b,l){const m=i.blockElementDefinitions[e];if(m)return function(C,o,f,p,M,A){for(let w=0;w<o.length;w++){const L=o[w],T=M/8,E=A/8;C.fillRect(f+L.x*T,p+L.y*E,L.w*T,L.h*E)}}(t,m,n,y,x,R),!0;const c=h[e];if(c)return function(C,o,f,p,M,A){let w=r.get(o);w||(w=new Map,r.set(o,w));const L=C.fillStyle;if("string"!=typeof L)throw new Error(`Unexpected fillStyle type "${L}"`);let T=w.get(L);if(!T){const E=o[0].length,P=o.length,D=document.createElement("canvas");D.width=E,D.height=P;const H=(0,u.throwIfFalsy)(D.getContext("2d")),W=new ImageData(E,P);let N,I,z,q;if(L.startsWith("#"))N=parseInt(L.slice(1,3),16),I=parseInt(L.slice(3,5),16),z=parseInt(L.slice(5,7),16),q=L.length>7&&parseInt(L.slice(7,9),16)||1;else{if(!L.startsWith("rgba"))throw new Error(`Unexpected fillStyle color format "${L}" when drawing pattern glyph`);[N,I,z,q]=L.substring(5,L.length-1).split(",").map(j=>parseFloat(j))}for(let j=0;j<P;j++)for(let K=0;K<E;K++)W.data[4*(j*E+K)]=N,W.data[4*(j*E+K)+1]=I,W.data[4*(j*E+K)+2]=z,W.data[4*(j*E+K)+3]=o[j][K]*(255*q);H.putImageData(W,0,0),T=(0,u.throwIfFalsy)(C.createPattern(D,null)),w.set(L,T)}C.fillStyle=T,C.fillRect(f,p,M,A)}(t,c,n,y,x,R),!0;const s=i.boxDrawingDefinitions[e];if(s)return function(C,o,f,p,M,A,w){C.strokeStyle=C.fillStyle;for(const[L,T]of Object.entries(o)){let E;C.beginPath(),C.lineWidth=w*Number.parseInt(L),E="function"==typeof T?T(.15,.15/A*M):T;for(const P of E.split(" ")){const D=P[0],H=g[D];if(!H){console.error(`Could not find drawing instructions for "${D}"`);continue}const W=P.substring(1).split(",");W[0]&&W[1]&&H(C,a(W,M,A,f,p,!0,w))}C.stroke(),C.closePath()}}(t,s,n,y,x,R,l),!0;const v=i.powerlineDefinitions[e];return!!v&&(function(C,o,f,p,M,A,w,L){var T,E;const P=new Path2D;P.rect(f,p,M,A),C.clip(P),C.beginPath();const D=w/12;C.lineWidth=L*D;for(const H of o.d.split(" ")){const W=H[0],N=g[W];if(!N){console.error(`Could not find drawing instructions for "${W}"`);continue}const I=H.substring(1).split(",");I[0]&&I[1]&&N(C,a(I,M,A,f,p,!1,L,(null!==(T=o.leftPadding)&&void 0!==T?T:0)*(D/2),(null!==(E=o.rightPadding)&&void 0!==E?E:0)*(D/2)))}1===o.type?(C.strokeStyle=C.fillStyle,C.stroke()):C.fill(),C.closePath()}(t,v,n,y,x,R,b,l),!0)};const r=new Map;function _(t,e,n=0){return Math.max(Math.min(t,e),n)}const g={C:(t,e)=>t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]),L:(t,e)=>t.lineTo(e[0],e[1]),M:(t,e)=>t.moveTo(e[0],e[1])};function a(t,e,n,y,x,R,b,l=0,m=0){const c=t.map(s=>parseFloat(s)||parseInt(s));if(c.length<2)throw new Error("Too few arguments for instruction");for(let s=0;s<c.length;s+=2)c[s]*=e-l*b-m*b,R&&0!==c[s]&&(c[s]=_(Math.round(c[s]+.5)-.5,e,0)),c[s]+=y+l*b;for(let s=1;s<c.length;s+=2)c[s]*=n,R&&0!==c[s]&&(c[s]=_(Math.round(c[s]+.5)-.5,n,0)),c[s]+=x;return c}},56:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.observeDevicePixelDimensions=void 0;const u=d(859);i.observeDevicePixelDimensions=function(h,r,_){let g=new r.ResizeObserver(a=>{const t=a.find(y=>y.target===h);if(!t)return;if(!("devicePixelContentBoxSize"in t))return g?.disconnect(),void(g=void 0);const e=t.devicePixelContentBoxSize[0].inlineSize,n=t.devicePixelContentBoxSize[0].blockSize;e>0&&n>0&&_(e,n)});try{g.observe(h,{box:["device-pixel-content-box"]})}catch{g.disconnect(),g=void 0}return(0,u.toDisposable)(()=>g?.disconnect())}},374:(B,i)=>{function d(u){return 57508<=u&&u<=57558}Object.defineProperty(i,"__esModule",{value:!0}),i.createRenderDimensions=i.excludeFromContrastRatioDemands=i.isRestrictedPowerlineGlyph=i.isPowerlineGlyph=i.throwIfFalsy=void 0,i.throwIfFalsy=function(u){if(!u)throw new Error("value must not be falsy");return u},i.isPowerlineGlyph=d,i.isRestrictedPowerlineGlyph=function(u){return 57520<=u&&u<=57527},i.excludeFromContrastRatioDemands=function(u){return d(u)||9472<=(h=u)&&h<=9631;var h},i.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},296:(B,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.createSelectionRenderModel=void 0;class d{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(h,r,_,g=!1){if(this.selectionStart=r,this.selectionEnd=_,!r||!_||r[0]===_[0]&&r[1]===_[1])return void this.clear();const a=r[1]-h.buffer.active.viewportY,t=_[1]-h.buffer.active.viewportY,e=Math.max(a,0),n=Math.min(t,h.rows-1);e>=h.rows||n<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=g,this.viewportStartRow=a,this.viewportEndRow=t,this.viewportCappedStartRow=e,this.viewportCappedEndRow=n,this.startCol=r[0],this.endCol=_[0])}isCellSelected(h,r,_){return!!this.hasSelection&&(_-=h.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?r>=this.startCol&&_>=this.viewportCappedStartRow&&r<this.endCol&&_<=this.viewportCappedEndRow:r<this.startCol&&_>=this.viewportCappedStartRow&&r>=this.endCol&&_<=this.viewportCappedEndRow:_>this.viewportStartRow&&_<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&_===this.viewportStartRow&&r>=this.startCol&&r<this.endCol||this.viewportStartRow<this.viewportEndRow&&_===this.viewportEndRow&&r<this.endCol||this.viewportStartRow<this.viewportEndRow&&_===this.viewportStartRow&&r>=this.startCol)}}i.createSelectionRenderModel=function(){return new d}},509:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TextureAtlas=void 0;const u=d(237),h=d(855),r=d(147),_=d(160),g=d(860),a=d(374),t=d(485),e=d(385),n=d(345),y={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}};let x;class R{constructor(s,v,C){this._document=s,this._config=v,this._unicodeService=C,this._didWarmUp=!1,this._cacheMap=new t.FourKeyMap,this._cacheMapCombined=new t.FourKeyMap,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new r.AttributeData,this._textureSize=512,this._onAddTextureAtlasCanvas=new n.EventEmitter,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new n.EventEmitter,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=m(s,4*this._config.deviceCellWidth+4,this._config.deviceCellHeight+4),this._tmpCtx=(0,a.throwIfFalsy)(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}get pages(){return this._pages}dispose(){for(const s of this.pages)s.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){const s=new e.IdleTaskQueue;for(let v=33;v<126;v++)s.enqueue(()=>{if(!this._cacheMap.get(v,h.DEFAULT_COLOR,h.DEFAULT_COLOR,h.DEFAULT_EXT)){const C=this._drawToCache(v,h.DEFAULT_COLOR,h.DEFAULT_COLOR,h.DEFAULT_EXT);this._cacheMap.set(v,h.DEFAULT_COLOR,h.DEFAULT_COLOR,h.DEFAULT_EXT,C)}})}beginFrame(){return this._requestClearModel}clearTexture(){if(0!==this._pages[0].currentRow.x||0!==this._pages[0].currentRow.y){for(const s of this._pages)s.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){R.maxAtlasPages&&this._pages.length>=Math.max(4,R.maxAtlasPages/2)&&queueMicrotask(()=>{const v=this._pages.filter(w=>2*w.canvas.width<=(R.maxTextureSize||4096)).sort((w,L)=>L.canvas.width!==w.canvas.width?L.canvas.width-w.canvas.width:L.percentageUsed-w.percentageUsed);let C=-1,o=0;for(let w=0;w<v.length;w++)if(v[w].canvas.width!==o)C=w,o=v[w].canvas.width;else if(w-C==3)break;const f=v.slice(C,C+4),p=f.map(w=>w.glyphs[0].texturePage).sort((w,L)=>w>L?1:-1),M=p[0],A=this._mergePages(f,M);A.version++,this._pages[M]=A;for(let w=p.length-1;w>=1;w--)this._deletePage(p[w]);this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(A.canvas)});const s=new b(this._document,this._textureSize);return this._pages.push(s),this._activePages.push(s),this._onAddTextureAtlasCanvas.fire(s.canvas),s}_mergePages(s,v){const C=2*s[0].canvas.width,o=new b(this._document,C,s);for(const[f,p]of s.entries()){const M=f*p.canvas.width%C,A=Math.floor(f/2)*p.canvas.height;o.ctx.drawImage(p.canvas,M,A);for(const L of p.glyphs)L.texturePage=v,L.sizeClipSpace.x=L.size.x/C,L.sizeClipSpace.y=L.size.y/C,L.texturePosition.x+=M,L.texturePosition.y+=A,L.texturePositionClipSpace.x=L.texturePosition.x/C,L.texturePositionClipSpace.y=L.texturePosition.y/C;this._onRemoveTextureAtlasCanvas.fire(p.canvas);const w=this._activePages.indexOf(p);-1!==w&&this._activePages.splice(w,1)}return o}_deletePage(s){this._pages.splice(s,1);for(let v=s;v<this._pages.length;v++){const C=this._pages[v];for(const o of C.glyphs)o.texturePage--;C.version++}}getRasterizedGlyphCombinedChar(s,v,C,o){return this._getFromCacheMap(this._cacheMapCombined,s,v,C,o)}getRasterizedGlyph(s,v,C,o){return this._getFromCacheMap(this._cacheMap,s,v,C,o)}_getFromCacheMap(s,v,C,o,f){return x=s.get(v,C,o,f),x||(x=this._drawToCache(v,C,o,f),s.set(v,C,o,f,x)),x}_getColorFromAnsiIndex(s){if(s>=this._config.colors.ansi.length)throw new Error("No color found for idx "+s);return this._config.colors.ansi[s]}_getBackgroundColor(s,v,C,o){if(this._config.allowTransparency)return _.NULL_COLOR;let f;switch(s){case 16777216:case 33554432:f=this._getColorFromAnsiIndex(v);break;case 50331648:const p=r.AttributeData.toColorRGB(v);f=_.rgba.toColor(p[0],p[1],p[2]);break;default:f=C?this._config.colors.foreground:this._config.colors.background}return f}_getForegroundColor(s,v,C,o,f,p,M,A,w,L){const T=this._getMinimumContrastColor(s,v,C,o,f,p,!1,w,L);if(T)return T;let E;switch(f){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&w&&p<8&&(p+=8),E=this._getColorFromAnsiIndex(p);break;case 50331648:const P=r.AttributeData.toColorRGB(p);E=_.rgba.toColor(P[0],P[1],P[2]);break;default:E=M?this._config.colors.background:this._config.colors.foreground}return this._config.allowTransparency&&(E=_.color.opaque(E)),A&&(E=_.color.multiplyOpacity(E,u.DIM_OPACITY)),E}_resolveBackgroundRgba(s,v,C){switch(s){case 16777216:case 33554432:return this._getColorFromAnsiIndex(v).rgba;case 50331648:return v<<8;default:return C?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(s,v,C,o){switch(s){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&o&&v<8&&(v+=8),this._getColorFromAnsiIndex(v).rgba;case 50331648:return v<<8;default:return C?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(s,v,C,o,f,p,M,A,w){if(1===this._config.minimumContrastRatio||w)return;const L=this._config.colors.contrastCache.getColor(s,o);if(void 0!==L)return L||void 0;const T=this._resolveBackgroundRgba(v,C,M),E=this._resolveForegroundRgba(f,p,M,A),P=_.rgba.ensureContrastRatio(T,E,this._config.minimumContrastRatio);if(!P)return void this._config.colors.contrastCache.setColor(s,o,null);const D=_.rgba.toColor(P>>24&255,P>>16&255,P>>8&255);return this._config.colors.contrastCache.setColor(s,o,D),D}_drawToCache(s,v,C,o){const f="number"==typeof s?String.fromCharCode(s):s,p=Math.min(this._config.deviceCellWidth*Math.max(f.length,2)+4,this._textureSize);this._tmpCanvas.width<p&&(this._tmpCanvas.width=p);const M=Math.min(this._config.deviceCellHeight+8,this._textureSize);if(this._tmpCanvas.height<M&&(this._tmpCanvas.height=M),this._tmpCtx.save(),this._workAttributeData.fg=C,this._workAttributeData.bg=v,this._workAttributeData.extended.ext=o,this._workAttributeData.isInvisible())return y;const A=!!this._workAttributeData.isBold(),w=!!this._workAttributeData.isInverse(),L=!!this._workAttributeData.isDim(),T=!!this._workAttributeData.isItalic(),E=!!this._workAttributeData.isUnderline(),P=!!this._workAttributeData.isStrikethrough(),D=!!this._workAttributeData.isOverline();let H=this._workAttributeData.getFgColor(),W=this._workAttributeData.getFgColorMode(),N=this._workAttributeData.getBgColor(),I=this._workAttributeData.getBgColorMode();if(w){const S=H;H=N,N=S;const k=W;W=I,I=k}const z=this._getBackgroundColor(I,N,w,L);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=z.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over",this._tmpCtx.font=`${T?"italic":""} ${A?this._config.fontWeightBold:this._config.fontWeight} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=u.TEXT_BASELINE;const K=1===f.length&&(0,a.isPowerlineGlyph)(f.charCodeAt(0)),_e=1===f.length&&(0,a.isRestrictedPowerlineGlyph)(f.charCodeAt(0)),re=this._getForegroundColor(v,I,N,C,W,H,w,L,A,(0,a.excludeFromContrastRatioDemands)(f.charCodeAt(0)));this._tmpCtx.fillStyle=re.css;const O=_e?0:4;let oe=!1;!1!==this._config.customGlyphs&&(oe=(0,g.tryDrawCustomChar)(this._tmpCtx,f,O,O,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let Z,ee=!K;if(Z="number"==typeof s?this._unicodeService.wcwidth(s):this._unicodeService.getStringCellWidth(s),E){this._tmpCtx.save();const S=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),k=S%2==1?.5:0;if(this._tmpCtx.lineWidth=S,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())ee=!1,this._tmpCtx.strokeStyle=`rgb(${r.AttributeData.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{ee=!1;let V=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&V<8&&(V+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(V).css}this._tmpCtx.beginPath();const Y=O,X=Math.ceil(O+this._config.deviceCharHeight)-k,te=O+this._config.deviceCharHeight+S-k,ie=Math.ceil(O+this._config.deviceCharHeight+2*S)-k;for(let V=0;V<Z;V++){this._tmpCtx.save();const G=Y+V*this._config.deviceCellWidth,J=Y+(V+1)*this._config.deviceCellWidth,le=G+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(G,X),this._tmpCtx.lineTo(J,X),this._tmpCtx.moveTo(G,ie),this._tmpCtx.lineTo(J,ie);break;case 3:const ae=S<=1?ie:Math.ceil(O+this._config.deviceCharHeight-S/2)-k,he=S<=1?X:Math.ceil(O+this._config.deviceCharHeight+S/2)-k,ge=new Path2D;ge.rect(G,X,this._config.deviceCellWidth,ie-X),this._tmpCtx.clip(ge),this._tmpCtx.moveTo(G-this._config.deviceCellWidth/2,te),this._tmpCtx.bezierCurveTo(G-this._config.deviceCellWidth/2,he,G,he,G,te),this._tmpCtx.bezierCurveTo(G,ae,le,ae,le,te),this._tmpCtx.bezierCurveTo(le,he,J,he,J,te),this._tmpCtx.bezierCurveTo(J,ae,J+this._config.deviceCellWidth/2,ae,J+this._config.deviceCellWidth/2,te);break;case 4:this._tmpCtx.setLineDash([Math.round(S),Math.round(S)]),this._tmpCtx.moveTo(G,X),this._tmpCtx.lineTo(J,X);break;case 5:this._tmpCtx.setLineDash([4*this._config.devicePixelRatio,3*this._config.devicePixelRatio]),this._tmpCtx.moveTo(G,X),this._tmpCtx.lineTo(J,X);break;default:this._tmpCtx.moveTo(G,X),this._tmpCtx.lineTo(J,X)}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!oe&&this._config.fontSize>=12&&!this._config.allowTransparency&&" "!==f){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";const V=this._tmpCtx.measureText(f);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in V&&V.actualBoundingBoxDescent>0){this._tmpCtx.save();const G=new Path2D;G.rect(Y,X-Math.ceil(S/2),this._config.deviceCellWidth*Z,ie-X+Math.ceil(S/2)),this._tmpCtx.clip(G),this._tmpCtx.lineWidth=3*this._config.devicePixelRatio,this._tmpCtx.strokeStyle=z.css,this._tmpCtx.strokeText(f,O,O+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(D){const S=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),k=S%2==1?.5:0;this._tmpCtx.lineWidth=S,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(O,O+k),this._tmpCtx.lineTo(O+this._config.deviceCharWidth*Z,O+k),this._tmpCtx.stroke()}if(oe||this._tmpCtx.fillText(f,O,O+this._config.deviceCharHeight),"_"===f&&!this._config.allowTransparency){let S=l(this._tmpCtx.getImageData(O,O,this._config.deviceCellWidth,this._config.deviceCellHeight),z,re,ee);if(S)for(let k=1;k<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=z.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(f,O,O+this._config.deviceCharHeight-k),S=l(this._tmpCtx.getImageData(O,O,this._config.deviceCellWidth,this._config.deviceCellHeight),z,re,ee),S);k++);}if(P){const S=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),k=this._tmpCtx.lineWidth%2==1?.5:0;this._tmpCtx.lineWidth=S,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(O,O+Math.floor(this._config.deviceCharHeight/2)-k),this._tmpCtx.lineTo(O+this._config.deviceCharWidth*Z,O+Math.floor(this._config.deviceCharHeight/2)-k),this._tmpCtx.stroke()}this._tmpCtx.restore();const ne=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height);let ue;if(ue=this._config.allowTransparency?function(S){for(let k=0;k<S.data.length;k+=4)if(S.data[k+3]>0)return!1;return!0}(ne):l(ne,z,re,ee),ue)return y;const U=this._findGlyphBoundingBox(ne,this._workBoundingBox,p,_e,oe,O);let F,$;for(;;){if(0===this._activePages.length){const S=this._createNewPage();F=S,$=S.currentRow,$.height=U.size.y;break}F=this._activePages[this._activePages.length-1],$=F.currentRow;for(const S of this._activePages)U.size.y<=S.currentRow.height&&(F=S,$=S.currentRow);for(let S=this._activePages.length-1;S>=0;S--)for(const k of this._activePages[S].fixedRows)k.height<=$.height&&U.size.y<=k.height&&(F=this._activePages[S],$=k);if($.y+U.size.y>=F.canvas.height||$.height>U.size.y+2){let S=!1;if(F.currentRow.y+F.currentRow.height+U.size.y>=F.canvas.height){let k;for(const Y of this._activePages)if(Y.currentRow.y+Y.currentRow.height+U.size.y<Y.canvas.height){k=Y;break}if(k)F=k;else{const Y=this._createNewPage();F=Y,$=Y.currentRow,$.height=U.size.y,S=!0}}S||(F.currentRow.height>0&&F.fixedRows.push(F.currentRow),$={x:0,y:F.currentRow.y+F.currentRow.height,height:U.size.y},F.fixedRows.push($),F.currentRow={x:0,y:$.y+$.height,height:0})}if($.x+U.size.x<=F.canvas.width)break;$===F.currentRow?($.x=0,$.y+=$.height,$.height=0):F.fixedRows.splice(F.fixedRows.indexOf($),1)}return U.texturePage=this._pages.indexOf(F),U.texturePosition.x=$.x,U.texturePosition.y=$.y,U.texturePositionClipSpace.x=$.x/F.canvas.width,U.texturePositionClipSpace.y=$.y/F.canvas.height,U.sizeClipSpace.x/=F.canvas.width,U.sizeClipSpace.y/=F.canvas.height,$.height=Math.max($.height,U.size.y),$.x+=U.size.x,F.ctx.putImageData(ne,U.texturePosition.x-this._workBoundingBox.left,U.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,U.size.x,U.size.y),F.addGlyph(U),F.version++,U}_findGlyphBoundingBox(s,v,C,o,f,p){v.top=0;const M=o?this._config.deviceCellHeight:this._tmpCanvas.height,A=o?this._config.deviceCellWidth:C;let w=!1;for(let L=0;L<M;L++){for(let T=0;T<A;T++)if(0!==s.data[L*this._tmpCanvas.width*4+4*T+3]){v.top=L,w=!0;break}if(w)break}v.left=0,w=!1;for(let L=0;L<p+A;L++){for(let T=0;T<M;T++)if(0!==s.data[T*this._tmpCanvas.width*4+4*L+3]){v.left=L,w=!0;break}if(w)break}v.right=A,w=!1;for(let L=p+A-1;L>=p;L--){for(let T=0;T<M;T++)if(0!==s.data[T*this._tmpCanvas.width*4+4*L+3]){v.right=L,w=!0;break}if(w)break}v.bottom=M,w=!1;for(let L=M-1;L>=0;L--){for(let T=0;T<A;T++)if(0!==s.data[L*this._tmpCanvas.width*4+4*T+3]){v.bottom=L,w=!0;break}if(w)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:v.right-v.left+1,y:v.bottom-v.top+1},sizeClipSpace:{x:v.right-v.left+1,y:v.bottom-v.top+1},offset:{x:-v.left+p+(o||f?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-v.top+p+(o||f?1===this._config.lineHeight?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}}i.TextureAtlas=R;class b{constructor(s,v,C){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],C)for(const o of C)this._glyphs.push(...o.glyphs),this._usedPixels+=o._usedPixels;this.canvas=m(s,v,v),this.ctx=(0,a.throwIfFalsy)(this.canvas.getContext("2d",{alpha:!0}))}get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph(s){this._glyphs.push(s),this._usedPixels+=s.size.x*s.size.y}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}}function l(c,s,v,C){const o=s.rgba>>>24,f=s.rgba>>>16&255,p=s.rgba>>>8&255,A=v.rgba>>>16&255,w=v.rgba>>>8&255,L=Math.floor((Math.abs(o-(v.rgba>>>24))+Math.abs(f-A)+Math.abs(p-w))/12);let T=!0;for(let E=0;E<c.data.length;E+=4)c.data[E]===o&&c.data[E+1]===f&&c.data[E+2]===p||C&&Math.abs(c.data[E]-o)+Math.abs(c.data[E+1]-f)+Math.abs(c.data[E+2]-p)<L?c.data[E+3]=0:T=!1;return T}function m(c,s,v){const C=c.createElement("canvas");return C.width=s,C.height=v,C}},160:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.contrastRatio=i.toPaddedHex=i.rgba=i.rgb=i.css=i.color=i.channels=i.NULL_COLOR=void 0;const u=d(399);let h=0,r=0,_=0,g=0;var a,t,e,x;function n(x){const R=x.toString(16);return R.length<2?"0"+R:R}function y(x,R){return x<R?(R+.05)/(x+.05):(x+.05)/(R+.05)}i.NULL_COLOR={css:"#00000000",rgba:0},(x=a=i.channels||(i.channels={})).toCss=function(R,b,l,m){return void 0!==m?`#${n(R)}${n(b)}${n(l)}${n(m)}`:`#${n(R)}${n(b)}${n(l)}`},x.toRgba=function(R,b,l,m=255){return(R<<24|b<<16|l<<8|m)>>>0},function(x){function R(b,l){return g=Math.round(255*l),[h,r,_]=e.toChannels(b.rgba),{css:a.toCss(h,r,_,g),rgba:a.toRgba(h,r,_,g)}}x.blend=function(b,l){if(g=(255&l.rgba)/255,1===g)return{css:l.css,rgba:l.rgba};const c=l.rgba>>16&255,s=l.rgba>>8&255,v=b.rgba>>24&255,C=b.rgba>>16&255,o=b.rgba>>8&255;return h=v+Math.round(((l.rgba>>24&255)-v)*g),r=C+Math.round((c-C)*g),_=o+Math.round((s-o)*g),{css:a.toCss(h,r,_),rgba:a.toRgba(h,r,_)}},x.isOpaque=function(b){return 255==(255&b.rgba)},x.ensureContrastRatio=function(b,l,m){const c=e.ensureContrastRatio(b.rgba,l.rgba,m);if(c)return e.toColor(c>>24&255,c>>16&255,c>>8&255)},x.opaque=function(b){const l=(255|b.rgba)>>>0;return[h,r,_]=e.toChannels(l),{css:a.toCss(h,r,_),rgba:l}},x.opacity=R,x.multiplyOpacity=function(b,l){return g=255&b.rgba,R(b,g*l/255)},x.toColorRGB=function(b){return[b.rgba>>24&255,b.rgba>>16&255,b.rgba>>8&255]}}(i.color||(i.color={})),function(x){let R,b;if(!u.isNode){const l=document.createElement("canvas");l.width=1,l.height=1;const m=l.getContext("2d",{willReadFrequently:!0});m&&(R=m,R.globalCompositeOperation="copy",b=R.createLinearGradient(0,0,1,1))}x.toColor=function(l){if(l.match(/#[\da-f]{3,8}/i))switch(l.length){case 4:return h=parseInt(l.slice(1,2).repeat(2),16),r=parseInt(l.slice(2,3).repeat(2),16),_=parseInt(l.slice(3,4).repeat(2),16),e.toColor(h,r,_);case 5:return h=parseInt(l.slice(1,2).repeat(2),16),r=parseInt(l.slice(2,3).repeat(2),16),_=parseInt(l.slice(3,4).repeat(2),16),g=parseInt(l.slice(4,5).repeat(2),16),e.toColor(h,r,_,g);case 7:return{css:l,rgba:(parseInt(l.slice(1),16)<<8|255)>>>0};case 9:return{css:l,rgba:parseInt(l.slice(1),16)>>>0}}const m=l.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(m)return h=parseInt(m[1]),r=parseInt(m[2]),_=parseInt(m[3]),g=Math.round(255*(void 0===m[5]?1:parseFloat(m[5]))),e.toColor(h,r,_,g);if(!R||!b)throw new Error("css.toColor: Unsupported css format");if(R.fillStyle=b,R.fillStyle=l,"string"!=typeof R.fillStyle)throw new Error("css.toColor: Unsupported css format");if(R.fillRect(0,0,1,1),[h,r,_,g]=R.getImageData(0,0,1,1).data,255!==g)throw new Error("css.toColor: Unsupported css format");return{rgba:a.toRgba(h,r,_,g),css:l}}}(i.css||(i.css={})),function(x){function R(b,l,m){const c=b/255,s=l/255,v=m/255;return.2126*(c<=.03928?c/12.92:Math.pow((c+.055)/1.055,2.4))+.7152*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))+.0722*(v<=.03928?v/12.92:Math.pow((v+.055)/1.055,2.4))}x.relativeLuminance=function(b){return R(b>>16&255,b>>8&255,255&b)},x.relativeLuminance2=R}(t=i.rgb||(i.rgb={})),function(x){function R(l,m,c){const s=l>>24&255,v=l>>16&255,C=l>>8&255;let o=m>>24&255,f=m>>16&255,p=m>>8&255,M=y(t.relativeLuminance2(o,f,p),t.relativeLuminance2(s,v,C));for(;M<c&&(o>0||f>0||p>0);)o-=Math.max(0,Math.ceil(.1*o)),f-=Math.max(0,Math.ceil(.1*f)),p-=Math.max(0,Math.ceil(.1*p)),M=y(t.relativeLuminance2(o,f,p),t.relativeLuminance2(s,v,C));return(o<<24|f<<16|p<<8|255)>>>0}function b(l,m,c){const s=l>>24&255,v=l>>16&255,C=l>>8&255;let o=m>>24&255,f=m>>16&255,p=m>>8&255,M=y(t.relativeLuminance2(o,f,p),t.relativeLuminance2(s,v,C));for(;M<c&&(o<255||f<255||p<255);)o=Math.min(255,o+Math.ceil(.1*(255-o))),f=Math.min(255,f+Math.ceil(.1*(255-f))),p=Math.min(255,p+Math.ceil(.1*(255-p))),M=y(t.relativeLuminance2(o,f,p),t.relativeLuminance2(s,v,C));return(o<<24|f<<16|p<<8|255)>>>0}x.ensureContrastRatio=function(l,m,c){const s=t.relativeLuminance(l>>8),v=t.relativeLuminance(m>>8);if(y(s,v)<c){if(v<s){const f=R(l,m,c),p=y(s,t.relativeLuminance(f>>8));if(p<c){const M=b(l,m,c);return p>y(s,t.relativeLuminance(M>>8))?f:M}return f}const C=b(l,m,c),o=y(s,t.relativeLuminance(C>>8));if(o<c){const f=R(l,m,c);return o>y(s,t.relativeLuminance(f>>8))?C:f}return C}},x.reduceLuminance=R,x.increaseLuminance=b,x.toChannels=function(l){return[l>>24&255,l>>16&255,l>>8&255,255&l]},x.toColor=function(l,m,c,s){return{css:a.toCss(l,m,c,s),rgba:a.toRgba(l,m,c,s)}}}(e=i.rgba||(i.rgba={})),i.toPaddedHex=n,i.contrastRatio=y},345:(B,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.forwardEvent=i.EventEmitter=void 0,i.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=d=>(this._listeners.push(d),{dispose:()=>{if(!this._disposed)for(let u=0;u<this._listeners.length;u++)if(this._listeners[u]===d)return void this._listeners.splice(u,1)}})),this._event}fire(d,u){const h=[];for(let r=0;r<this._listeners.length;r++)h.push(this._listeners[r]);for(let r=0;r<h.length;r++)h[r].call(void 0,d,u)}dispose(){this._listeners&&(this._listeners.length=0),this._disposed=!0}},i.forwardEvent=function(d,u){return d(h=>u.fire(h))}},859:(B,i)=>{function d(u){for(const h of u)h.dispose();u.length=0}Object.defineProperty(i,"__esModule",{value:!0}),i.getDisposeArrayDisposable=i.disposeArray=i.toDisposable=i.Disposable=void 0,i.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const u of this._disposables)u.dispose();this._disposables.length=0}register(u){return this._disposables.push(u),u}unregister(u){const h=this._disposables.indexOf(u);-1!==h&&this._disposables.splice(h,1)}},i.toDisposable=function(u){return{dispose:u}},i.disposeArray=d,i.getDisposeArrayDisposable=function(u){return{dispose:()=>d(u)}}},485:(B,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.FourKeyMap=i.TwoKeyMap=void 0;class d{constructor(){this._data={}}set(h,r,_){this._data[h]||(this._data[h]={}),this._data[h][r]=_}get(h,r){return this._data[h]?this._data[h][r]:void 0}clear(){this._data={}}}i.TwoKeyMap=d,i.FourKeyMap=class{constructor(){this._data=new d}set(u,h,r,_,g){this._data.get(u,h)||this._data.set(u,h,new d),this._data.get(u,h).set(r,_,g)}get(u,h,r,_){var g;return null===(g=this._data.get(u,h))||void 0===g?void 0:g.get(r,_)}clear(){this._data.clear()}}},399:(B,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.isChromeOS=i.isLinux=i.isWindows=i.isIphone=i.isIpad=i.isMac=i.getSafariVersion=i.isSafari=i.isLegacyEdge=i.isFirefox=i.isNode=void 0,i.isNode=typeof navigator>"u";const d=i.isNode?"node":navigator.userAgent,u=i.isNode?"node":navigator.platform;i.isFirefox=d.includes("Firefox"),i.isLegacyEdge=d.includes("Edge"),i.isSafari=/^((?!chrome|android).)*safari/i.test(d),i.getSafariVersion=function(){if(!i.isSafari)return 0;const h=d.match(/Version\/(\d+)/);return null===h||h.length<2?0:parseInt(h[1])},i.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(u),i.isIpad="iPad"===u,i.isIphone="iPhone"===u,i.isWindows=["Windows","Win16","Win32","WinCE"].includes(u),i.isLinux=u.indexOf("Linux")>=0,i.isChromeOS=/\bCrOS\b/.test(d)},385:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DebouncedIdleTask=i.IdleTaskQueue=i.PriorityTaskQueue=void 0;const u=d(399);class h{constructor(){this._tasks=[],this._i=0}enqueue(g){this._tasks.push(g),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(g){this._idleCallback=void 0;let a=0,t=0,e=g.timeRemaining(),n=0;for(;this._i<this._tasks.length;){if(a=Date.now(),this._tasks[this._i]()||this._i++,a=Math.max(1,Date.now()-a),t=Math.max(a,t),n=g.timeRemaining(),1.5*t>n)return e-a<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(e-a))}ms`),void this._start();e=n}this.clear()}}class r extends h{_requestCallback(g){return setTimeout(()=>g(this._createDeadline(16)))}_cancelCallback(g){clearTimeout(g)}_createDeadline(g){const a=Date.now()+g;return{timeRemaining:()=>Math.max(0,a-Date.now())}}}i.PriorityTaskQueue=r,i.IdleTaskQueue=!u.isNode&&"requestIdleCallback"in window?class extends h{_requestCallback(_){return requestIdleCallback(_)}_cancelCallback(_){cancelIdleCallback(_)}}:r,i.DebouncedIdleTask=class{constructor(){this._queue=new i.IdleTaskQueue}set(_){this._queue.clear(),this._queue.enqueue(_)}flush(){this._queue.flush()}}},147:(B,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ExtendedAttrs=i.AttributeData=void 0;class d{constructor(){this.fg=0,this.bg=0,this.extended=new u}static toColorRGB(r){return[r>>>16&255,r>>>8&255,255&r]}static fromColorRGB(r){return(255&r[0])<<16|(255&r[1])<<8|255&r[2]}clone(){const r=new d;return r.fg=this.fg,r.bg=this.bg,r.extended=this.extended.clone(),r}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&0!==this.extended.underlineStyle?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return 50331648==(50331648&this.fg)}isBgRGB(){return 50331648==(50331648&this.bg)}isFgPalette(){return 16777216==(50331648&this.fg)||33554432==(50331648&this.fg)}isBgPalette(){return 16777216==(50331648&this.bg)||33554432==(50331648&this.bg)}isFgDefault(){return 0==(50331648&this.fg)}isBgDefault(){return 0==(50331648&this.bg)}isAttributeDefault(){return 0===this.fg&&0===this.bg}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?50331648==(50331648&this.extended.underlineColor):this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?16777216==(50331648&this.extended.underlineColor)||33554432==(50331648&this.extended.underlineColor):this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?0==(50331648&this.extended.underlineColor):this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}i.AttributeData=d;class u{constructor(r=0,_=0){this._ext=0,this._urlId=0,this._ext=r,this._urlId=_}get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(r){this._ext=r}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(r){this._ext&=-469762049,this._ext|=r<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(r){this._ext&=-67108864,this._ext|=67108863&r}get urlId(){return this._urlId}set urlId(r){this._urlId=r}clone(){return new u(this._ext,this._urlId)}isEmpty(){return 0===this.underlineStyle&&0===this._urlId}}i.ExtendedAttrs=u},782:(B,i,d)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CellData=void 0;const u=d(133),h=d(855),r=d(147);class _ extends r.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new r.ExtendedAttrs,this.combinedData=""}static fromCharData(a){const t=new _;return t.setFromCharData(a),t}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,u.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(a){this.fg=a[h.CHAR_DATA_ATTR_INDEX],this.bg=0;let t=!1;if(a[h.CHAR_DATA_CHAR_INDEX].length>2)t=!0;else if(2===a[h.CHAR_DATA_CHAR_INDEX].length){const e=a[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=e&&e<=56319){const n=a[h.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=n&&n<=57343?this.content=1024*(e-55296)+n-56320+65536|a[h.CHAR_DATA_WIDTH_INDEX]<<22:t=!0}else t=!0}else this.content=a[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|a[h.CHAR_DATA_WIDTH_INDEX]<<22;t&&(this.combinedData=a[h.CHAR_DATA_CHAR_INDEX],this.content=2097152|a[h.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}i.CellData=_},855:(B,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WHITESPACE_CELL_CODE=i.WHITESPACE_CELL_WIDTH=i.WHITESPACE_CELL_CHAR=i.NULL_CELL_CODE=i.NULL_CELL_WIDTH=i.NULL_CELL_CHAR=i.CHAR_DATA_CODE_INDEX=i.CHAR_DATA_WIDTH_INDEX=i.CHAR_DATA_CHAR_INDEX=i.CHAR_DATA_ATTR_INDEX=i.DEFAULT_EXT=i.DEFAULT_ATTR=i.DEFAULT_COLOR=void 0,i.DEFAULT_COLOR=0,i.DEFAULT_ATTR=256|i.DEFAULT_COLOR<<9,i.DEFAULT_EXT=0,i.CHAR_DATA_ATTR_INDEX=0,i.CHAR_DATA_CHAR_INDEX=1,i.CHAR_DATA_WIDTH_INDEX=2,i.CHAR_DATA_CODE_INDEX=3,i.NULL_CELL_CHAR="",i.NULL_CELL_WIDTH=1,i.NULL_CELL_CODE=0,i.WHITESPACE_CELL_CHAR=" ",i.WHITESPACE_CELL_WIDTH=1,i.WHITESPACE_CELL_CODE=32},133:(B,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Utf8ToUtf32=i.StringToUtf32=i.utf32ToString=i.stringFromCodePoint=void 0,i.stringFromCodePoint=function(d){return d>65535?(d-=65536,String.fromCharCode(55296+(d>>10))+String.fromCharCode(d%1024+56320)):String.fromCharCode(d)},i.utf32ToString=function(d,u=0,h=d.length){let r="";for(let _=u;_<h;++_){let g=d[_];g>65535?(g-=65536,r+=String.fromCharCode(55296+(g>>10))+String.fromCharCode(g%1024+56320)):r+=String.fromCharCode(g)}return r},i.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(d,u){const h=d.length;if(!h)return 0;let r=0,_=0;if(this._interim){const g=d.charCodeAt(_++);56320<=g&&g<=57343?u[r++]=1024*(this._interim-55296)+g-56320+65536:(u[r++]=this._interim,u[r++]=g),this._interim=0}for(let g=_;g<h;++g){const a=d.charCodeAt(g);if(55296<=a&&a<=56319){if(++g>=h)return this._interim=a,r;const t=d.charCodeAt(g);56320<=t&&t<=57343?u[r++]=1024*(a-55296)+t-56320+65536:(u[r++]=a,u[r++]=t)}else 65279!==a&&(u[r++]=a)}return r}},i.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(d,u){const h=d.length;if(!h)return 0;let r,_,g,a,t=0,e=0,n=0;if(this.interim[0]){let R=!1,b=this.interim[0];b&=192==(224&b)?31:224==(240&b)?15:7;let l,m=0;for(;(l=63&this.interim[++m])&&m<4;)b<<=6,b|=l;const c=192==(224&this.interim[0])?2:224==(240&this.interim[0])?3:4,s=c-m;for(;n<s;){if(n>=h)return 0;if(l=d[n++],128!=(192&l)){n--,R=!0;break}this.interim[m++]=l,b<<=6,b|=63&l}R||(2===c?b<128?n--:u[t++]=b:3===c?b<2048||b>=55296&&b<=57343||65279===b||(u[t++]=b):b<65536||b>1114111||(u[t++]=b)),this.interim.fill(0)}const y=h-4;let x=n;for(;x<h;){for(;!(!(x<y)||128&(r=d[x])||128&(_=d[x+1])||128&(g=d[x+2])||128&(a=d[x+3]));)u[t++]=r,u[t++]=_,u[t++]=g,u[t++]=a,x+=4;if(r=d[x++],r<128)u[t++]=r;else if(192==(224&r)){if(x>=h)return this.interim[0]=r,t;if(_=d[x++],128!=(192&_)){x--;continue}if(e=(31&r)<<6|63&_,e<128){x--;continue}u[t++]=e}else if(224==(240&r)){if(x>=h)return this.interim[0]=r,t;if(_=d[x++],128!=(192&_)){x--;continue}if(x>=h)return this.interim[0]=r,this.interim[1]=_,t;if(g=d[x++],128!=(192&g)){x--;continue}if(e=(15&r)<<12|(63&_)<<6|63&g,e<2048||e>=55296&&e<=57343||65279===e)continue;u[t++]=e}else if(240==(248&r)){if(x>=h)return this.interim[0]=r,t;if(_=d[x++],128!=(192&_)){x--;continue}if(x>=h)return this.interim[0]=r,this.interim[1]=_,t;if(g=d[x++],128!=(192&g)){x--;continue}if(x>=h)return this.interim[0]=r,this.interim[1]=_,this.interim[2]=g,t;if(a=d[x++],128!=(192&a)){x--;continue}if(e=(7&r)<<18|(63&_)<<12|(63&g)<<6|63&a,e<65536||e>1114111)continue;u[t++]=e}}return t}}}},se={};function Q(B){var i=se[B];if(void 0!==i)return i.exports;var d=se[B]={exports:{}};return ce[B](d,d.exports,Q),d.exports}var de={};return(()=>{var B=de;Object.defineProperty(B,"__esModule",{value:!0}),B.WebglAddon=void 0;const i=Q(345),d=Q(859),u=Q(399),h=Q(666);B.WebglAddon=class r extends d.Disposable{constructor(g){if(u.isSafari&&(0,u.getSafariVersion)()<16)throw new Error("Webgl2 is only supported on Safari 16 and above");super(),this._preserveDrawingBuffer=g,this._onChangeTextureAtlas=this.register(new i.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new i.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this.register(new i.EventEmitter),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onContextLoss=this.register(new i.EventEmitter),this.onContextLoss=this._onContextLoss.event}activate(g){const a=g._core;if(!g.element)return void this.register(a.onWillOpen(()=>this.activate(g)));this._terminal=g;const y=a._renderService;this._renderer=this.register(new h.WebglRenderer(g,a._characterJoinerService,a._charSizeService,a._coreBrowserService,a.coreService,a._decorationService,a.optionsService,a._themeService,this._preserveDrawingBuffer)),this.register((0,i.forwardEvent)(this._renderer.onContextLoss,this._onContextLoss)),this.register((0,i.forwardEvent)(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this.register((0,i.forwardEvent)(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),this.register((0,i.forwardEvent)(this._renderer.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)),y.setRenderer(this._renderer),this.register((0,d.toDisposable)(()=>{const c=this._terminal._core._renderService;c.setRenderer(this._terminal._core._createRenderer()),c.handleResize(g.cols,g.rows)}))}get textureAtlas(){var g;return null===(g=this._renderer)||void 0===g?void 0:g.textureAtlas}clearTextureAtlas(){var g;null===(g=this._renderer)||void 0===g||g.clearTextureAtlas()}}})(),de})()}}]);