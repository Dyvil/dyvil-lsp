(self.webpackChunkweb=self.webpackChunkweb||[]).push([[385],{39385:(G,y,N)=>{var J=N(46932).default;self,G.exports=(()=>{"use strict";var M={615:(w,h)=>{function B(c){if(typeof Buffer<"u")return Buffer.from(c,"base64");const l=atob(c),Q=new Uint8Array(l.length);for(let t=0;t<Q.length;++t)Q[t]=l.charCodeAt(t);return Q}Object.defineProperty(h,"__esModule",{value:!0}),h.InWasm=void 0,h.InWasm=function(c){if(c.d){const{t:l,s:Q,d:t}=c;let A,e;const i=WebAssembly;return 2===l?Q?()=>A||(A=B(t)):()=>Promise.resolve(A||(A=B(t))):1===l?Q?()=>e||(e=new i.Module(A||(A=B(t)))):()=>e?Promise.resolve(e):i.compile(A||(A=B(t))).then(s=>e=s):Q?s=>new i.Instance(e||(e=new i.Module(A||(A=B(t)))),s):s=>e?i.instantiate(e,s):i.instantiate(A||(A=B(t)),s).then(r=>(e=r.module)&&r.instance)}if(typeof _wasmCtx>"u")throw new Error('must run "inwasm"');_wasmCtx.add(c)}},477:(w,h)=>{function B(i){return 255&i}function c(i){return i>>>8&255}function l(i){return i>>>16&255}function Q(i,s,r,a=255){return((255&a)<<24|(255&r)<<16|(255&s)<<8|255&i)>>>0}function t(i,s,r){return Math.max(i,Math.min(r,s))}function A(i,s,r){return r<0&&(r+=1),r>1&&(r-=1),6*r<1?s+6*(i-s)*r:2*r<1?i:3*r<2?s+(i-s)*(4-6*r):s}function e(i,s,r){return(4278190080|Math.round(r/100*255)<<16|Math.round(s/100*255)<<8|Math.round(i/100*255))>>>0}Object.defineProperty(h,"__esModule",{value:!0}),h.DEFAULT_FOREGROUND=h.DEFAULT_BACKGROUND=h.PALETTE_ANSI_256=h.PALETTE_VT340_GREY=h.PALETTE_VT340_COLOR=h.normalizeHLS=h.normalizeRGB=h.nearestColorIndex=h.fromRGBA8888=h.toRGBA8888=h.alpha=h.blue=h.green=h.red=h.BIG_ENDIAN=void 0,h.BIG_ENDIAN=255===new Uint8Array(new Uint32Array([4278190080]).buffer)[0],h.BIG_ENDIAN&&console.warn("BE platform detected. This version of node-sixel works only on LE properly."),h.red=B,h.green=c,h.blue=l,h.alpha=function(i){return i>>>24&255},h.toRGBA8888=Q,h.fromRGBA8888=function(i){return[255&i,i>>8&255,i>>16&255,i>>>24]},h.nearestColorIndex=function(i,s){const r=B(i),a=c(i),g=l(i);let o=Number.MAX_SAFE_INTEGER,n=-1;for(let I=0;I<s.length;++I){const C=r-s[I][0],E=a-s[I][1],d=g-s[I][2],_=C*C+E*E+d*d;if(!_)return I;_<o&&(o=_,n=I)}return n},h.normalizeRGB=e,h.normalizeHLS=function(i,s,r){return function(a,g,o){if(!o){const C=Math.round(255*g);return Q(C,C,C)}const n=g<.5?g*(1+o):g+o-g*o,I=2*g-n;return Q(t(0,255,Math.round(255*A(n,I,a+.3333333333333333))),t(0,255,Math.round(255*A(n,I,a))),t(0,255,Math.round(255*A(n,I,a-.3333333333333333))))}((i+240)/360,s/100,r/100)},h.PALETTE_VT340_COLOR=new Uint32Array([e(0,0,0),e(20,20,80),e(80,13,13),e(20,80,20),e(80,20,80),e(20,80,80),e(80,80,20),e(53,53,53),e(26,26,26),e(33,33,60),e(60,26,26),e(33,60,33),e(60,33,60),e(33,60,60),e(60,60,33),e(80,80,80)]),h.PALETTE_VT340_GREY=new Uint32Array([e(0,0,0),e(13,13,13),e(26,26,26),e(40,40,40),e(6,6,6),e(20,20,20),e(33,33,33),e(46,46,46),e(0,0,0),e(13,13,13),e(26,26,26),e(40,40,40),e(6,6,6),e(20,20,20),e(33,33,33),e(46,46,46)]),h.PALETTE_ANSI_256=(()=>{const i=[Q(0,0,0),Q(205,0,0),Q(0,205,0),Q(205,205,0),Q(0,0,238),Q(205,0,205),Q(0,250,205),Q(229,229,229),Q(127,127,127),Q(255,0,0),Q(0,255,0),Q(255,255,0),Q(92,92,255),Q(255,0,255),Q(0,255,255),Q(255,255,255)],s=[0,95,135,175,215,255];for(let r=0;r<6;++r)for(let a=0;a<6;++a)for(let g=0;g<6;++g)i.push(Q(s[r],s[a],s[g]));for(let r=8;r<=238;r+=10)i.push(Q(r,r,r));return new Uint32Array(i)})(),h.DEFAULT_BACKGROUND=Q(0,0,0,255),h.DEFAULT_FOREGROUND=Q(255,255,255,255)},710:(w,h,B)=>{Object.defineProperty(h,"__esModule",{value:!0}),h.decodeAsync=h.decode=h.Decoder=h.DecoderAsync=void 0;const c=B(477),l=B(343),Q=function(a){if(typeof Buffer<"u")return Buffer.from(a,"base64");const g=atob(a),o=new Uint8Array(g.length);for(let n=0;n<o.length;++n)o[n]=g.charCodeAt(n);return o}(l.LIMITS.BYTES);let t;const A=new Uint32Array;class e{constructor(){this.bandHandler=g=>1,this.modeHandler=g=>1}handle_band(g){return this.bandHandler(g)}mode_parsed(g){return this.modeHandler(g)}}const i={memoryLimit:134217728,sixelColor:c.DEFAULT_FOREGROUND,fillColor:c.DEFAULT_BACKGROUND,palette:c.PALETTE_VT340_COLOR,paletteLimit:l.LIMITS.PALETTE_SIZE,truncate:!0};function s(a){const g=new e,o={env:{handle_band:g.handle_band.bind(g),mode_parsed:g.mode_parsed.bind(g)}};return WebAssembly.instantiate(t||Q,o).then(n=>(t=t||n.module,new r(a,n.instance||n,g)))}h.DecoderAsync=s;class r{constructor(g,o,n){if(this._PIXEL_OFFSET=l.LIMITS.MAX_WIDTH+4,this._canvas=A,this._bandWidths=[],this._maxWidth=0,this._minWidth=l.LIMITS.MAX_WIDTH,this._lastOffset=0,this._currentHeight=0,this._opts=Object.assign({},i,g),this._opts.paletteLimit>l.LIMITS.PALETTE_SIZE)throw new Error(`DecoderOptions.paletteLimit must not exceed ${l.LIMITS.PALETTE_SIZE}`);if(o)n.bandHandler=this._handle_band.bind(this),n.modeHandler=this._initCanvas.bind(this);else{const I=t||(t=new WebAssembly.Module(Q));o=new WebAssembly.Instance(I,{env:{handle_band:this._handle_band.bind(this),mode_parsed:this._initCanvas.bind(this)}})}this._instance=o,this._wasm=this._instance.exports,this._chunk=new Uint8Array(this._wasm.memory.buffer,this._wasm.get_chunk_address(),l.LIMITS.CHUNK_SIZE),this._states=new Uint32Array(this._wasm.memory.buffer,this._wasm.get_state_address(),12),this._palette=new Uint32Array(this._wasm.memory.buffer,this._wasm.get_palette_address(),l.LIMITS.PALETTE_SIZE),this._palette.set(this._opts.palette),this._pSrc=new Uint32Array(this._wasm.memory.buffer,this._wasm.get_p0_address()),this._wasm.init(c.DEFAULT_FOREGROUND,0,this._opts.paletteLimit,0)}get _fillColor(){return this._states[0]}get _truncate(){return this._states[8]}get _rasterWidth(){return this._states[6]}get _rasterHeight(){return this._states[7]}get _width(){return this._states[2]?this._states[2]-4:0}get _height(){return this._states[3]}get _level(){return this._states[9]}get _mode(){return this._states[10]}get _paletteLimit(){return this._states[11]}_initCanvas(g){if(2===g){const o=this.width*this.height;if(o>this._canvas.length){if(this._opts.memoryLimit&&4*o>this._opts.memoryLimit)throw this.release(),new Error("image exceeds memory limit");this._canvas=new Uint32Array(o)}this._maxWidth=this._width}else if(1===g)if(2===this._level){const o=Math.min(this._rasterWidth,l.LIMITS.MAX_WIDTH)*this._rasterHeight;if(o>this._canvas.length){if(this._opts.memoryLimit&&4*o>this._opts.memoryLimit)throw this.release(),new Error("image exceeds memory limit");this._canvas=new Uint32Array(o)}}else this._canvas.length<65536&&(this._canvas=new Uint32Array(65536));return 0}_realloc(g,o){const n=g+o;if(n>this._canvas.length){if(this._opts.memoryLimit&&4*n>this._opts.memoryLimit)throw this.release(),new Error("image exceeds memory limit");const I=new Uint32Array(65536*Math.ceil(n/65536));I.set(this._canvas),this._canvas=I}}_handle_band(g){const o=this._PIXEL_OFFSET;let n=this._lastOffset;if(2===this._mode){let I=this.height-this._currentHeight,C=0;for(;C<6&&I>0;)this._canvas.set(this._pSrc.subarray(o*C,o*C+g),n+g*C),C++,I--;this._lastOffset+=g*C,this._currentHeight+=C}else if(1===this._mode){this._realloc(n,6*g),this._maxWidth=Math.max(this._maxWidth,g),this._minWidth=Math.min(this._minWidth,g);for(let I=0;I<6;++I)this._canvas.set(this._pSrc.subarray(o*I,o*I+g),n+g*I);this._bandWidths.push(g),this._lastOffset+=6*g,this._currentHeight+=6}return 0}get width(){return 1!==this._mode?this._width:Math.max(this._maxWidth,this._wasm.current_width())}get height(){return 1!==this._mode?this._height:this._wasm.current_width()?6*this._bandWidths.length+this._wasm.current_height():6*this._bandWidths.length}get palette(){return this._palette.subarray(0,this._paletteLimit)}get memoryUsage(){return this._canvas.byteLength+this._wasm.memory.buffer.byteLength+8*this._bandWidths.length}get properties(){return{width:this.width,height:this.height,mode:this._mode,level:this._level,truncate:!!this._truncate,paletteLimit:this._paletteLimit,fillColor:this._fillColor,memUsage:this.memoryUsage,rasterAttributes:{numerator:this._states[4],denominator:this._states[5],width:this._rasterWidth,height:this._rasterHeight}}}init(g=this._opts.fillColor,o=this._opts.palette,n=this._opts.paletteLimit,I=this._opts.truncate){this._wasm.init(this._opts.sixelColor,g,n,I?1:0),o&&this._palette.set(o.subarray(0,l.LIMITS.PALETTE_SIZE)),this._bandWidths.length=0,this._maxWidth=0,this._minWidth=l.LIMITS.MAX_WIDTH,this._lastOffset=0,this._currentHeight=0}decode(g,o=0,n=g.length){let I=o;for(;I<n;){const C=Math.min(n-I,l.LIMITS.CHUNK_SIZE);this._chunk.set(g.subarray(I,I+=C)),this._wasm.decode(0,C)}}decodeString(g,o=0,n=g.length){let I=o;for(;I<n;){const C=Math.min(n-I,l.LIMITS.CHUNK_SIZE);for(let E=0,d=I;E<C;++E,++d)this._chunk[E]=g.charCodeAt(d);I+=C,this._wasm.decode(0,C)}}get data32(){if(0===this._mode||!this.width||!this.height)return A;const g=this._wasm.current_width();if(2===this._mode){let o=this.height-this._currentHeight;if(o>0){const n=this._PIXEL_OFFSET;let I=this._lastOffset,C=0;for(;C<6&&o>0;)this._canvas.set(this._pSrc.subarray(n*C,n*C+g),I+g*C),C++,o--;o&&this._canvas.fill(this._fillColor,I+g*C)}return this._canvas.subarray(0,this.width*this.height)}if(1===this._mode){if(this._minWidth===this._maxWidth){let C=!1;if(g)if(g!==this._minWidth)C=!0;else{const E=this._PIXEL_OFFSET;let d=this._lastOffset;this._realloc(d,6*g);for(let _=0;_<6;++_)this._canvas.set(this._pSrc.subarray(E*_,E*_+g),d+g*_)}if(!C)return this._canvas.subarray(0,this.width*this.height)}const o=new Uint32Array(this.width*this.height);o.fill(this._fillColor);let n=0,I=0;for(let C=0;C<this._bandWidths.length;++C){const E=this._bandWidths[C];for(let d=0;d<6;++d)o.set(this._canvas.subarray(I,I+=E),n),n+=this.width}if(g){const C=this._PIXEL_OFFSET,E=this._wasm.current_height();for(let d=0;d<E;++d)o.set(this._pSrc.subarray(C*d,C*d+g),n+this.width*d)}return o}return A}get data8(){return new Uint8ClampedArray(this.data32.buffer,0,this.width*this.height*4)}release(){this._canvas=A,this._bandWidths.length=0,this._maxWidth=0,this._minWidth=l.LIMITS.MAX_WIDTH,this._wasm.init(c.DEFAULT_FOREGROUND,0,this._opts.paletteLimit,0)}}h.Decoder=r,h.decode=function(a,g){const o=new r(g);return o.init(),"string"==typeof a?o.decodeString(a):o.decode(a),{width:o.width,height:o.height,data32:o.data32,data8:o.data8}},h.decodeAsync=function(){var a=J(function*(g,o){const n=yield s(o);return n.init(),"string"==typeof g?n.decodeString(g):n.decode(g),{width:n.width,height:n.height,data32:n.data32,data8:n.data8}});return function(g,o){return a.apply(this,arguments)}}()},343:(w,h)=>{Object.defineProperty(h,"__esModule",{value:!0}),h.LIMITS=void 0,h.LIMITS={CHUNK_SIZE:16384,PALETTE_SIZE:4096,MAX_WIDTH:16384,BYTES:"AGFzbQEAAAABJAdgAAF/YAJ/fwBgA39/fwF/YAF/AX9gAABgBH9/f38AYAF/AAIlAgNlbnYLaGFuZGxlX2JhbmQAAwNlbnYLbW9kZV9wYXJzZWQAAwMTEgQAAAAAAQQBAQUBAAACAgAGAwQFAXABBwcFBAEBBwcGCAF/AUGAihoLB9wBDgZtZW1vcnkCABFnZXRfc3RhdGVfYWRkcmVzcwADEWdldF9jaHVua19hZGRyZXNzAAQOZ2V0X3AwX2FkZHJlc3MABRNnZXRfcGFsZXR0ZV9hZGRyZXNzAAYEaW5pdAALBmRlY29kZQAMDWN1cnJlbnRfd2lkdGgADQ5jdXJyZW50X2hlaWdodAAOGV9faW5kaXJlY3RfZnVuY3Rpb25fdGFibGUBAAtfaW5pdGlhbGl6ZQACCXN0YWNrU2F2ZQARDHN0YWNrUmVzdG9yZQASCnN0YWNrQWxsb2MAEwkMAQBBAQsGCgcJDxACDAEBCq5UEgMAAQsFAEGgCAsGAEGQiQELBgBBsIkCCwUAQZAJC+okAQh/QeQIKAIAIQVB4AgoAgAhA0HoCCgCACEIIAFBkIkBaiIJQf8BOgAAIAAgAUgEQCAAQZCJAWohBgNAIAMhBCAGQQFqIQECQCAGLQAAQf8AcSIDQTBrQQlLBEAgASEGDAELQewIKAIAQQJ0QewIaiICKAIAIQADQCACIAMgAEEKbGpBMGsiADYCACABLQAAIQMgAUEBaiIGIQEgA0H/AHEiA0Ewa0EKSQ0ACwsCQAJAAkACQAJAAkACQAJ/AkACQCADQT9rIgBBP00EQCAERQ0BIARBIUYEQAJAQfAIKAIAIgFBASABGyIHIAhqIgFB1AgoAgAiA0gNACADQf//AEoNAANAIANBAnQiAkGgiQJqIgRBoAgpAwA3AwAgAkGoiQJqQaAIKQMANwMAIAJBsIkCakGgCCkDADcDACACQbiJAmpBoAgpAwA3AwAgAkHAiQJqQaAIKQMANwMAIAJByIkCakGgCCkDADcDACACQdCJAmpBoAgpAwA3AwAgAkHYiQJqQaAIKQMANwMAIAJB4IkCakGgCCkDADcDACACQeiJAmpBoAgpAwA3AwAgAkHwiQJqQaAIKQMANwMAIAJB+IkCakGgCCkDADcDACACQYCKAmpBoAgpAwA3AwAgAkGIigJqQaAIKQMANwMAIAJBkIoCakGgCCkDADcDACACQZiKAmpBoAgpAwA3AwAgAkGgigJqQaAIKQMANwMAIAJBqIoCakGgCCkDADcDACACQbCKAmpBoAgpAwA3AwAgAkG4igJqQaAIKQMANwMAIAJBwIoCakGgCCkDADcDACACQciKAmpBoAgpAwA3AwAgAkHQigJqQaAIKQMANwMAIAJB2IoCakGgCCkDADcDACACQeCKAmpBoAgpAwA3AwAgAkHoigJqQaAIKQMANwMAIAJB8IoCakGgCCkDADcDACACQfiKAmpBoAgpAwA3AwAgAkGAiwJqQaAIKQMANwMAIAJBiIsCakGgCCkDADcDACACQZCLAmpBoAgpAwA3AwAgAkGYiwJqQaAIKQMANwMAIAJBoIsCakGgCCkDADcDACACQaiLAmpBoAgpAwA3AwAgAkGwiwJqQaAIKQMANwMAIAJBuIsCakGgCCkDADcDACACQcCLAmpBoAgpAwA3AwAgAkHIiwJqQaAIKQMANwMAIAJB0IsCakGgCCkDADcDACACQdiLAmpBoAgpAwA3AwAgAkHgiwJqQaAIKQMANwMAIAJB6IsCakGgCCkDADcDACACQfCLAmpBoAgpAwA3AwAgAkH4iwJqQaAIKQMANwMAIAJBgIwCakGgCCkDADcDACACQYiMAmpBoAgpAwA3AwAgAkGQjAJqQaAIKQMANwMAIAJBmIwCakGgCCkDADcDACACQaCMAmpBoAgpAwA3AwAgAkGojAJqQaAIKQMANwMAIAJBsIwCakGgCCkDADcDACACQbiMAmpBoAgpAwA3AwAgAkHAjAJqQaAIKQMANwMAIAJByIwCakGgCCkDADcDACACQdCMAmpBoAgpAwA3AwAgAkHYjAJqQaAIKQMANwMAIAJB4IwCakGgCCkDADcDACACQeiMAmpBoAgpAwA3AwAgAkHwjAJqQaAIKQMANwMAIAJB+IwCakGgCCkDADcDACACQYCNAmpBoAgpAwA3AwAgAkGIjQJqQaAIKQMANwMAIAJBkI0CakGgCCkDADcDACACQZiNAmpBoAgpAwA3AwAgAkGwiQZqIARBgAT8CgAAQdQIKAIAQQJ0QcCJCmogBEGABPwKAABB1AgoAgBBAnRB0IkOaiAEQYAE/AoAAEHUCCgCAEECdEHgiRJqIARBgAT8CgAAQdQIKAIAQQJ0QfCJFmogBEGABPwKAABB1AhB1AgoAgAiAkGAAWoiAzYCACABIANIDQEgAkGA/wBIDQALCwJAIABFDQAgCEH//wBLDQBBgIABIAhrIAcgAUH//wBLGyECAkAgAEEBcUUNACACRQ0AIAhBAnRBoIkCaiEDIAIhBCACQQdxIgcEQANAIAMgBTYCACADQQRqIQMgBEEBayEEIAdBAWsiBw0ACwsgAkEBa0EHSQ0AA0AgAyAFNgIcIAMgBTYCGCADIAU2AhQgAyAFNgIQIAMgBTYCDCADIAU2AgggAyAFNgIEIAMgBTYCACADQSBqIQMgBEEIayIEDQALCwJAIABBAnFFDQAgAkUNACAIQQJ0QbCJBmohAyACIQQgAkEHcSIHBEADQCADIAU2AgAgA0EEaiEDIARBAWshBCAHQQFrIgcNAAsLIAJBAWtBB0kNAANAIAMgBTYCHCADIAU2AhggAyAFNgIUIAMgBTYCECADIAU2AgwgAyAFNgIIIAMgBTYCBCADIAU2AgAgA0EgaiEDIARBCGsiBA0ACwsCQCAAQQRxRQ0AIAJFDQAgCEECdEHAiQpqIQMgAiEEIAJBB3EiBwRAA0AgAyAFNgIAIANBBGohAyAEQQFrIQQgB0EBayIHDQALCyACQQFrQQdJDQADQCADIAU2AhwgAyAFNgIYIAMgBTYCFCADIAU2AhAgAyAFNgIMIAMgBTYCCCADIAU2AgQgAyAFNgIAIANBIGohAyAEQQhrIgQNAAsLAkAgAEEIcUUNACACRQ0AIAhBAnRB0IkOaiEDIAIhBCACQQdxIgcEQANAIAMgBTYCACADQQRqIQMgBEEBayEEIAdBAWsiBw0ACwsgAkEBa0EHSQ0AA0AgAyAFNgIcIAMgBTYCGCADIAU2AhQgAyAFNgIQIAMgBTYCDCADIAU2AgggAyAFNgIEIAMgBTYCACADQSBqIQMgBEEIayIEDQALCwJAIABBEHFFDQAgAkUNACAIQQJ0QeCJEmohAyACIQQgAkEHcSIHBEADQCADIAU2AgAgA0EEaiEDIARBAWshBCAHQQFrIgcNAAsLIAJBAWtBB0kNAANAIAMgBTYCHCADIAU2AhggAyAFNgIUIAMgBTYCECADIAU2AgwgAyAFNgIIIAMgBTYCBCADIAU2AgAgA0EgaiEDIARBCGsiBA0ACwsgAEEgcUUNACACRQ0AIAJBAWshByAIQQJ0QfCJFmohAyACQQdxIgQEQANAIAMgBTYCACADQQRqIQMgAkEBayECIARBAWsiBA0ACwsgB0EHSQ0AA0AgAyAFNgIcIAMgBTYCGCADIAU2AhQgAyAFNgIQIAMgBTYCDCADIAU2AgggAyAFNgIEIAMgBTYCACADQSBqIQMgAkEIayICDQALC0HcCEHcCCgCACAAcjYCACAGQQFqIgIgBi0AAEH/AHEiA0E/ayIAQT9LDQQaDAMLAkBB7AgoAgAiBEEBRgRAQfAIKAIAIgNBzAgoAgAiAUkNASADIAFwIQMMAQtB+AgoAgAhAkH0CCgCACEBAkACQCAEQQVHDQAgAUEBRw0AIAJB6QJODQQMAQsgAkHkAEoNA0H8CCgCAEHkAEoNA0GACSgCAEHkAEoNAwsCQCABRQ0AIAFBAkoNACACQfwIKAIAQYAJKAIAIAFBAnRBiAhqKAIAEQIAIQFB8AgoAgAiA0HMCCgCACICTwR/IAMgAnAFIAMLQQJ0QZAJaiABNgIAC0HwCCgCACIDQcwIKAIAIgFJDQAgAyABcCEDCyADQQJ0QZAJaigCACEFDAELIANB/QBxQSFHBEAgCCEBIAYhAgwECyAEQSNHDQQCQEHsCCgCACICQQFGBEBB8AgoAgAiAUHMCCgCACIASQ0BIAEgAHAhAQwBC0H4CCgCACEBQfQIKAIAIQACQAJAIAJBBUcNACAAQQFHDQAgAUHpAkgNAQwHCyABQeQASg0GQfwIKAIAQeQASg0GQYAJKAIAQeQASg0GCwJAIABFDQAgAEECSg0AIAFB/AgoAgBBgAkoAgAgAEECdEGICGooAgARAgAhAEHwCCgCACIBQcwIKAIAIgJPBH8gASACcAUgAQtBAnRBkAlqIAA2AgALQfAIKAIAIgFBzAgoAgAiAEkNACABIABwIQELIAFBAnRBkAlqKAIAIQUMBAsgCCEBIAYhAgtB1AgoAgAhBgNAAkAgASAGSA0AIAZB//8ASg0AIAZBAnQiBEGgiQJqIgZBoAgpAwA3AwAgBEGoiQJqQaAIKQMANwMAIARBsIkCakGgCCkDADcDACAEQbiJAmpBoAgpAwA3AwAgBEHAiQJqQaAIKQMANwMAIARByIkCakGgCCkDADcDACAEQdCJAmpBoAgpAwA3AwAgBEHYiQJqQaAIKQMANwMAIARB4IkCakGgCCkDADcDACAEQeiJAmpBoAgpAwA3AwAgBEHwiQJqQaAIKQMANwMAIARB+IkCakGgCCkDADcDACAEQYCKAmpBoAgpAwA3AwAgBEGIigJqQaAIKQMANwMAIARBkIoCakGgCCkDADcDACAEQZiKAmpBoAgpAwA3AwAgBEGgigJqQaAIKQMANwMAIARBqIoCakGgCCkDADcDACAEQbCKAmpBoAgpAwA3AwAgBEG4igJqQaAIKQMANwMAIARBwIoCakGgCCkDADcDACAEQciKAmpBoAgpAwA3AwAgBEHQigJqQaAIKQMANwMAIARB2IoCakGgCCkDADcDACAEQeCKAmpBoAgpAwA3AwAgBEHoigJqQaAIKQMANwMAIARB8IoCakGgCCkDADcDACAEQfiKAmpBoAgpAwA3AwAgBEGAiwJqQaAIKQMANwMAIARBiIsCakGgCCkDADcDACAEQZCLAmpBoAgpAwA3AwAgBEGYiwJqQaAIKQMANwMAIARBoIsCakGgCCkDADcDACAEQaiLAmpBoAgpAwA3AwAgBEGwiwJqQaAIKQMANwMAIARBuIsCakGgCCkDADcDACAEQcCLAmpBoAgpAwA3AwAgBEHIiwJqQaAIKQMANwMAIARB0IsCakGgCCkDADcDACAEQdiLAmpBoAgpAwA3AwAgBEHgiwJqQaAIKQMANwMAIARB6IsCakGgCCkDADcDACAEQfCLAmpBoAgpAwA3AwAgBEH4iwJqQaAIKQMANwMAIARBgIwCakGgCCkDADcDACAEQYiMAmpBoAgpAwA3AwAgBEGQjAJqQaAIKQMANwMAIARBmIwCakGgCCkDADcDACAEQaCMAmpBoAgpAwA3AwAgBEGojAJqQaAIKQMANwMAIARBsIwCakGgCCkDADcDACAEQbiMAmpBoAgpAwA3AwAgBEHAjAJqQaAIKQMANwMAIARByIwCakGgCCkDADcDACAEQdCMAmpBoAgpAwA3AwAgBEHYjAJqQaAIKQMANwMAIARB4IwCakGgCCkDADcDACAEQeiMAmpBoAgpAwA3AwAgBEHwjAJqQaAIKQMANwMAIARB+IwCakGgCCkDADcDACAEQYCNAmpBoAgpAwA3AwAgBEGIjQJqQaAIKQMANwMAIARBkI0CakGgCCkDADcDACAEQZiNAmpBoAgpAwA3AwAgBEGwiQZqIAZBgAT8CgAAQdQIKAIAQQJ0QcCJCmogBkGABPwKAABB1AgoAgBBAnRB0IkOaiAGQYAE/AoAAEHUCCgCAEECdEHgiRJqIAZBgAT8CgAAQdQIKAIAQQJ0QfCJFmogBkGABPwKAABB1AhB1AgoAgBBgAFqIgY2AgALIAFB//8ATQRAIABBAXEgAWxBAnRBoIkCaiAFNgIAIABBAXZBAXEgAWxBAnRBsIkGaiAFNgIAIABBAnZBAXEgAWxBAnRBwIkKaiAFNgIAIABBA3ZBAXEgAWxBAnRB0IkOaiAFNgIAIABBBHZBAXEgAWxBAnRB4IkSaiAFNgIAIABBBXYgAWxBAnRB8IkWaiAFNgIAQdQIKAIAIQYLIAFBAWohAUHcCEHcCCgCACAAcjYCACACLQAAIQAgAkEBaiIEIQIgAEH/AHEiA0E/ayIAQcAASQ0ACyAECyECQQAhBCACIQYgASEIIANB/QBxQSFGDQELIANBJGsOCgEDAwMDAwMDAwIDC0HsCEIBNwIADAQLQdgIIAFB2AgoAgAiACAAIAFIGyIAQYCAASAAQYCAAUgbNgIADAILQegIIAFB2AgoAgAiACAAIAFIGyIAQYCAASAAQYCAAUgbIgA2AgBB2AggADYCACAAQQRrEAAEQEHoCEEENgIAQdgIQQQ2AgBB0AhBATYCAA8LEAgMAQsCQCADQTtHDQBB7AgoAgAiAEEHSg0AQewIIABBAWo2AgAgAEECdEHwCGpBADYCAAsgAiEGIAQhAyABIQgMAQtBBCEIIAIhBiAEIQMLIAYgCUkNAAsLQeQIIAU2AgBB4AggAzYCAEHoCCAINgIAC9ELAgF+CH9B2AhCBDcDAEGojQJBoAgpAwAiADcDAEGgjQIgADcDAEGYjQIgADcDAEGQjQIgADcDAEGIjQIgADcDAEGAjQIgADcDAEH4jAIgADcDAEHwjAIgADcDAEHojAIgADcDAEHgjAIgADcDAEHYjAIgADcDAEHQjAIgADcDAEHIjAIgADcDAEHAjAIgADcDAEG4jAIgADcDAEGwjAIgADcDAEGojAIgADcDAEGgjAIgADcDAEGYjAIgADcDAEGQjAIgADcDAEGIjAIgADcDAEGAjAIgADcDAEH4iwIgADcDAEHwiwIgADcDAEHoiwIgADcDAEHgiwIgADcDAEHYiwIgADcDAEHQiwIgADcDAEHIiwIgADcDAEHAiwIgADcDAEG4iwIgADcDAEGwiwIgADcDAEGoiwIgADcDAEGgiwIgADcDAEGYiwIgADcDAEGQiwIgADcDAEGIiwIgADcDAEGAiwIgADcDAEH4igIgADcDAEHwigIgADcDAEHoigIgADcDAEHgigIgADcDAEHYigIgADcDAEHQigIgADcDAEHIigIgADcDAEHAigIgADcDAEG4igIgADcDAEGwigIgADcDAEGoigIgADcDAEGgigIgADcDAEGYigIgADcDAEGQigIgADcDAEGIigIgADcDAEGAigIgADcDAEH4iQIgADcDAEHwiQIgADcDAEHoiQIgADcDAEHgiQIgADcDAEHYiQIgADcDAEHQiQIgADcDAEHIiQIgADcDAEHAiQIgADcDAEG4iQIgADcDAEGwiQIgADcDAEGoCCgCACIEQf8AakGAAW0hCAJAIARBgQFIDQBBASEBIAhBAiAIQQJKG0EBayICQQFxIQMgBEGBAk4EQCACQX5xIQIDQCABQQl0IgdBEHJBoIkCakGwiQJBgAT8CgAAIAdBsI0CakGwiQJBgAT8CgAAIAFBAmohASACQQJrIgINAAsLIANFDQAgAUEJdEEQckGgiQJqQbCJAkGABPwKAAALAkAgBEEBSA0AIAhBASAIQQFKGyIDQQFxIQUCQCADQQFrIgdFBEBBACEBDAELIANB/v///wdxIQJBACEBA0AgAUEJdCIGQRByQbCJBmpBsIkCQYAE/AoAACAGQZAEckGwiQZqQbCJAkGABPwKAAAgAUECaiEBIAJBAmsiAg0ACwsgBQRAIAFBCXRBEHJBsIkGakGwiQJBgAT8CgAACyAEQQFIDQAgA0EBcSEFIAcEfyADQf7///8HcSECQQAhAQNAIAFBCXQiBkEQckHAiQpqQbCJAkGABPwKAAAgBkGQBHJBwIkKakGwiQJBgAT8CgAAIAFBAmohASACQQJrIgINAAsgAUEHdEEEcgVBBAshASAFBEAgAUECdEHAiQpqQbCJAkGABPwKAAALIARBAUgNACADQQFxIQUgBwR/IANB/v///wdxIQJBACEBA0AgAUEJdCIGQRByQdCJDmpBsIkCQYAE/AoAACAGQZAEckHQiQ5qQbCJAkGABPwKAAAgAUECaiEBIAJBAmsiAg0ACyABQQd0QQRyBUEECyEBIAUEQCABQQJ0QdCJ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"}},125:(w,h,B)=>{Object.defineProperty(h,"__esModule",{value:!0}),h.IIPHandler=void 0;const c=B(782),l=B(216),Q=B(997),t=B(769),A=B(326),e={name:"Unnamed file",size:0,width:"auto",height:"auto",preserveAspectRatio:1,inline:0};h.IIPHandler=class{constructor(i,s,r,a){this._opts=i,this._renderer=s,this._storage=r,this._coreTerminal=a,this._aborted=!1,this._hp=new t.HeaderParser,this._header=e,this._dec=new Q.Base64Decoder(4194304),this._metrics=A.UNSUPPORTED_TYPE}reset(){}start(){this._aborted=!1,this._header=e,this._metrics=A.UNSUPPORTED_TYPE,this._hp.reset()}put(i,s,r){if(!this._aborted)if(4===this._hp.state)this._dec.put(i,s,r)&&(this._dec.release(),this._aborted=!0);else{const a=this._hp.parse(i,s,r);if(-1===a)return void(this._aborted=!0);if(a>0){if(this._header=Object.assign({},e,this._hp.fields),!this._header.inline||!this._header.size||this._header.size>this._opts.iipSizeLimit)return void(this._aborted=!0);this._dec.init(this._header.size),this._dec.put(i,a,r)&&(this._dec.release(),this._aborted=!0)}}}end(i){if(this._aborted)return!0;let s=0,r=0,a=!0;if((a=i)&&(a=!this._dec.end())&&(this._metrics=(0,A.imageType)(this._dec.data8),(a="unsupported"!==this._metrics.mime)&&(s=this._metrics.width,r=this._metrics.height,(a=s&&r&&s*r<this._opts.pixelLimit)&&([s,r]=this._resize(s,r).map(Math.floor),a=s&&r&&s*r<this._opts.pixelLimit))),!a)return this._dec.release(),!0;const g=new Blob([this._dec.data8],{type:this._metrics.mime});this._dec.release();const o=this._coreTerminal._core._coreBrowserService.window;if(!o.createImageBitmap){const n=URL.createObjectURL(g),I=new Image;return new Promise(C=>{I.addEventListener("load",()=>{var E;URL.revokeObjectURL(n);const d=c.ImageRenderer.createCanvas(o,s,r);null===(E=d.getContext("2d"))||void 0===E||E.drawImage(I,0,0,s,r),this._storage.addImage(d),C(!0)}),I.src=n,setTimeout(()=>C(!0),1e3)})}return o.createImageBitmap(g,{resizeWidth:s,resizeHeight:r}).then(n=>(this._storage.addImage(n),!0))}_resize(i,s){var r,a,g,o;const n=(null===(r=this._renderer.dimensions)||void 0===r?void 0:r.css.cell.width)||l.CELL_SIZE_DEFAULT.width,I=(null===(a=this._renderer.dimensions)||void 0===a?void 0:a.css.cell.height)||l.CELL_SIZE_DEFAULT.height,C=(null===(g=this._renderer.dimensions)||void 0===g?void 0:g.css.canvas.width)||n*this._coreTerminal.cols,E=(null===(o=this._renderer.dimensions)||void 0===o?void 0:o.css.canvas.height)||I*this._coreTerminal.rows,d=this._dim(this._header.width,C,n),_=this._dim(this._header.height,E,I);if(!d&&!_){const m=Math.min(C/i,(E-I)/s);return m<1?[i*m,s*m]:[i,s]}return d?!this._header.preserveAspectRatio&&d&&_?[d,_]:[d,s*d/i]:[i*_/s,_]}_dim(i,s,r){return"auto"===i?0:i.endsWith("%")?parseInt(i.slice(0,-1))*s/100:i.endsWith("px")?parseInt(i.slice(0,-2)):parseInt(i)*r}}},769:(w,h)=>{function B(e){let i="";for(let s=0;s<e.length;++s)i+=String.fromCharCode(e[s]);return i}function c(e){let i=0;for(let s=0;s<e.length;++s){if(e[s]<48||e[s]>57)throw new Error("illegal char");i=10*i+e[s]-48}return i}function l(e){const i=B(e);if(!i.match(/^((auto)|(\d+?((px)|(%)){0,1}))$/))throw new Error("illegal size");return i}Object.defineProperty(h,"__esModule",{value:!0}),h.HeaderParser=void 0;const Q={inline:c,size:c,name:function(e){if(typeof Buffer<"u")return Buffer.from(B(e),"base64").toString();const i=atob(B(e)),s=new Uint8Array(i.length);for(let r=0;r<s.length;++r)s[r]=i.charCodeAt(r);return(new TextDecoder).decode(s)},width:l,height:l,preserveAspectRatio:c},t=[70,105,108,101],A=1024;h.HeaderParser=class{constructor(){this.state=0,this._buffer=new Uint32Array(A),this._position=0,this._key="",this.fields={}}reset(){this._buffer.fill(0),this.state=0,this._position=0,this.fields={},this._key=""}parse(e,i,s){let r=this.state,a=this._position;const g=this._buffer;if(1===r||4===r||0===r&&a>6)return-1;for(let o=i;o<s;++o){const n=e[o];switch(n){case 59:if(!this._storeValue(a))return this._a();r=2,a=0;break;case 61:if(0===r){for(let I=0;I<t.length;++I)if(g[I]!==t[I])return this._a();r=2,a=0}else if(2===r){if(!this._storeKey(a))return this._a();r=3,a=0}else if(3===r){if(a>=A)return this._a();g[a++]=n}break;case 58:return 3!==r||this._storeValue(a)?(this.state=4,o+1):this._a();default:if(a>=A)return this._a();g[a++]=n}}return this.state=r,this._position=a,-2}_a(){return this.state=1,-1}_storeKey(e){const i=B(this._buffer.subarray(0,e));return!!i&&(this._key=i,this.fields[i]=null,!0)}_storeValue(e){if(this._key){try{const i=this._buffer.slice(0,e);this.fields[this._key]=Q[this._key]?Q[this._key](i):i}catch{return!1}return!0}return!1}}},326:(w,h)=>{Object.defineProperty(h,"__esModule",{value:!0}),h.imageType=h.UNSUPPORTED_TYPE=void 0,h.UNSUPPORTED_TYPE={mime:"unsupported",width:0,height:0},h.imageType=function(B){if(B.length<24)return h.UNSUPPORTED_TYPE;const c=new Uint32Array(B.buffer,B.byteOffset,6);if(1196314761===c[0]&&169478669===c[1]&&1380206665===c[3])return{mime:"image/png",width:B[16]<<24|B[17]<<16|B[18]<<8|B[19],height:B[20]<<24|B[21]<<16|B[22]<<8|B[23]};if((3774863615===c[0]||3791640831===c[0])&&(74===B[6]&&70===B[7]&&73===B[8]&&70===B[9]||69===B[6]&&120===B[7]&&105===B[8]&&102===B[9])){const[l,Q]=function(t){const A=t.length;let e=4,i=t[e]<<8|t[e+1];for(;;){if(e+=i,e>=A)return[0,0];if(255!==t[e])return[0,0];if(192===t[e+1]||194===t[e+1])return e+8<A?[t[e+7]<<8|t[e+8],t[e+5]<<8|t[e+6]]:[0,0];e+=2,i=t[e]<<8|t[e+1]}}(B);return{mime:"image/jpeg",width:l,height:Q}}return 944130375!==c[0]||55!==B[4]&&57!==B[4]||97!==B[5]?h.UNSUPPORTED_TYPE:{mime:"image/gif",width:B[7]<<8|B[6],height:B[9]<<8|B[8]}}},782:(w,h,B)=>{Object.defineProperty(h,"__esModule",{value:!0}),h.ImageRenderer=void 0;const c=B(477);class l{constructor(t,A){this._terminal=t,this._showPlaceholder=A,this._oldOpen=this._terminal._core.open,this._terminal._core.open=e=>{var i;null===(i=this._oldOpen)||void 0===i||i.call(this._terminal._core,e),this._open()},this._terminal._core.screenElement&&this._open(),this._optionsRefresh=this._terminal._core.optionsService.onOptionChange(e=>{var i;"fontSize"===e&&(this.rescaleCanvas(),null===(i=this._renderService)||void 0===i||i.refreshRows(0,this._terminal.rows))})}static createCanvas(t,A,e){const i=t.document.createElement("canvas");return i.width=0|A,i.height=0|e,i}static createImageData(t,A,e,i){if("function"!=typeof ImageData){const s=t.createImageData(A,e);return i&&s.data.set(new Uint8ClampedArray(i,0,A*e*4)),s}return i?new ImageData(new Uint8ClampedArray(i,0,A*e*4),A,e):new ImageData(A,e)}static createImageBitmap(t){return"function"!=typeof createImageBitmap?Promise.resolve(void 0):createImageBitmap(t)}dispose(){var t,A;null===(t=this._optionsRefresh)||void 0===t||t.dispose(),this._removeLayerFromDom(),this._terminal._core&&this._oldOpen&&(this._terminal._core.open=this._oldOpen,this._oldOpen=void 0),this._renderService&&this._oldSetRenderer&&(this._renderService.setRenderer=this._oldSetRenderer,this._oldSetRenderer=void 0),this._renderService=void 0,this.canvas=void 0,this._ctx=void 0,null===(A=this._placeholderBitmap)||void 0===A||A.close(),this._placeholderBitmap=void 0,this._placeholder=void 0}showPlaceholder(t){var A,e;t?this._placeholder||-1===this.cellSize.height||this._createPlaceHolder(Math.max(this.cellSize.height+1,24)):(null===(A=this._placeholderBitmap)||void 0===A||A.close(),this._placeholderBitmap=void 0,this._placeholder=void 0),null===(e=this._renderService)||void 0===e||e.refreshRows(0,this._terminal.rows)}get dimensions(){var t;return null===(t=this._renderService)||void 0===t?void 0:t.dimensions}get cellSize(){var t,A;return{width:(null===(t=this.dimensions)||void 0===t?void 0:t.css.cell.width)||-1,height:(null===(A=this.dimensions)||void 0===A?void 0:A.css.cell.height)||-1}}clearLines(t,A){var e,i,s,r;null===(e=this._ctx)||void 0===e||e.clearRect(0,t*((null===(i=this.dimensions)||void 0===i?void 0:i.css.cell.height)||0),(null===(s=this.dimensions)||void 0===s?void 0:s.css.canvas.width)||0,(++A-t)*((null===(r=this.dimensions)||void 0===r?void 0:r.css.cell.height)||0))}clearAll(){var t,A,e;null===(t=this._ctx)||void 0===t||t.clearRect(0,0,(null===(A=this.canvas)||void 0===A?void 0:A.width)||0,(null===(e=this.canvas)||void 0===e?void 0:e.height)||0)}draw(t,A,e,i,s=1){if(!this._ctx)return;const{width:r,height:a}=this.cellSize;if(-1===r||-1===a)return;this._rescaleImage(t,r,a);const g=t.actual,o=Math.ceil(g.width/r),n=A%o*r,I=Math.floor(A/o)*a,C=e*r,E=i*a,d=s*r+n>g.width?g.width-n:s*r,_=I+a>g.height?g.height-I:a;this._ctx.drawImage(g,Math.floor(n),Math.floor(I),Math.ceil(d),Math.ceil(_),Math.floor(C),Math.floor(E),Math.ceil(d),Math.ceil(_))}extractTile(t,A){const{width:e,height:i}=this.cellSize;if(-1===e||-1===i)return;this._rescaleImage(t,e,i);const s=t.actual,r=Math.ceil(s.width/e),a=A%r*e,g=Math.floor(A/r)*i,o=e+a>s.width?s.width-a:e,n=g+i>s.height?s.height-g:i,I=l.createCanvas(this._terminal._core._coreBrowserService.window,o,n),C=I.getContext("2d");return C?(C.drawImage(s,Math.floor(a),Math.floor(g),Math.floor(o),Math.floor(n),0,0,Math.floor(o),Math.floor(n)),I):void 0}drawPlaceholder(t,A,e=1){if((this._placeholderBitmap||this._placeholder)&&this._ctx){const{width:i,height:s}=this.cellSize;if(-1===i||-1===s)return;s>=this._placeholder.height&&this._createPlaceHolder(s+1),this._ctx.drawImage(this._placeholderBitmap||this._placeholder,t*i,A*s%2?0:1,i*e,s,t*i,A*s,i*e,s)}}rescaleCanvas(){this.canvas&&(this.canvas.width===this.dimensions.css.canvas.width&&this.canvas.height===this.dimensions.css.canvas.height||(this.canvas.width=this.dimensions.css.canvas.width||0,this.canvas.height=this.dimensions.css.canvas.height||0))}_rescaleImage(t,A,e){if(A===t.actualCellSize.width&&e===t.actualCellSize.height)return;const{width:i,height:s}=t.origCellSize;if(A===i&&e===s)return t.actual=t.orig,t.actualCellSize.width=i,void(t.actualCellSize.height=s);const r=l.createCanvas(this._terminal._core._coreBrowserService.window,Math.ceil(t.orig.width*A/i),Math.ceil(t.orig.height*e/s)),a=r.getContext("2d");a&&(a.drawImage(t.orig,0,0,r.width,r.height),t.actual=r,t.actualCellSize.width=A,t.actualCellSize.height=e)}_open(){this._renderService=this._terminal._core._renderService,this._oldSetRenderer=this._renderService.setRenderer.bind(this._renderService),this._renderService.setRenderer=t=>{var A;this._removeLayerFromDom(),null===(A=this._oldSetRenderer)||void 0===A||A.call(this._renderService,t),this._insertLayerToDom()},this._insertLayerToDom(),this._showPlaceholder&&this._createPlaceHolder()}_insertLayerToDom(){var t,A,e;this.canvas=l.createCanvas(this._terminal._core._coreBrowserService.window,(null===(t=this.dimensions)||void 0===t?void 0:t.css.canvas.width)||0,(null===(A=this.dimensions)||void 0===A?void 0:A.css.canvas.height)||0),this.canvas.classList.add("xterm-image-layer"),null===(e=this._terminal._core.screenElement)||void 0===e||e.appendChild(this.canvas),this._ctx=this.canvas.getContext("2d",{alpha:!0,desynchronized:!0})}_removeLayerFromDom(){var t,A;null===(A=null===(t=this.canvas)||void 0===t?void 0:t.parentNode)||void 0===A||A.removeChild(this.canvas)}_createPlaceHolder(t=24){var A;null===(A=this._placeholderBitmap)||void 0===A||A.close(),this._placeholderBitmap=void 0;const e=32,i=l.createCanvas(this._terminal._core._coreBrowserService.window,e,t),s=i.getContext("2d",{alpha:!1});if(!s)return;const r=l.createImageData(s,e,t),a=new Uint32Array(r.data.buffer),g=(0,c.toRGBA8888)(0,0,0),o=(0,c.toRGBA8888)(255,255,255);a.fill(g);for(let C=0;C<t;++C){const E=C%2,d=C*e;for(let _=0;_<e;_+=2)a[d+_+E]=o}s.putImageData(r,0,0);const n=screen.width+e-1&-32||4096;this._placeholder=l.createCanvas(this._terminal._core._coreBrowserService.window,n,t);const I=this._placeholder.getContext("2d",{alpha:!1});if(I){for(let C=0;C<n;C+=e)I.drawImage(i,C,0);l.createImageBitmap(this._placeholder).then(C=>this._placeholderBitmap=C)}else this._placeholder=void 0}}h.ImageRenderer=l},216:(w,h,B)=>{Object.defineProperty(h,"__esModule",{value:!0}),h.ImageStorage=h.CELL_SIZE_DEFAULT=void 0;const c=B(782);h.CELL_SIZE_DEFAULT={width:7,height:14};class l{constructor(A=0,e=0,i=-1,s=-1){this.imageId=i,this.tileId=s,this._ext=0,this._urlId=0,this._ext=A,this._urlId=e}get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(A){this._ext=A}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(A){this._ext&=-469762049,this._ext|=A<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(A){this._ext&=-67108864,this._ext|=67108863&A}get urlId(){return this._urlId}set urlId(A){this._urlId=A}clone(){return new l(this._ext,this._urlId,this.imageId,this.tileId)}isEmpty(){return 0===this.underlineStyle&&0===this._urlId&&-1===this.imageId}}const Q=new l;h.ImageStorage=class{constructor(t,A,e){this._terminal=t,this._renderer=A,this._opts=e,this._images=new Map,this._lastId=0,this._lowestId=0,this._fullyCleared=!1,this._needsFullClear=!1,this._pixelLimit=25e5;try{this.setLimit(this._opts.storageLimit)}catch(i){console.error(i.message),console.warn(`storageLimit is set to ${this.getLimit()} MB`)}this._viewportMetrics={cols:this._terminal.cols,rows:this._terminal.rows}}dispose(){this.reset()}reset(){var t;for(const A of this._images.values())null===(t=A.marker)||void 0===t||t.dispose();this._images.clear(),this._renderer.clearAll()}getLimit(){return 4*this._pixelLimit/1e6}setLimit(t){if(t<1||t>1e3)throw RangeError("invalid storageLimit, should be at least 1 MB and not exceed 1G");this._pixelLimit=t/4*1e6>>>0,this._evictOldest(0)}getUsage(){return 4*this._getStoredPixels()/1e6}_getStoredPixels(){let t=0;for(const A of this._images.values())A.orig&&(t+=A.orig.width*A.orig.height,A.actual&&A.actual!==A.orig&&(t+=A.actual.width*A.actual.height));return t}_delImg(t){const A=this._images.get(t);this._images.delete(t),A&&this._terminal._core._coreBrowserService.window.ImageBitmap&&A.orig instanceof ImageBitmap&&A.orig.close()}wipeAlternate(){var t;const A=[];for(const[e,i]of this._images.entries())"alternate"===i.bufferType&&(null===(t=i.marker)||void 0===t||t.dispose(),A.push(e));for(const e of A)this._delImg(e);this._needsFullClear=!0,this._fullyCleared=!1}advanceCursor(t){if(this._opts.sixelScrolling){let A=this._renderer.cellSize;-1!==A.width&&-1!==A.height||(A=h.CELL_SIZE_DEFAULT);const e=Math.ceil(t/A.height);for(let i=1;i<e;++i)this._terminal._core._inputHandler.lineFeed()}}addImage(t){var A;this._evictOldest(t.width*t.height);let e=this._renderer.cellSize;-1!==e.width&&-1!==e.height||(e=h.CELL_SIZE_DEFAULT);const i=Math.ceil(t.width/e.width),s=Math.ceil(t.height/e.height),r=++this._lastId,a=this._terminal._core.buffer,g=this._terminal.cols,o=this._terminal.rows,n=a.x,I=a.y;let C=n,E=0;this._opts.sixelScrolling||(a.x=0,a.y=0,C=0),this._terminal._core._inputHandler._dirtyRowTracker.markDirty(a.y);for(let D=0;D<s;++D){const m=a.lines.get(a.y+a.ybase);for(let f=0;f<i&&!(C+f>=g);++f)this._writeToCell(m,C+f,r,D*i+f),E++;if(this._opts.sixelScrolling)D<s-1&&this._terminal._core._inputHandler.lineFeed();else if(++a.y>=o)break;a.x=C}this._terminal._core._inputHandler._dirtyRowTracker.markDirty(a.y),this._opts.sixelScrolling?a.x=C:(a.x=n,a.y=I);const d=[];for(const[D,m]of this._images.entries())m.tileCount<1&&(null===(A=m.marker)||void 0===A||A.dispose(),d.push(D));for(const D of d)this._delImg(D);const _=this._terminal.registerMarker(0);_?.onDispose(()=>{this._images.get(r)&&this._delImg(r)}),"alternate"===this._terminal.buffer.active.type&&this._evictOnAlternate();const k={orig:t,origCellSize:e,actual:t,actualCellSize:Object.assign({},e),marker:_||void 0,tileCount:E,bufferType:this._terminal.buffer.active.type};this._images.set(r,k)}render(t){if(!this._renderer.canvas)return;if(!this._images.size)return void(this._fullyCleared||(this._renderer.clearAll(),this._fullyCleared=!0,this._needsFullClear=!1));this._needsFullClear&&(this._renderer.clearAll(),this._fullyCleared=!0,this._needsFullClear=!1);const{start:A,end:e}=t,i=this._terminal._core.buffer,s=this._terminal._core.cols;this._renderer.clearLines(A,e),this._renderer.rescaleCanvas();for(let r=A;r<=e;++r){const a=i.lines.get(r+i.ydisp);if(!a)return;for(let g=0;g<s;++g)if(268435456&a.getBg(g)){let o=a._extendedAttrs[g]||Q;const n=o.imageId;if(void 0===n||-1===n)continue;const I=this._images.get(n);if(-1!==o.tileId){const C=o.tileId,E=g;let d=1;for(;++g<s&&268435456&a.getBg(g)&&(o=a._extendedAttrs[g]||Q)&&o.imageId===n&&o.tileId===C+d;)d++;g--,I?I.actual&&this._renderer.draw(I,C,E,r,d):this._opts.showPlaceholder&&this._renderer.drawPlaceholder(E,r,d),this._fullyCleared=!1}}}}viewportResize(t){var A;if(!this._images.size)return void(this._viewportMetrics=t);if(this._viewportMetrics.cols>=t.cols)return void(this._viewportMetrics=t);const e=this._terminal._core.buffer,i=e.lines.length,s=this._viewportMetrics.cols-1;for(let r=0;r<i;++r){const a=e.lines.get(r);if(268435456&a.getBg(s)){const g=a._extendedAttrs[s]||Q,o=g.imageId;if(void 0===o||-1===o)continue;const n=this._images.get(o);if(!n)continue;const I=Math.ceil(((null===(A=n.actual)||void 0===A?void 0:A.width)||0)/n.actualCellSize.width);if(g.tileId%I+1>=I)continue;let C=!1;for(let _=s+1;_>t.cols;++_)if(4194303&a._data[3*_+0]){C=!0;break}if(C)continue;const E=Math.min(t.cols,I-g.tileId%I+s);let d=g.tileId;for(let _=s+1;_<E;++_)this._writeToCell(a,_,o,++d),n.tileCount++}}this._viewportMetrics=t}getImageAtBufferCell(t,A){var e,i;const s=this._terminal._core.buffer.lines.get(A);if(s&&268435456&s.getBg(t)){const r=s._extendedAttrs[t]||Q;if(r.imageId&&-1!==r.imageId){const a=null===(e=this._images.get(r.imageId))||void 0===e?void 0:e.orig,g=this._terminal._core._coreBrowserService.window;if(g.ImageBitmap&&a instanceof ImageBitmap){const o=c.ImageRenderer.createCanvas(g,a.width,a.height);return null===(i=o.getContext("2d"))||void 0===i||i.drawImage(a,0,0,a.width,a.height),o}return a}}}extractTileAtBufferCell(t,A){const e=this._terminal._core.buffer.lines.get(A);if(e&&268435456&e.getBg(t)){const i=e._extendedAttrs[t]||Q;if(i.imageId&&-1!==i.imageId&&-1!==i.tileId){const s=this._images.get(i.imageId);if(s)return this._renderer.extractTile(s,i.tileId)}}}_evictOldest(t){var A;const e=this._getStoredPixels();let i=e;for(;this._pixelLimit<i+t&&this._images.size;){const s=this._images.get(++this._lowestId);s&&s.orig&&(i-=s.orig.width*s.orig.height,s.actual&&s.orig!==s.actual&&(i-=s.actual.width*s.actual.height),null===(A=s.marker)||void 0===A||A.dispose(),this._delImg(this._lowestId))}return e-i}_writeToCell(t,A,e,i){if(268435456&t._data[3*A+2]){const s=t._extendedAttrs[A];if(s){if(void 0!==s.imageId){const r=this._images.get(s.imageId);return r&&r.tileCount--,s.imageId=e,void(s.tileId=i)}return void(t._extendedAttrs[A]=new l(s.ext,s.urlId,e,i))}}t._data[3*A+2]|=268435456,t._extendedAttrs[A]=new l(0,0,e,i)}_evictOnAlternate(){var t,A;for(const s of this._images.values())"alternate"===s.bufferType&&(s.tileCount=0);const e=this._terminal._core.buffer;for(let s=0;s<this._terminal.rows;++s){const r=e.lines.get(s);if(r)for(let a=0;a<this._terminal.cols;++a)if(268435456&r._data[3*a+2]){const g=null===(t=r._extendedAttrs[a])||void 0===t?void 0:t.imageId;if(g){const o=this._images.get(g);o&&o.tileCount++}}}const i=[];for(const[s,r]of this._images.entries())"alternate"!==r.bufferType||r.tileCount||(null===(A=r.marker)||void 0===A||A.dispose(),i.push(s));for(const s of i)this._delImg(s)}}},973:(w,h,B)=>{Object.defineProperty(h,"__esModule",{value:!0}),h.SixelHandler=void 0;const c=B(477),l=B(782),Q=B(710),t=c.PALETTE_ANSI_256;function A(e){return c.BIG_ENDIAN?e:(255&e)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255}t.set(c.PALETTE_VT340_COLOR),h.SixelHandler=class{constructor(e,i,s){this._opts=e,this._storage=i,this._coreTerminal=s,this._size=0,this._aborted=!1,(0,Q.DecoderAsync)({memoryLimit:4*this._opts.pixelLimit,palette:t,paletteLimit:this._opts.sixelPaletteLimit}).then(r=>this._dec=r)}reset(){this._dec&&(this._dec.release(),this._dec._palette.fill(0),this._dec.init(0,t,this._opts.sixelPaletteLimit))}hook(e){if(this._size=0,this._aborted=!1,this._dec){const i=1===e.params[1]?0:function(s,r){let a=0;if(s.isInverse())if(s.isFgDefault())a=A(r.foreground.rgba);else if(s.isFgRGB()){const g=s.constructor.toColorRGB(s.getFgColor());a=(0,c.toRGBA8888)(...g)}else a=A(r.ansi[s.getFgColor()].rgba);else if(s.isBgDefault())a=A(r.background.rgba);else if(s.isBgRGB()){const g=s.constructor.toColorRGB(s.getBgColor());a=(0,c.toRGBA8888)(...g)}else a=A(r.ansi[s.getBgColor()].rgba);return a}(this._coreTerminal._core._inputHandler._curAttrData,this._coreTerminal._core._themeService.colors);this._dec.init(i,null,this._opts.sixelPaletteLimit)}}put(e,i,s){if(!this._aborted&&this._dec){if(this._size+=s-i,this._size>this._opts.sixelSizeLimit)return console.warn("SIXEL: too much data, aborting"),this._aborted=!0,void this._dec.release();try{this._dec.decode(e,i,s)}catch(r){console.warn(`SIXEL: error while decoding image - ${r}`),this._aborted=!0,this._dec.release()}}}unhook(e){var i;if(this._aborted||!e||!this._dec)return!0;const s=this._dec.width,r=this._dec.height;if(!s||!r)return r&&this._storage.advanceCursor(r),!0;const a=l.ImageRenderer.createCanvas(this._coreTerminal._core._coreBrowserService.window,s,r);return null===(i=a.getContext("2d"))||void 0===i||i.putImageData(new ImageData(this._dec.data8,s,r),0,0),this._dec.memoryUsage>4194304&&this._dec.release(),this._storage.addImage(a),!0}}},997:(w,h,B)=>{Object.defineProperty(h,"__esModule",{value:!0}),h.Base64Decoder=void 0;const c=(0,B(615).InWasm)({s:1,t:0,d:"AGFzbQEAAAABBQFgAAF/Ag8BA2VudgZtZW1vcnkCAAEDAwIAAAcNAgNkZWMAAANlbmQAAQqxAwKuAQEFf0GIKCgCAEGgKGohAUGEKCgCACIAQYAoKAIAQQFrQXxxIgJIBEAgAkGgKGohAyAAQaAoaiEAA0AgAC0AA0ECdCgCgCAgAC0AAkECdCgCgBggAC0AAUECdCgCgBAgAC0AAEECdCgCgAhycnIiBEH///8HSwRAQQEPCyABIAQ2AgAgAUEDaiEBIABBBGoiACADSQ0ACwtBhCggAjYCAEGIKCABQaAoazYCAEEAC/4BAQZ/AkBBgCgoAgAiAUGEKCgCACIAa0EFTgRAQQEhAxAADQFBgCgoAgAhAUGEKCgCACEAC0EBIQMgASAAayIEQQJIDQAgAEGhKGotAABBAnQoAoAQIABBoChqLQAAQQJ0KAKACHIhAQJAIARBAkYEQEEBIQIMAQtBASECIAAtAKIoIgVBPUcEQEECIQIgBUECdCgCgBggAXIhAQsgBEEERw0AIAAtAKMoIgBBPUYNACACQQFqIQIgAEECdCgCgCAgAXIhAQsgAUH///8HSw0AQYgoKAIAQaAoaiABNgIAQYgoQYgoKAIAIAJqIgA2AgAgAEGQKCgCAEchAwsgAwsAdglwcm9kdWNlcnMBDHByb2Nlc3NlZC1ieQEFY2xhbmdWMTcuMC4wIChodHRwczovL2dpdGh1Yi5jb20vbGx2bS9sbHZtLXByb2plY3QgODg0MjFlYTk3MzkxNmU2MGMzNGJlYjI2NTk3YTVmYzMzZjgzZGQ4ZikALA90YXJnZXRfZmVhdHVyZXMCKw9tdXRhYmxlLWdsb2JhbHMrCHNpZ24tZXh0"}),l=new Uint8Array("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").map(A=>A.charCodeAt(0))),Q=new Uint32Array(1024);Q.fill(4278190080);for(let A=0;A<l.length;++A)Q[l[A]]=A<<2;for(let A=0;A<l.length;++A)Q[256+l[A]]=A>>4|(A<<4&255)<<8;for(let A=0;A<l.length;++A)Q[512+l[A]]=A>>2<<8|(A<<6&255)<<16;for(let A=0;A<l.length;++A)Q[768+l[A]]=A<<16;const t=new Uint8Array(0);h.Base64Decoder=class{constructor(A){this.keepSize=A}get data8(){return this._inst?this._d.subarray(0,this._m32[1282]):t}release(){this._inst&&(this._mem.buffer.byteLength>this.keepSize?this._inst=this._m32=this._d=this._mem=null:(this._m32[1280]=0,this._m32[1281]=0,this._m32[1282]=0))}init(A){let e=this._m32;const i=4*(Math.ceil(A/3)+1288);this._inst?this._mem.buffer.byteLength<i&&(this._mem.grow(Math.ceil((i-this._mem.buffer.byteLength)/65536)),e=new Uint32Array(this._mem.buffer,0),this._d=new Uint8Array(this._mem.buffer,5152)):(this._mem=new WebAssembly.Memory({initial:Math.ceil(i/65536)}),this._inst=c({env:{memory:this._mem}}),e=new Uint32Array(this._mem.buffer,0),e.set(Q,256),this._d=new Uint8Array(this._mem.buffer,5152)),e[1284]=A,e[1283]=4*Math.ceil(A/3),e[1280]=0,e[1281]=0,e[1282]=0,this._m32=e}put(A,e,i){if(!this._inst)return 1;const s=this._m32;return i-e+s[1280]>s[1283]?1:(this._d.set(A.subarray(e,i),s[1280]),s[1280]+=i-e,s[1280]-s[1281]>=131072?this._inst.exports.dec():0)}end(){return this._inst?this._inst.exports.end():1}}}},p={};function u(w){var h=p[w];if(void 0!==h)return h.exports;var B=p[w]={exports:{}};return M[w](B,B.exports,u),B.exports}var v={};return(()=>{var w=v;Object.defineProperty(w,"__esModule",{value:!0}),w.ImageAddon=void 0;const h=u(125),B=u(782),c=u(216),l=u(973),Q={enableSizeReports:!0,pixelLimit:16777216,sixelSupport:!0,sixelScrolling:!0,sixelPaletteLimit:256,sixelSizeLimit:25e6,storageLimit:128,showPlaceholder:!0,iipSupport:!0,iipSizeLimit:2e7};w.ImageAddon=class{constructor(t){this._disposables=[],this._handlers=new Map,this._opts=Object.assign({},Q,t),this._defaultOpts=Object.assign({},Q,t)}dispose(){for(const t of this._disposables)t.dispose();this._disposables.length=0,this._handlers.clear()}_disposeLater(...t){for(const A of t)this._disposables.push(A)}activate(t){if(this._terminal=t,this._renderer=new B.ImageRenderer(t,this._opts.showPlaceholder),this._storage=new c.ImageStorage(t,this._renderer,this._opts),this._opts.enableSizeReports){const A=t.options.windowOptions||{};A.getWinSizePixels=!0,A.getCellSizePixels=!0,A.getWinSizeChars=!0,t.options.windowOptions=A}if(this._disposeLater(this._renderer,this._storage,t.parser.registerCsiHandler({prefix:"?",final:"h"},A=>this._decset(A)),t.parser.registerCsiHandler({prefix:"?",final:"l"},A=>this._decrst(A)),t.parser.registerCsiHandler({final:"c"},A=>this._da1(A)),t.parser.registerCsiHandler({prefix:"?",final:"S"},A=>this._xtermGraphicsAttributes(A)),t.onRender(A=>{var e;return null===(e=this._storage)||void 0===e?void 0:e.render(A)}),t.parser.registerCsiHandler({intermediates:"!",final:"p"},()=>this.reset()),t.parser.registerEscHandler({final:"c"},()=>this.reset()),t._core._inputHandler.onRequestReset(()=>this.reset()),t.buffer.onBufferChange(()=>{var A;return null===(A=this._storage)||void 0===A?void 0:A.wipeAlternate()}),t.onResize(A=>{var e;return null===(e=this._storage)||void 0===e?void 0:e.viewportResize(A)})),this._opts.sixelSupport){const A=new l.SixelHandler(this._opts,this._storage,t);this._handlers.set("sixel",A),this._disposeLater(t._core._inputHandler._parser.registerDcsHandler({final:"q"},A))}if(this._opts.iipSupport){const A=new h.IIPHandler(this._opts,this._renderer,this._storage,t);this._handlers.set("iip",A),this._disposeLater(t._core._inputHandler._parser.registerOscHandler(1337,A))}}reset(){var t;this._opts.sixelScrolling=this._defaultOpts.sixelScrolling,this._opts.sixelPaletteLimit=this._defaultOpts.sixelPaletteLimit,null===(t=this._storage)||void 0===t||t.reset();for(const A of this._handlers.values())A.reset();return!1}get storageLimit(){var t;return(null===(t=this._storage)||void 0===t?void 0:t.getLimit())||-1}set storageLimit(t){var A;null===(A=this._storage)||void 0===A||A.setLimit(t),this._opts.storageLimit=t}get storageUsage(){return this._storage?this._storage.getUsage():-1}get showPlaceholder(){return this._opts.showPlaceholder}set showPlaceholder(t){var A;this._opts.showPlaceholder=t,null===(A=this._renderer)||void 0===A||A.showPlaceholder(t)}getImageAtBufferCell(t,A){var e;return null===(e=this._storage)||void 0===e?void 0:e.getImageAtBufferCell(t,A)}extractTileAtBufferCell(t,A){var e;return null===(e=this._storage)||void 0===e?void 0:e.extractTileAtBufferCell(t,A)}_report(t){var A;null===(A=this._terminal)||void 0===A||A._core.coreService.triggerDataEvent(t)}_decset(t){for(let A=0;A<t.length;++A)80===t[A]&&(this._opts.sixelScrolling=!1);return!1}_decrst(t){for(let A=0;A<t.length;++A)80===t[A]&&(this._opts.sixelScrolling=!0);return!1}_da1(t){return!!t[0]||!!this._opts.sixelSupport&&(this._report("\x1b[?62;4;9;22c"),!0)}_xtermGraphicsAttributes(t){var A,e,i,s,r,a;if(t.length<2)return!0;if(1===t[0])switch(t[1]){case 1:return this._report(`\x1b[?${t[0]};0;${this._opts.sixelPaletteLimit}S`),!0;case 2:this._opts.sixelPaletteLimit=this._defaultOpts.sixelPaletteLimit,this._report(`\x1b[?${t[0]};0;${this._opts.sixelPaletteLimit}S`);for(const g of this._handlers.values())g.reset();return!0;case 3:return t.length>2&&!(t[2]instanceof Array)&&t[2]<=4096?(this._opts.sixelPaletteLimit=t[2],this._report(`\x1b[?${t[0]};0;${this._opts.sixelPaletteLimit}S`)):this._report(`\x1b[?${t[0]};2S`),!0;case 4:return this._report(`\x1b[?${t[0]};0;4096S`),!0;default:return this._report(`\x1b[?${t[0]};2S`),!0}if(2===t[0])switch(t[1]){case 1:let g=null===(e=null===(A=this._renderer)||void 0===A?void 0:A.dimensions)||void 0===e?void 0:e.css.canvas.width,o=null===(s=null===(i=this._renderer)||void 0===i?void 0:i.dimensions)||void 0===s?void 0:s.css.canvas.height;if(!g||!o){const I=c.CELL_SIZE_DEFAULT;g=((null===(r=this._terminal)||void 0===r?void 0:r.cols)||80)*I.width,o=((null===(a=this._terminal)||void 0===a?void 0:a.rows)||24)*I.height}if(g*o<this._opts.pixelLimit)this._report(`\x1b[?${t[0]};0;${g.toFixed(0)};${o.toFixed(0)}S`);else{const I=Math.floor(Math.sqrt(this._opts.pixelLimit));this._report(`\x1b[?${t[0]};0;${I};${I}S`)}return!0;case 4:const n=Math.floor(Math.sqrt(this._opts.pixelLimit));return this._report(`\x1b[?${t[0]};0;${n};${n}S`),!0;default:return this._report(`\x1b[?${t[0]};2S`),!0}return this._report(`\x1b[?${t[0]};1S`),!0}}})(),v})()}}]);